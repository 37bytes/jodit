((t,e)=>{if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var s=e();for(var i in s)("object"==typeof exports?exports:t)[i]=s[i]}})(self,(function(){return function(){"use strict";var t={d(e,s){for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{VDomRender(){return As}});var s={};function i(t,e,s,i){var o,n=arguments.length,r=3>n?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(3>n?o(r):n>3?o(e,s,r):o(e,s))||r);return n>3&&r&&Object.defineProperty(e,s,r),r}function o(t){return"function"==typeof t}function n(t){return t&&"function"==typeof t.then}function r(t){return"string"==typeof t}function a(t){return null==t}function l(t,e){if(!r(t)||!t.length)return null;const s=t.split(".");let i=e;try{for(const t of s){if(a(i[t]))return null;i=i[t]}}catch(t){return null}return a(i)?null:i}t.r(s),t.d(s,{required(){return ge},url(){return ve}});const h={beforeInit:"beforeInit",ready:"ready",beforeDestruct:"beforeDestruct",destructed:"destructed"};class c{constructor(){this._items=new Map}normalizeName(t){return pt(t).toLowerCase()}items(t){const e=[];return this._items.forEach(((t,s)=>{e.push([s,t])})),e.filter((([e])=>!t||t.includes(e)))}add(t,e){this._items.set(this.normalizeName(t),e)}get(t){return this._items.get(this.normalizeName(t))}remove(t){this._items.delete(this.normalizeName(t))}init(t){const e=t.o.extraPlugins.map((t=>r(t)?{name:t}:t)),s=H(t.o.disablePlugins).map((t=>this.normalizeName(t))),i=[],o={},a=[],l={},h=([e,n])=>{var r;if(s.includes(e)||i.includes(e)||o[e])return;const h=null===(r=n)||void 0===r?void 0:r.requires;if(h&&C(h)&&this.hasDisabledRequires(s,h))return;const d=c.makePluginInstance(t,n);d&&(this.initOrWait(t,e,d,i,o),a.push(d),l[e]=d)};return u=()=>{t.isInDestruct||(this.items(t.o.safeMode?t.o.safePluginsList.concat(e.map((t=>t.name))):null).forEach(h),this.addListenerOnBeforeDestruct(t,a),t.__plugins=l)},n(d=this.loadExtras(t,e))?d.finally(u):u();var d,u}hasDisabledRequires(t,e){return!(!(null==e?void 0:e.length)||!t.some((t=>e.includes(t))))}static makePluginInstance(t,e){try{return o(e)?new e(t):e}catch(t){}return null}initOrWait(t,e,s,i,n){const r=(e,s)=>{if(!a(r=s)&&o(r.init)){const o=s.requires;if((null==o?void 0:o.length)&&!o.every((t=>i.includes(t))))return n[e]=s,!1;try{s.init(t)}catch(t){}i.push(e)}else i.push(e);var r;return s.hasStyle&&c.loadStyle(t,e),!0};r(e,s),Object.keys(n).forEach((t=>{const e=n[t];e&&r(t,e)&&(n[t]=void 0,delete n[t])}))}addListenerOnBeforeDestruct(t,e){t.e.on("beforeDestruct",(()=>{e.forEach((e=>{j(e)&&e.destruct(t)})),e.length=0,delete t.__plugins}))}load(t,e){return Promise.all(e.map((e=>{const s=e.url||c.getFullUrl(t,e.name,!0);return $t(t,s).then((t=>({v:t,status:"fulfilled"})),(t=>({e:t,status:"rejected"})))})))}static async loadStyle(t,e){const s=c.getFullUrl(t,e,!1);if(!this.styles.has(s))return this.styles.add(s),Wt(t,s)}static getFullUrl(t,e,s){return e=pt(e),t.basePath+"plugins/"+e+"/"+e+"."+(s?"js":"css")}loadExtras(t,e){if(e&&e.length)try{const s=e.filter((t=>!this._items.has(this.normalizeName(t.name))));if(s.length)return this.load(t,s)}catch(t){}}}c.styles=new Set;const d="\ufeff",u=/^(ARTICLE|SCRIPT|STYLE|OBJECT|FOOTER|HEADER|NAV|SECTION|IFRAME|JODIT|JODIT-MEDIA|PRE|DIV|P|LI|UL|OL|H[1-6]|BLOCKQUOTE|TR|TD|TH|TBODY|THEAD|TABLE|BODY|HTML|FIGCAPTION|FIGURE|DT|DD|DL|DFN|FORM)$/i,p=["img","br","video","iframe","script","input","textarea","hr","link","jodit","jodit-media"],f=(RegExp(`^${p.join("|")}$`,"i"),"Escape"),m=("undefined"!=typeof navigator&&(-1!==navigator.userAgent.indexOf("MSIE")||navigator),"jodit-selection_marker"),g=("undefined"!=typeof window&&window,(()=>{if("undefined"==typeof document)return"";const t=document.currentScript,e=t=>t.replace(/\/[^/]+.js$/,"/");if(t)return e(t.src);const s=document.querySelectorAll("script[src]");return s&&s.length?e(s[s.length-1].src):window.location.href})()),v="data-jodit-temp";function b(t,e,s,i,o=!1){const{style:n,className:a}=t.options;return n&&(r(l=n)||C(l)?l.length:I(l)?Object.keys(l).length:0)>0&&Object.keys(n).forEach((r=>{if(""!==e.style.getPropertyValue(pt(r))||null!=n[r]){if(((t,e,s)=>{const i=t.create.element(e.tagName.toLowerCase());i.style.cssText=e.style.cssText,(t=>{var e;if(void 0!==Nt(t,"shadowRoot"))return Nt(t,"shadowRoot");const s=jt(t),i=document.createElement("iframe");Lt(i,{width:0,height:0,position:"absolute",border:0}),i.src="about:blank",s.appendChild(i);const o=null===(e=i.contentWindow)||void 0===e?void 0:e.document,n=o?o.body:t.od.body;return Nt(t,"shadowRoot",n),n})(t).appendChild(i);const o=Lt(i,s);return ht.safeRemove(i),o})(s,e,r)===Rt(r,n[r]))return!o&&Lt(e,r,null),void(i=((t,e,s)=>(Bt(e,"style")||(Bt(e,"style",null),e.tagName.toLowerCase()===t.defaultTag&&(ht.unwrap(e),s=it)),s))(t,e,i=nt));i=ot,!o&&Lt(e,r,n[r])}})),a&&(e.classList.contains(a)?(e.classList.remove(a),i=nt):(e.classList.add(a),i=ot)),i;var l}const w=t=>o(t.className)?t.className():NaN;function y(t){class e extends t{constructor(...t){super(...t);const s=Object.getPrototypeOf(this)===e.prototype,i=w(this)===w(e.prototype);(s||i)&&this.setStatus("ready")}}return e.prototype.constructor=t,e}function C(t){return Array.isArray(t)}function x(t){return"boolean"==typeof t}function j(t){return!a(t)&&o(t.destruct)}function S(t){return!!(t&&t instanceof Object&&o(t.constructor)&&("undefined"!=typeof Jodit&&t instanceof Jodit||t.isJodit))}function E(t){return!!(t&&t instanceof Object&&o(t.constructor)&&(t instanceof yt.View||t.isView))}function _(t){return"number"==typeof t&&!isNaN(t)&&isFinite(t)}function T(t){if(r(t)){if(!t.match(/^([+-])?[0-9]+(\.?)([0-9]+)?(e[0-9]+)?$/))return!1;t=parseFloat(t)}return"number"==typeof t&&!isNaN(t)&&isFinite(t)}function I(t){return!(!t||"object"!=typeof t||t.nodeType||(t=>null!=t&&t===t.window)(t)||t.constructor&&!{}.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))}function N(t){return!!t.length&&!/[^0-9A-Za-zа-яА-ЯЁё\w\-_.]/.test(t)}function k(t){return new TypeError(t)}function M(t,e=!1,s="debounce"){return(i,n)=>{if(!o(i[n]))throw k("Handler must be a Function");i.hookStatus(h.ready,(i=>{const r=E(i)?i:i.jodit,a=o(t)?t(i):t;i[n]=r.async[s](i[n].bind(i),_(a)||I(a)?a:r.defaultTimeout,e)}))}}function z(t,e=!1){return M(t,e,"throttle")}function R(t){return(e,s)=>{if(!o(e[s]))throw k("Handler must be a Function");e.hookStatus(t,(t=>{e[s].call(t)}))}}const L="JoditEventDefaultNamespace";class O{constructor(){this.__store={}}get(t,e){if(void 0!==this.__store[e])return this.__store[e][t]}indexOf(t,e,s){const i=this.get(t,e);if(i)for(let t=0;i.length>t;t+=1)if(i[t].originalCallback===s)return t;return!1}namespaces(t=!1){const e=Object.keys(this.__store);return t?e.filter((t=>t!==L)):e}events(t){return this.__store[t]?Object.keys(this.__store[t]):[]}set(t,e,s,i=!1){void 0===this.__store[e]&&(this.__store[e]={}),void 0===this.__store[e][t]&&(this.__store[e][t]=[]),i?this.__store[e][t].unshift(s):this.__store[e][t].push(s)}clear(){this.__store={}}}class B{constructor(t){this.mutedEvents=new Set,this.__key="__JoditEventEmitterNamespaces",this.doc=document,this.prepareEvent=t=>{t.cancelBubble||(t.type.match(/^touch/)&&t.changedTouches&&t.changedTouches.length&&["clientX","clientY","pageX","pageY"].forEach((e=>{Object.defineProperty(t,e,{value:t.changedTouches[0][e],configurable:!0,enumerable:!0})})),t.originalEvent||(t.originalEvent=t),"paste"===t.type&&void 0===t.clipboardData&&this.doc.defaultView.clipboardData&&Object.defineProperty(t,"clipboardData",{get:()=>this.doc.defaultView.clipboardData,configurable:!0,enumerable:!0}))},this.currents=[],this.__stopped=[],this.isDestructed=!1,t&&(this.doc=t),this.__key+=(new Date).getTime()}mute(t){return this.mutedEvents.add(null!=t?t:"*"),this}isMuted(t){return!(!t||!this.mutedEvents.has(t))||this.mutedEvents.has("*")}unmute(t){return this.mutedEvents.delete(null!=t?t:"*"),this}eachEvent(t,e){t.split(/[\s,]+/).forEach((t=>{const s=t.split(".");e.call(this,s[0],s[1]||L)}))}getStore(t){if(!t)throw k("Need subject");if(void 0===t[this.__key]){const e=new O;Object.defineProperty(t,this.__key,{enumerable:!1,configurable:!0,value:e})}return t[this.__key]}clearStore(t){void 0!==t[this.__key]&&delete t[this.__key]}triggerNativeEvent(t,e){const s=this.doc.createEvent("HTMLEvents");"string"==typeof e?s.initEvent(e,!0,!0):(s.initEvent(e.type,e.bubbles,e.cancelable),["screenX","screenY","clientX","clientY","target","srcElement","currentTarget","timeStamp","which","keyCode"].forEach((t=>{Object.defineProperty(s,t,{value:e[t],enumerable:!0})})),Object.defineProperty(s,"originalEvent",{value:e,enumerable:!0})),t.dispatchEvent(s)}get current(){return this.currents[this.currents.length-1]}on(t,e,s,i=!1){const n=r(t)?this:t,a=r(e)?e:t;let l=s;void 0===l&&o(e)&&(l=e);const h=this.getStore(n);if(!r(a)||""===a)throw k("Need events names");if(!o(l))throw k("Need event handler");if(C(n))return n.forEach((t=>{this.on(t,a,l,i)})),this;const c=o(n.addEventListener),d=this;let u=function(t,...e){if(!d.isMuted(t))return l&&l.call(this,...e)};return c&&(u=function(t){if(!d.isMuted(t.type))return d.prepareEvent(t),l&&!1===l.call(this,t)?(t.preventDefault(),t.stopImmediatePropagation(),!1):void 0}),this.eachEvent(a,((t,e)=>{if(""===t)throw k("Need event name");if(!1===h.indexOf(t,e,l)&&(h.set(t,e,{event:t,originalCallback:l,syntheticCallback:u},i),c)){const e=!!["touchstart","touchend","scroll","mousewheel","mousemove","touchmove"].includes(t)&&{passive:!0};n.addEventListener(t,u,e)}})),this}one(t,e,s,i=!1){const n=r(t)?this:t,a=r(e)?e:t;let l=s;void 0===l&&o(e)&&(l=e);const h=(...t)=>(this.off(n,a,h),l(...t));return this.on(n,a,h,i),this}off(t,e,s){const i=r(t)?this:t,n=r(e)?e:t,a=this.getStore(i);let l=s;if(!r(n)||!n)return a.namespaces().forEach((t=>{this.off(i,"."+t)})),this.clearStore(i),this;void 0===l&&o(e)&&(l=e);const h=o(i.removeEventListener),c=t=>{h&&i.removeEventListener(t.event,t.syntheticCallback,!1)},d=(t,e)=>{if(""!==t){const s=a.get(t,e);if(s&&s.length)if(o(l)){const i=a.indexOf(t,e,l);!1!==i&&(c(s[i]),s.splice(i,1))}else s.forEach(c),s.length=0}else a.events(e).forEach((t=>{""!==t&&d(t,e)}))};return this.eachEvent(n,((t,e)=>{e===L?a.namespaces().forEach((e=>{d(t,e)})):d(t,e)})),this}stopPropagation(t,e){const s=r(t)?this:t,i=r(t)?t:e;if("string"!=typeof i)throw k("Need event names");const o=this.getStore(s);this.eachEvent(i,((t,e)=>{const i=o.get(t,e);i&&this.__stopped.push(i),e===L&&o.namespaces(!0).forEach((e=>this.stopPropagation(s,t+"."+e)))}))}removeStop(t){if(t){const e=this.__stopped.indexOf(t);-1!==e&&this.__stopped.splice(0,e+1)}}isStopped(t){return void 0!==t&&-1!==this.__stopped.indexOf(t)}fire(t,e,...s){let i,n;const a=r(t)?this:t,l=r(t)?t:e,h=r(t)?[e,...s]:s,c=o(a.dispatchEvent);if(!c&&!r(l))throw k("Need events names");const d=this.getStore(a);return!r(l)&&c?this.triggerNativeEvent(a,e):this.eachEvent(l,((t,e)=>{if(c)this.triggerNativeEvent(a,t);else{const s=d.get(t,e);if(s)try{[...s].every((e=>!this.isStopped(s)&&(this.currents.push(t),n=e.syntheticCallback.call(a,t,...h),this.currents.pop(),void 0!==n&&(i=n),!0)))}finally{this.removeStop(s)}e!==L||c||d.namespaces().filter((t=>t!==e)).forEach((e=>{const s=this.fire.call(this,a,t+"."+e,...h);void 0!==s&&(i=s)}))}})),i}destruct(){this.isDestructed&&(this.isDestructed=!0,this.off(this),this.getStore(this).clear(),delete this[this.__key])}}const F=Symbol("observable-object");function P(t){return void 0!==t[F]}function D(t){if(P(t))return t;const e={},s={},i=(e,o)=>C(e)?(e.map((t=>i(t,o))),t):(s[e]||(s[e]=[]),s[e].push(o),t),o=(i,...n)=>{if(C(i))i.map((t=>o(t,...n)));else try{!e[i]&&s[i]&&(e[i]=!0,s[i].forEach((e=>e.call(t,...n))))}finally{e[i]=!1}},n=(e,s=[])=>{const r={};P(e)||(Object.defineProperty(e,F,{enumerable:!1,value:!0}),Object.keys(e).forEach((i=>{const a=i,l=s.concat(a).filter((t=>t.length));r[a]=e[a];const h=A(e,a);Object.defineProperty(e,a,{set(e){var s;const i=r[a];if(r[a]!==e){o(["beforeChange","beforeChange."+l.join(".")],a,e),I(e)&&n(e,l),h&&h.set?h.set.call(t,e):r[a]=e;const c=[];o(["change",...l.reduce(((t,e)=>(c.push(e),t.push("change."+c.join(".")),t)),[])],l.join("."),i,(null===(s=e)||void 0===s?void 0:s.valueOf)?e.valueOf():e)}},get(){return h&&h.get?h.get.call(t):r[a]},enumerable:!0,configurable:!0}),I(r[a])&&n(r[a],l)})),Object.defineProperty(t,"on",{value:i}))};return n(t),t}function H(t){return r(t)?t.split(/[,\s]+/):t}function A(t,e){let s;do{s=Object.getOwnPropertyDescriptor(t,e),t=Object.getPrototypeOf(t)}while(!s&&t);return s}function $(t,e){return(s,i)=>{if(!o(s[i]))throw k("Handler must be a Function");const n=n=>{const r=(t,...e)=>{if(!n.isInDestruct)return n[i](t,...e)};H(t).forEach((t=>{if(/:/.test(t)){const[s,i]=t.split(":"),a=E(n)?n:n.jodit;return s.length&&(e=n.get(s)),o(e)&&(e=e(n)),a.events.on(e||n,i,r),e||a.events.on(i,r),void a.hookStatus("beforeDestruct",(()=>{a.events.off(e||n,i,r).off(i,r)}))}const i=t.split("."),[a]=i,l=i.slice(1);let h=n[a];I(h)&&D(h).on("change."+l.join("."),r);const c=A(s,a);Object.defineProperty(n,a,{configurable:!0,set(t){const e=h;e!==t&&(h=t,c&&c.set&&c.set.call(n,t),I(h)&&(h=D(h),h.on("change."+l.join("."),r)),r(a,e,h))},get:()=>c&&c.get?c.get.call(n):h})}))};o(s.hookStatus)?s.hookStatus(h.ready,n):n(s)}}function W(t){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t=>typeof t:t=>t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t,W(t)}function U(t,e,s){var i=s.value;if("function"!=typeof i)throw new TypeError("@boundMethod decorator can only be applied to methods not: ".concat(W(i)));var o=!1;return{configurable:!0,get(){if(o||this===t.prototype||this.hasOwnProperty(e)||"function"!=typeof i)return i;var s=i.bind(this);return o=!0,Object.defineProperty(this,e,{configurable:!0,get(){return s},set(t){i=t,delete this[e]}}),o=!1,s},set(t){i=t}}}function V(t){var e;return"undefined"!=typeof Reflect&&"function"==typeof Reflect.ownKeys?e=Reflect.ownKeys(t.prototype):(e=Object.getOwnPropertyNames(t.prototype),"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(t.prototype)))),e.forEach((e=>{if("constructor"!==e){var s=Object.getOwnPropertyDescriptor(t.prototype,e);"function"==typeof s.value&&Object.defineProperty(t.prototype,e,U(t,e,s))}})),t}function q(){return 1===arguments.length?V.apply(void 0,arguments):U.apply(void 0,arguments)}class G{constructor(t){this.jodit=t,t.e.on("removeMarkers",(()=>{this.removeMarkers()}))}get j(){return this.jodit}errorNode(t){if(!ht.isNode(t))throw k("Parameter node must be instance of Node")}get area(){return this.j.editor}get win(){return this.j.ew}get doc(){return this.j.ed}get sel(){return this.j.o.shadowRoot&&o(this.j.o.shadowRoot.getSelection)?this.j.o.shadowRoot.getSelection():this.win.getSelection()}get range(){const t=this.sel;return t&&t.rangeCount?t.getRangeAt(0):this.createRange()}createRange(t=!1){const e=this.doc.createRange();return t&&this.selectRange(e),e}remove(){const t=this.sel,e=this.current();if(t&&e)for(let e=0;t.rangeCount>e;e+=1)t.getRangeAt(e).deleteContents(),t.getRangeAt(e).collapse(!0)}clear(){var t,e;(null===(t=this.sel)||void 0===t?void 0:t.rangeCount)&&(null===(e=this.sel)||void 0===e||e.removeAllRanges())}removeNode(t){if(!ht.isOrContains(this.j.editor,t,!0))throw k("Selection.removeNode can remove only editor's children");ht.safeRemove(t),this.j.e.fire("afterRemoveNode",t)}insertCursorAtPoint(t,e){this.removeMarkers();try{const s=this.createRange();return(()=>{if(this.doc.caretPositionFromPoint){const i=this.doc.caretPositionFromPoint(t,e);if(i)return void s.setStart(i.offsetNode,i.offset)}if(this.doc.caretRangeFromPoint){const i=this.doc.caretRangeFromPoint(t,e);s.setStart(i.startContainer,i.startOffset)}})(),s.collapse(!0),this.selectRange(s),!0}catch(t){}return!1}static isMarker(t){return ht.isNode(t)&&ht.isTag(t,"span")&&t.hasAttribute("data-"+m)}get hasMarkers(){return!!this.markers.length}get markers(){return ke("span[data-"+m+"]",this.area)}removeMarkers(){this.markers.forEach(ht.safeRemove)}marker(t=!1,e){let s=null;e&&(s=e.cloneRange(),s.collapse(t));const i=this.j.createInside.span();return i.id=m+"_"+Number(new Date)+"_"+(Math.random()+"").slice(2),i.style.lineHeight="0",i.style.display="none",i.setAttribute("data-"+m,t?"start":"end"),i.appendChild(this.j.createInside.text(d)),s&&ht.isOrContains(this.area,t?s.startContainer:s.endContainer)&&s.insertNode(i),i}restore(){let t=!1;const e=t=>`span[data-${m}=${t?"start":"end"}]`,s=this.area.querySelector(e(!0)),i=this.area.querySelector(e(!1));if(s){if(t=this.createRange(),i)t.setStartAfter(s),ht.safeRemove(s),t.setEndBefore(i),ht.safeRemove(i);else{const e=s.previousSibling;ht.isText(e)?t.setStart(e,e.nodeValue?e.nodeValue.length:0):t.setStartBefore(s),ht.safeRemove(s),t.collapse(!0)}t&&this.selectRange(t)}}save(t=!1){if(this.hasMarkers)return[];const e=this.sel;if(!e||!e.rangeCount)return[];const s=[],i=e.rangeCount,o=[];for(let t=0;i>t;t+=1)if(o[t]=e.getRangeAt(t),o[t].collapsed){const e=this.marker(!0,o[t]);s[t]={startId:e.id,collapsed:!0,startMarker:e.outerHTML}}else{const e=this.marker(!0,o[t]),i=this.marker(!1,o[t]);s[t]={startId:e.id,endId:i.id,collapsed:!1,startMarker:e.outerHTML,endMarker:i.outerHTML}}if(!t){e.removeAllRanges();for(let t=i-1;t>=0;--t){const i=this.doc.getElementById(s[t].startId);if(i)if(s[t].collapsed)o[t].setStartAfter(i),o[t].collapse(!0);else if(o[t].setStartBefore(i),s[t].endId){const e=this.doc.getElementById(s[t].endId);e&&o[t].setEndAfter(e)}try{e.addRange(o[t].cloneRange())}catch(t){}}}return s}focus(t={preventScroll:!0}){var e,s;if(!this.isFocused()){const i=Re(this.j.container),o=null==i?void 0:i.scrollTop;this.j.iframe&&"complete"===this.doc.readyState&&this.j.iframe.focus(t),this.win.focus(),this.area.focus(t),o&&(null==i?void 0:i.scrollTo)&&i.scrollTo(0,o);const n=this.sel,r=(null==n?void 0:n.rangeCount)?null==n?void 0:n.getRangeAt(0):null;if(!r||!ht.isOrContains(this.area,r.startContainer)){const t=this.createRange();t.setStart(this.area,0),t.collapse(!0),this.selectRange(t,!1)}return this.j.editorIsActive||null===(s=null===(e=this.j)||void 0===e?void 0:e.events)||void 0===s||s.fire("focus"),!0}return!1}isCollapsed(){const t=this.sel;for(let e=0;t&&t.rangeCount>e;e+=1)if(!t.getRangeAt(e).collapsed)return!1;return!0}isFocused(){return this.doc.hasFocus&&this.doc.hasFocus()&&this.area===this.doc.activeElement}current(t=!0){if(1===this.j.getRealMode()){const e=this.sel;if(!e||0===e.rangeCount)return null;const s=e.getRangeAt(0);let i=s.startContainer,o=!1;const n=t=>o?t.lastChild:t.firstChild;if(ht.isTag(i,"br")&&e.isCollapsed)return i;if(!ht.isText(i)){if(i=s.startContainer.childNodes[s.startOffset],i||(i=s.startContainer.childNodes[s.startOffset-1],o=!0),i&&e.isCollapsed&&!ht.isText(i))if(!o&&ht.isText(i.previousSibling))i=i.previousSibling;else if(t){let t=n(i);for(;t;){if(t&&ht.isText(t)){i=t;break}t=n(t)}}if(i&&!e.isCollapsed&&!ht.isText(i)){let t=i,e=i;do{t=t.firstChild,e=e.lastChild}while(t&&e&&!ht.isText(t));t===e&&t&&ht.isText(t)&&(i=t)}}if(i&&ht.isOrContains(this.area,i))return i}return null}insertNode(t,e=!0,s=!0){var i;this.errorNode(t),this.j.e.fire("safeHTML",t),!this.isFocused()&&this.j.isEditorMode()&&(this.focus(),this.restore());const o=this.sel;if(this.isCollapsed()||this.j.execCommand("Delete"),o&&o.rangeCount){const e=o.getRangeAt(0);ht.isOrContains(this.area,e.commonAncestorContainer)?ht.isTag(e.startContainer,p)&&e.collapsed?null===(i=e.startContainer.parentNode)||void 0===i||i.insertBefore(t,e.startContainer):(e.deleteContents(),e.insertNode(t)):this.area.appendChild(t)}else this.area.appendChild(t);e&&(t.nodeType===Node.DOCUMENT_FRAGMENT_NODE?t.lastChild&&this.setCursorAfter(t.lastChild):this.setCursorAfter(t)),s&&this.j.events&&this.j.e.fire("synchro"),this.j.events&&this.j.e.fire("afterInsertNode",t)}insertHTML(t){if(""===t)return;const e=this.j.createInside.div(),s=this.j.createInside.fragment();let i;if(!this.isFocused()&&this.j.isEditorMode()&&(this.focus(),this.restore()),ht.isNode(t)?e.appendChild(t):e.innerHTML=""+t,(this.j.isEditorMode()||!1!==this.j.e.fire("insertHTML",e.innerHTML))&&(i=e.lastChild,i)){for(;e.firstChild;)i=e.firstChild,s.appendChild(e.firstChild);this.insertNode(s,!1,!1),i?this.setCursorAfter(i):this.setCursorIn(s),this.j.e&&this.j.e.fire("synchro")}}insertImage(t,e=null,s=null){const i=r(t)?this.j.createInside.element("img"):t;if(r(t)&&i.setAttribute("src",t),null!=s){let t=""+s;t&&"auto"!==t&&0>(t+"").indexOf("px")&&0>(t+"").indexOf("%")&&(t+="px"),Ot(this.j.o.resizer.forImageChangeAttributes?Bt:Lt,i,"width",t)}e&&"object"==typeof e&&Lt(i,e);const o=()=>{(i.offsetHeight>i.naturalHeight||i.offsetWidth>i.naturalWidth)&&(i.style.width="",i.style.height=""),i.removeEventListener("load",o)};this.j.e.on(i,"load",o),i.complete&&o(),this.insertNode(i),this.j.e.fire("afterInsertImage",i)}eachSelection(t){var e;const s=this.sel;if(s&&s.rangeCount){const i=s.getRangeAt(0);let o=i.commonAncestorContainer;ht.isHTMLElement(o)||(o=o.parentElement);const n=[],r=i.startOffset,a=o.childNodes.length,l=a>r?r:a-1;let h=i.startContainer===this.area?o.childNodes[l]:i.startContainer,c=i.endContainer===this.area?o.childNodes[i.endOffset-1]:i.endContainer;ht.isText(h)&&h===i.startContainer&&i.startOffset===(null===(e=h.nodeValue)||void 0===e?void 0:e.length)&&h.nextSibling&&(h=h.nextSibling),ht.isText(c)&&c===i.endContainer&&0===i.endOffset&&c.previousSibling&&(c=c.previousSibling);const u=t=>{!t||t===o||ht.isEmptyTextNode(t)||G.isMarker(t)||n.push(t)};u(h),h!==c&&ht.find(h,(t=>(u(t),t===c||t&&t.contains&&t.contains(c))),o,!0,!1);const p=e=>{if(ht.isOrContains(this.j.editor,e,!0)){if(e.nodeName.match(/^(UL|OL)$/))return Jt(e.childNodes).forEach(p);if(ht.isTag(e,"li"))if(e.firstChild)e=e.firstChild;else{const t=this.j.createInside.text(d);e.appendChild(t),e=t}t(e)}};0===n.length&&ht.isEmptyTextNode(h)&&n.push(h),0===n.length&&h.firstChild&&n.push(h.firstChild),n.forEach(p)}}cursorInTheEdge(t,e){var s,i;const o=!t,n=null===(s=this.sel)||void 0===s?void 0:s.getRangeAt(0),r=this.current(!1);if(!n||!r||!ht.isOrContains(e,r,!0))return null;const a=t?n.startContainer:n.endContainer,l=t?n.startOffset:n.endOffset,h=t=>t&&!ht.isTag(t,"br")&&!ht.isEmptyTextNode(t);if(ht.isText(a)){const e=(null===(i=a.nodeValue)||void 0===i?void 0:i.length)?a.nodeValue:"";if(o&&e.replace(/[\uFEFF]+$/g,"").length>l)return!1;const s=/^[\uFEFF]+/g.exec(e);if(t&&(s&&l>s[0].length||!s&&l>0))return!1}else{const t=Jt(a.childNodes);if(o){if(t.slice(l).some(h))return!1}else if(t.slice(0,l).some(h))return!1}return!Ot(t?ht.prev:ht.next,r,h,e)}cursorOnTheLeft(t){return this.cursorInTheEdge(!0,t)}cursorOnTheRight(t){return this.cursorInTheEdge(!1,t)}setCursorAfter(t){return this.setCursorNearWith(t,!1)}setCursorBefore(t){return this.setCursorNearWith(t,!0)}setCursorNearWith(t,e){var s,i;if(this.errorNode(t),!ht.up(t,(t=>t===this.area||t&&t.parentNode===this.area),this.area))throw k("Node element must be in editor");const o=this.createRange();let n=null;return ht.isText(t)?e?o.setStart(t,0):o.setEnd(t,null!==(i=null===(s=t.nodeValue)||void 0===s?void 0:s.length)&&void 0!==i?i:0):(n=this.j.createInside.text(d),e?o.setStartBefore(t):o.setEndAfter(t),o.collapse(e),o.insertNode(n),o.selectNode(n)),o.collapse(e),this.selectRange(o),n}setCursorIn(t,e=!1){if(this.errorNode(t),!ht.up(t,(t=>t===this.area||t&&t.parentNode===this.area),this.area))throw k("Node element must be in editor");const s=this.createRange();let i=t,o=t;do{if(ht.isText(i))break;o=i,i=e?i.firstChild:i.lastChild}while(i);if(!i){const t=this.j.createInside.text(d);/^(img|br|input)$/i.test(o.nodeName)?i=o:(o.appendChild(t),o=t)}return s.selectNodeContents(i||o),s.collapse(e),this.selectRange(s),o}selectRange(t,e=!0){const s=this.sel;e&&!this.isFocused()&&this.focus(),s&&(s.removeAllRanges(),s.addRange(t)),this.j.e.fire("changeSelection")}select(t,e=!1){if(this.errorNode(t),!ht.up(t,(t=>t===this.area||t&&t.parentNode===this.area),this.area))throw k("Node element must be in editor");const s=this.createRange();s[e?"selectNodeContents":"selectNode"](t),this.selectRange(s)}get html(){const t=this.sel;if(t&&t.rangeCount>0){const e=t.getRangeAt(0).cloneContents(),s=this.j.createInside.div();return s.appendChild(e),s.innerHTML}return""}*wrapInTagGen(){if(this.isCollapsed()){const t=this.jodit.createInside.element("font",d);this.insertNode(t,!1,!1);const[e]=this.markers;return e?t.appendChild(e):(this.setCursorIn(t),this.save()),yield t,void ht.unwrap(t)}if(ke("*[style*=font-size]",this.area).forEach((t=>Bt(t,"data-font-size",""+t.style.fontSize))),this.isCollapsed()){const t=this.j.createInside.element("font");Bt(t,"size",7),this.insertNode(t,!1,!1)}else this.j.nativeExecCommand("fontsize",!1,"7");ke("*[data-font-size]",this.area).forEach((t=>{const e=Bt(t,"data-font-size");e&&(t.style.fontSize=e,Bt(t,"data-font-size",null))}));const t=ke('font[size="7"]',this.area);for(const e of t){const{firstChild:t,lastChild:s}=e;t&&t===s&&G.isMarker(t)||(t&&G.isMarker(t)&&ht.before(e,t),s&&G.isMarker(s)&&ht.after(e,s),yield e),ht.unwrap(e)}}wrapInTag(t){const e=[];for(const s of this.wrapInTagGen())try{if(s.firstChild&&s.firstChild===s.lastChild&&G.isMarker(s.firstChild))continue;o(t)?t(s):e.push(ht.replace(s,t,this.j.createInside))}finally{const t=s.parentNode;t&&(ht.unwrap(s),ht.isEmpty(t)&&ht.unwrap(t))}return e}applyStyle(t,e={}){new lt({style:t,element:e.element,className:e.className,defaultTag:e.defaultTag}).apply(this.j)}splitSelection(t){if(!this.isCollapsed())return null;const e=this.createRange(),s=this.range;e.setStartBefore(t);const i=this.cursorOnTheRight(t),o=this.cursorOnTheLeft(t),n=this.j.createInside.element("br"),r=this.j.createInside.text(d),a=r.cloneNode();try{if(i||o){s.insertNode(n);const t=(t,e)=>{let s=e(t);for(;s;){const t=e(s);if(!s||!ht.isTag(s,"br")&&!ht.isEmptyTextNode(s))break;ht.safeRemove(s),s=t}};t(n,(t=>t.nextSibling)),t(n,(t=>t.previousSibling)),ht.after(n,a),ht.before(n,r),i?(e.setEndBefore(n),s.setEndBefore(n)):(e.setEndAfter(n),s.setEndAfter(n))}else e.setEnd(s.startContainer,s.startOffset);const l=e.extractContents();if(t.parentNode)try{if(t.parentNode.insertBefore(l,t),i&&(null==n?void 0:n.parentNode)){const t=this.createRange();t.setStartBefore(n),this.selectRange(t)}}catch(t){}const h=t=>{var e,s,i;(null===(e=null==t?void 0:t.parentNode)||void 0===e?void 0:e.firstChild)===(null===(s=null==t?void 0:t.parentNode)||void 0===s?void 0:s.lastChild)&&(null===(i=null==t?void 0:t.parentNode)||void 0===i||i.appendChild(n.cloneNode()))};h(r),h(a)}finally{ht.safeRemove(r),ht.safeRemove(a)}return t.previousElementSibling}}function X(t,e,s){const i=s.s.createRange(),o=G.isMarker(e.previousSibling)?e.previousSibling:e;i.setStartBefore(t),i.setEndBefore(o),Y(t,i,!0);const n=G.isMarker(e.nextSibling)?e.nextSibling:e;i.setStartAfter(n),i.setEndAfter(t),Y(t,i,!1)}function Y(t,e,s){const i=e.extractContents();i.textContent&&ft(i.textContent).length||!i.firstChild||ht.unwrap(i.firstChild),t.parentNode&&Ot(s?ht.before:ht.after,t,i)}i([q],G.prototype,"createRange",null),i([q],G.prototype,"focus",null),i([q],G.prototype,"setCursorAfter",null),i([q],G.prototype,"setCursorBefore",null),i([q],G.prototype,"setCursorIn",null);class K{constructor(t,e){this.state=t,this.transitions=e,this.subState="",this.silent=!0}setState(t,e){this.state=t,null!=e&&(this.subState=e)}getState(){return this.state}getSubState(){return this.subState}disableSilent(){this.silent=!1}dispatch(t,...e){const s=this.transitions[this.state][t];if(s)return s.call(this,...e);if(!this.silent)throw Error("invalid action: "+this.state+"."+t)}}function Z(t){return!(!t||ht.isEmptyTextNode(t)||ht.isTemporary(t))}function J(t,e,s){if(!e)return!1;const{element:i,elementIsDefault:o,options:n}=t,r=!(!n.style||!((t,e)=>!(ht.isTag(t,"font")||!ht.isHTMLElement(t)||!Object.keys(e).every((s=>{const i=Lt(t,s,!0);return!a(i)&&""!==i&&!a(e[s])&&(""+Rt(s,e[s])).toLowerCase()===(""+i).toLowerCase()}))))(e,n.style)),l=e.nodeName.toLowerCase()===i||ht.isTag(e,["ul","ol"])&&t.elementIsList;return!!((!o||!s)&&l||r&&Z(e))||!(l||s||!o||!ht.isInlineBlock(e))}function Q(t,e){const{element:s,options:i}=t;if(!e||!Z(e))return!1;const o=e.nodeName.toLowerCase()===s,n=!(!i.style||!((t,e)=>!(ht.isTag(t,"font")||!ht.isHTMLElement(t)||!Object.keys(e).every((e=>!a(Lt(t,e,!0))))))(e,i.style));return o&&n}function tt(t,e,s){const{parentNode:i}=e;return i===s||!ht.isHTMLElement(i)||ht.next(e,Z,i)||ht.prev(e,Z,i)?null:t.isElementCommit&&t.elementIsBlock&&!ht.isBlock(i)?tt(t,i,s):!J(t,i,!1)||ht.isBlock(i)&&!t.elementIsBlock?null:i}function et(t,e){const{s,editor:i}=t,o=new K("start",{start:{start(){s.save(),kt(i.firstChild),this.setState("generator")}},generator:{initGenerator:()=>t.s.wrapInTagGen(),nextFont(t){const e=t.next();if(e.done)this.setState("end");else if(!((t,e)=>!!ht.closest(t,["style","script"],e))(e.value,i)&&!ht.isEmptyContent(e.value))return this.setState("check"),e.value}},check:{work(s){let i=tt(e,s,t.editor)||((t,e)=>{let{firstChild:s}=e;for(;s&&!Z(s);)if(s=s.nextSibling,!s)return null;return s&&!ht.next(s,Z,e)&&J(t,s,!1)?s:null})(e,s);return i?(this.setState("wholeElement"),i):(i=ht.closest(s,(t=>J(e,t,!0)),t.editor),i&&(e.elementIsBlock||X(i,s,t)),e.elementIsList&&ht.isTag(i,["ul","ol"])?(this.setState("orderList"),s):i?(this.setState("wholeElement"),i):((t,e)=>{const s=[],i=[];let o;const n=t.options.style;if(e.firstChild){const r=ht.eachGen(e);let a=r.next();for(;!a.done;){const e=a.value;J(t,e,!0)?(void 0===o&&(o=!0),s.push(e)):n&&Q(t,e)?(void 0===o&&(o=!1),i.push((()=>{Lt(e,Object.keys(n).reduce(((t,e)=>(t[e]=null,t)),{})),Bt(e,"style")||Bt(e,"style",null),e.nodeName.toLowerCase()===t.element&&s.push(e)}))):ht.isEmptyTextNode(e)||void 0===o&&(o=!1),a=r.next()}}return i.forEach((t=>t())),s.forEach(ht.unwrap),!!o})(e,s)?(this.setState("endProcess"),null):(this.setState("wrap"),s))}},wholeElement:{toggleStyles(s){let i=rt;var o,n;n=s,i=((o=e).elementIsBlock||ht.isTag(n,o.element)&&!o.elementIsDefault)&&(ht.unwrap(n),1)?it:b(e,s,t,i),this.setState("generator",i)}},orderList:{toggleStyles(s){let i=rt;const o=ht.closest(s,"li",t.editor);o&&ht.closest(s,["ul","ol"],t.editor)?(i=((t,e,s,i)=>{if(!e)return i;const o=e.parentElement;return o?o.tagName.toLowerCase()!==t.element?(b(t,ht.replace(o,t.element,s.createInside),s,i),at):b(t,e.parentElement,s,rt,!0)===ot?b(t,e.parentElement,s,i):(X(o,e,s),ht.unwrap(e.parentElement),ht.replace(e,s.o.enter,s.createInside),i):i})(e,o,t,i),this.setState(i!==at&&i!==it&&i!==ot?"generator":"endWhile")):this.setState("generator")}},wrap:{toggleStyles(s){if("unwrap"!==this.getSubState()){const i=((t,e,s)=>{const i=((t,e,s)=>{if(t.elementIsBlock){const t=ht.up(e,(t=>ht.isBlock(t)&&!ht.isTag(t,["td","th","tr","tbody","table","li","ul","ol"])),s.editor);if(t)return t}return t.elementIsBlock?((t,e,s,i)=>{const o=s.editor,n=s.createInside,r=(t,e="previousSibling")=>{let i=t,n=t;for(;n&&!ht.isTag(n,s.o.enter)&&(i=n,n=n[e]?n[e]:n.parentNode&&!ht.isBlock(n.parentNode)&&n.parentNode!==o?n.parentNode:null,!ht.isBlock(n)););return i},a=r(e),l=r(e,"nextSibling"),h=i();h.setStartBefore(a),h.setEndAfter(l);const c=h.extractContents(),d=n.element(t.element);return d.appendChild(c),h.insertNode(d),t.elementIsBlock&&ht.isEmpty(d)&&!ht.isTag(d.firstElementChild,"br")&&d.appendChild(n.element("br")),d})(t,e,s,s.s.createRange):(Bt(e,"size",null),e)})(t,e,s);return t.elementIsList?((t,e,s)=>{const i=ht.replace(e,"li",s.createInside);let o=i.previousElementSibling||i.nextElementSibling;return ht.isTag(o,["ul","ol"])||(o=s.createInside.element(t.element),ht.before(i,o)),i.previousElementSibling===o?ht.append(o,i):ht.prepend(o,i),o})(t,i,s):ht.replace(i,t.element,s.createInside,!0)})(e,s,t);b(e,i,t,st)}this.setState("generator")}},endWhile:{nextFont(t){t.next().done&&this.setState("end")}},endProcess:{toggleStyles(){this.setState("generator")}},end:{finalize(){s.restore()}}});o.dispatch("start");const n=o.dispatch("initGenerator");for(;"end"!==o.getState();){const t=o.dispatch("nextFont",n);if(t){const e=o.dispatch("work",t);o.dispatch("toggleStyles",e)}}o.dispatch("finalize",n)}const st="wrap",it="unwrap",ot="change",nt="unset",rt="initial",at="replace";class lt{constructor(t){this.options=t}get elementIsList(){return!(!this.options.element||!["ul","ol"].includes(this.options.element))}get element(){return this.options.element||this.defaultTag}get elementIsBlock(){return!(!this.options.element||!u.test(this.options.element))}get isElementCommit(){return!(!this.options.element||this.options.element===this.options.defaultTag)}get defaultTag(){return this.options.defaultTag?this.options.defaultTag:this.elementIsBlock?"p":"span"}get elementIsDefault(){return this.element===this.defaultTag}apply(t){et(t,this)}}class ht{static detach(t){for(;t.firstChild;)t.removeChild(t.firstChild)}static wrapInline(t,e,s){let i,o=t,n=t;s.s.save();let a=!1;do{a=!1,i=o.previousSibling,i&&!ht.isBlock(i)&&(a=!0,o=i)}while(a);do{a=!1,i=n.nextSibling,i&&!ht.isBlock(i)&&(a=!0,n=i)}while(a);const l=r(e)?s.createInside.element(e):e;o.parentNode&&o.parentNode.insertBefore(l,o);let h=o;for(;h&&(h=o.nextSibling,l.appendChild(o),o!==n&&h);)o=h;return s.s.restore(),l}static wrap(t,e,s){const i=r(e)?s.element(e):e;if(!t.parentNode)throw k("Element should be in DOM");return t.parentNode.insertBefore(i,t),i.appendChild(t),i}static unwrap(t){const e=t.parentNode;if(e){for(;t.firstChild;)e.insertBefore(t.firstChild,t);ht.safeRemove(t)}}static between(t,e,s){let i=t;for(;i&&i!==e&&(t===i||!s(i));){let t=i.firstChild||i.nextSibling;if(!t){for(;i&&!i.nextSibling;)i=i.parentNode;t=null==i?void 0:i.nextSibling}i=t}}static replace(t,e,s,i=!1,o=!1){var n;r(n=e)&&/<([A-Za-z][A-Za-z0-9]*)\b[^>]*>(.*?)<\/\1>/m.test(n.replace(/[\r\n]/g,""))&&(e=s.fromHTML(e));const a=r(e)?s.element(e):e;if(!o)for(;t.firstChild;)a.appendChild(t.firstChild);return i&&Jt(t.attributes).forEach((t=>{a.setAttribute(t.name,t.value)})),t.parentNode&&t.parentNode.replaceChild(a,t),a}static isEmptyTextNode(t){return ht.isText(t)&&(!t.nodeValue||0===t.nodeValue.replace(/[\uFEFF]/g,"").trim().length)}static isEmptyContent(t){return ht.each(t,(t=>ht.isEmptyTextNode(t)))}static isContentEditable(t,e){return ht.isNode(t)&&!ht.closest(t,(t=>ht.isElement(t)&&"false"===t.getAttribute("contenteditable")),e)}static isEmpty(t,e=/^(img|svg|canvas|input|textarea|form)$/){return!t||(ht.isText(t)?null==t.nodeValue||0===ft(t.nodeValue).length:!e.test(t.nodeName.toLowerCase())&&ht.each(t,(t=>{if(ht.isText(t)&&null!=t.nodeValue&&0!==ft(t.nodeValue).length||ht.isElement(t)&&e.test(t.nodeName.toLowerCase()))return!1})))}static isNode(t){if(!t)return!1;const e=l("ownerDocument.defaultView",t);return!("object"!=typeof e||!e||"function"!=typeof e.Node&&"object"!=typeof e.Node)&&t instanceof e.Node}static isCell(t){return ht.isNode(t)&&/^(td|th)$/i.test(t.nodeName)}static isImage(t){return ht.isNode(t)&&/^(img|svg|picture|canvas)$/i.test(t.nodeName)}static isBlock(t){return!a(t)&&"object"==typeof t&&ht.isNode(t)&&u.test(t.nodeName)}static isText(t){return!(!t||t.nodeType!==Node.TEXT_NODE)}static isElement(t){var e;return!!ht.isNode(t)&&!(!(null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView)||t.nodeType!==Node.ELEMENT_NODE)}static isHTMLElement(t){var e;if(!ht.isNode(t))return!1;const s=null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView;return!!(s&&t instanceof s.HTMLElement)}static isInlineBlock(t){return ht.isElement(t)&&!/^(BR|HR)$/i.test(t.tagName)&&-1!==["inline","inline-block"].indexOf(""+Lt(t,"display"))}static canSplitBlock(t){return!a(t)&&ht.isHTMLElement(t)&&ht.isBlock(t)&&!/^(TD|TH|CAPTION|FORM)$/.test(t.nodeName)&&void 0!==t.style&&!/^(fixed|absolute)/i.test(t.style.position)}static last(t,e){let s=null==t?void 0:t.lastChild;if(!s)return null;do{if(e(s))return s;let i=s.lastChild;if(i||(i=s.previousSibling),!i&&s.parentNode!==t){do{s=s.parentNode}while(s&&!(null==s?void 0:s.previousSibling)&&s.parentNode!==t);i=null==s?void 0:s.previousSibling}s=i}while(s);return null}static prev(t,e,s,i=!0){return ht.find(t,e,s,!1,i)}static next(t,e,s,i=!0){return ht.find(t,e,s,!0,i)}static prevWithClass(t,e){return ht.prev(t,(t=>ht.isElement(t)&&t.classList.contains(e)),t.parentNode)}static nextWithClass(t,e){return ht.next(t,(t=>ht.isElement(t)&&t.classList.contains(e)),t.parentNode)}static find(t,e,s,i=!0,o=!0){const n=this.nextGen(t,s,i,o);let r=n.next();for(;!r.done;){if(e(r.value))return r.value;r=n.next()}return null}static*nextGen(t,e,s=!0,i=!0){const o=[];let n=t;do{let e=s?n.nextSibling:n.previousSibling;for(;e;)o.unshift(e),e=s?e.nextSibling:e.previousSibling;yield*this.runInStack(t,o,s,i),n=n.parentNode}while(n!==e);return null}static each(t,e,s=!0){const i=this.eachGen(t,s);let o=i.next();for(;!o.done;){if(!1===e(o.value))return!1;o=i.next()}return!0}static eachGen(t,e=!0){return this.runInStack(t,[t],e)}static*runInStack(t,e,s,i=!0){for(;e.length;){const o=e.pop();if(t!==o&&(yield o),i){let t=s?o.lastChild:o.firstChild;for(;t;)e.push(t),t=s?t.previousSibling:t.nextSibling}}}static findWithCurrent(t,e,s,i="nextSibling",o="firstChild"){let n=t;do{if(e(n))return n||null;if(o&&n&&n[o]){const t=ht.findWithCurrent(n[o],e,n,i,o);if(t)return t}for(;n&&!n[i]&&n!==s;)n=n.parentNode;n&&n[i]&&n!==s&&(n=n[i])}while(n&&n!==s);return null}static findSibling(t,e=!0,s=(t=>!ht.isEmptyTextNode(t))){const i=t=>e?t.previousSibling:t.nextSibling;let o=i(t);for(;o&&!s(o);)o=i(o);return o&&s(o)?o:null}static up(t,e,s,i=!1){let o=t;if(!o)return null;do{if(e(o))return o;if(o===s||!o.parentNode)break;o=o.parentNode}while(o&&o!==s);return o===s&&i&&e(o)?o:null}static closest(t,e,s){let i;return i=o(e)?e:C(e)?t=>t&&e.includes(t.nodeName.toLowerCase()):t=>t&&e===t.nodeName.toLowerCase(),ht.up(t,i,s)}static furthest(t,e,s){let i=null,o=null==t?void 0:t.parentElement;for(;o&&o!==s&&e(o);)i=o,o=null==o?void 0:o.parentElement;return i}static appendChildFirst(t,e){const s=t.firstChild;s?s!==e&&t.insertBefore(e,s):t.appendChild(e)}static after(t,e){const{parentNode:s}=t;s&&(s.lastChild===t?s.appendChild(e):s.insertBefore(e,t.nextSibling))}static before(t,e){const{parentNode:s}=t;s&&s.insertBefore(e,t)}static prepend(t,e){t.insertBefore(e,t.firstChild)}static append(t,e){C(e)?e.forEach((e=>{this.append(t,e)})):t.appendChild(e)}static moveContent(t,e,s=!1){const i=(t.ownerDocument||document).createDocumentFragment();Jt(t.childNodes).forEach((t=>{i.appendChild(t)})),s&&e.firstChild?e.insertBefore(i,e.firstChild):e.appendChild(i)}static all(t,e,s=!1){let i=t.childNodes?Jt(t.childNodes):[];return e(t)?t:(s&&(i=i.reverse()),i.forEach((t=>{ht.all(t,e,s)})),null)}static isOrContains(t,e,s=!1){return t===e?!s:!!(e&&t&&this.up(e,(e=>e===t),t,!0))}static safeRemove(t){t&&t.parentNode&&t.parentNode.removeChild(t)}static hide(t){t&&(Nt(t,"__old_display",t.style.display),t.style.display="none")}static show(t){if(!t)return;const e=Nt(t,"__old_display");"none"===t.style.display&&(t.style.display=e||"")}static isTag(t,e){const s=Zt(e).map(String);for(let e=0;s.length>e;e+=1)if(this.isElement(t)&&t.tagName.toLowerCase()===s[e].toLowerCase())return!0;return!1}static markTemporary(t,e){return e&&Bt(t,e),Bt(t,v,!0),t}static isTemporary(t){return!!ht.isElement(t)&&(G.isMarker(t)||"true"===Bt(t,v))}static replaceTemporaryFromString(t){return t.replace(/<([a-z]+)[^>]+data-jodit-temp[^>]+>(.+?)<\/\1>/gi,"$2")}static temporaryList(t){return ke(`[${v}]`,t)}}const ct=new Map,dt=t=>{var e;if(o(t.className))return t.className();const s=(null===(e=t.constructor)||void 0===e?void 0:e.originalConstructor)||t.constructor;if(ct.has(s))return ct.get(s);if(s.name)return s.name;const i=(""+s).match(/^\s*function\s*(\S*)\s*\(/);return i?i[1]:""},ut=t=>t.replace(/([-_])(.)/g,((t,e,s)=>s.toUpperCase())),pt=t=>t.replace(/([A-Z])([A-Z])([a-z])/g,"$1-$2$3").replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[\s_]+/g,"-").toLowerCase();function ft(t){return t.replace(/[\s\n\t\r\uFEFF\u200b]+$/g,"").replace(/^[\s\n\t\r\uFEFF\u200b]+/g,"")}function mt(t){return t.length?t[0].toUpperCase()+t.substr(1):""}class gt{constructor(){this.namespace="",this.safeMode=!1,this.safePluginsList=["about","enter","backspace"],this.license="",this.preset="custom",this.presets={inline:{inline:!0,toolbar:!1,toolbarInline:!0,toolbarInlineForSelection:!0,showXPathInStatusbar:!1,showCharsCounter:!1,showWordsCounter:!1,showPlaceholder:!1}},this.ownerDocument="undefined"!=typeof document?document:null,this.ownerWindow="undefined"!=typeof window?window:null,this.shadowRoot=null,this.styleValues={},this.zIndex=0,this.readonly=!1,this.disabled=!1,this.activeButtonsInReadOnly=["source","fullsize","print","about","dots","selectall"],this.toolbarButtonSize="middle",this.allowTabNavigation=!1,this.inline=!1,this.theme="default",this.saveModeInStorage=!1,this.spellcheck=!0,this.editorCssClass=!1,this.style=!1,this.triggerChangeEvent=!0,this.direction="",this.language="auto",this.debugLanguage=!1,this.i18n=!1,this.tabIndex=-1,this.toolbar=!0,this.statusbar=!0,this.showTooltip=!0,this.showTooltipDelay=1e3,this.useNativeTooltip=!1,this.enter="p",this.enterBlock="br"!==this.enter?this.enter:"p",this.defaultMode=1,this.useSplitMode=!1,this.colors={greyscale:["#000000","#434343","#666666","#999999","#B7B7B7","#CCCCCC","#D9D9D9","#EFEFEF","#F3F3F3","#FFFFFF"],palette:["#980000","#FF0000","#FF9900","#FFFF00","#00F0F0","#00FFFF","#4A86E8","#0000FF","#9900FF","#FF00FF"],full:["#E6B8AF","#F4CCCC","#FCE5CD","#FFF2CC","#D9EAD3","#D0E0E3","#C9DAF8","#CFE2F3","#D9D2E9","#EAD1DC","#DD7E6B","#EA9999","#F9CB9C","#FFE599","#B6D7A8","#A2C4C9","#A4C2F4","#9FC5E8","#B4A7D6","#D5A6BD","#CC4125","#E06666","#F6B26B","#FFD966","#93C47D","#76A5AF","#6D9EEB","#6FA8DC","#8E7CC3","#C27BA0","#A61C00","#CC0000","#E69138","#F1C232","#6AA84F","#45818E","#3C78D8","#3D85C6","#674EA7","#A64D79","#85200C","#990000","#B45F06","#BF9000","#38761D","#134F5C","#1155CC","#0B5394","#351C75","#733554","#5B0F00","#660000","#783F04","#7F6000","#274E13","#0C343D","#1C4587","#073763","#20124D","#4C1130"]},this.colorPickerDefaultTab="background",this.imageDefaultWidth=300,this.removeButtons=[],this.disablePlugins=[],this.extraPlugins=[],this.extraButtons=[],this.extraIcons={},this.createAttributes={},this.sizeLG=900,this.sizeMD=700,this.sizeSM=400,this.buttons=[{group:"font-style",buttons:[]},{group:"list",buttons:[]},{group:"font",buttons:[]},"---",{group:"script",buttons:[]},{group:"media",buttons:[]},"\n",{group:"state",buttons:[]},{group:"clipboard",buttons:[]},{group:"insert",buttons:[]},{group:"indent",buttons:[]},{group:"color",buttons:[]},{group:"form",buttons:[]},"---",{group:"history",buttons:[]},{group:"search",buttons:[]},{group:"source",buttons:[]},{group:"other",buttons:[]},{group:"info",buttons:[]}],this.buttonsMD=["bold","italic","|","ul","ol","eraser","|","font","fontsize","---","image","table","|","link","\n","brush","paragraph","align","|","hr","copyformat","fullsize","---","undo","redo","|","dots"],this.buttonsSM=["bold","italic","|","ul","ol","eraser","|","fontsize","brush","paragraph","---","image","table","\n","link","|","align","|","undo","redo","|","copyformat","fullsize","---","dots"],this.buttonsXS=["bold","brush","paragraph","eraser","|","fontsize","---","image","\n","align","undo","redo","|","link","table","---","dots"],this.events={},this.textIcons=!1,this.showBrowserColorPicker=!0}static get defaultOptions(){return gt.__defaultOptions||(gt.__defaultOptions=new gt),gt.__defaultOptions}}gt.prototype.controls={};let vt=1;const bt=new Set,wt=new c,yt={},Ct={},xt=new WeakMap;function jt(t,e,s="div",i=!1){const o=e?dt(e.prototype):"jodit-utils",n=xt.get(t)||{},r=o+s,a=E(t)?t:t.j;if(!n[r]){let e=a.c,l=S(t)&&t.o.shadowRoot?t.o.shadowRoot:t.od.body;if(i&&S(t)&&t.od!==t.ed){e=t.createInside;const i="style"===s?t.ed.head:t.ed.body;l=S(t)&&t.o.shadowRoot?t.o.shadowRoot:i}const h=e.element(s,{className:`jodit jodit-${pt(o)}-container jodit-box`});h.classList.add("jodit_theme_"+(a.o.theme||"default")),l.appendChild(h),n[r]=h,t.hookStatus("beforeDestruct",(()=>{ht.safeRemove(h),delete n[r],Object.keys(n).length&&xt.delete(t)})),xt.set(t,n)}return n[r].classList.remove("jodit_theme_default","jodit_theme_dark"),n[r].classList.add("jodit_theme_"+(a.o.theme||"default")),n[r]}const St=new B,Et=new Map;class _t{constructor(){this.ownerWindow=window,this.__componentStatus=h.beforeInit,this.uid="jodit-uid-"+(()=>{function t(){return vt+=10*(Math.random()+1),Math.round(vt).toString(16)}let e=t();for(;bt.has(e);)e=t();return bt.add(e),e})()}get componentName(){return this.__componentName||(this.__componentName="jodit-"+pt((o(this.className)?this.className():"")||dt(this))),this.__componentName}getFullElName(t,e,s){const i=[this.componentName];return t&&(t=t.replace(/[^a-z0-9-]/gi,"-"),i.push("__"+t)),e&&(i.push("_",e),i.push("_",a(s)?"true":""+s)),i.join("")}get ownerDocument(){return this.ow.document}get od(){return this.ownerDocument}get ow(){return this.ownerWindow}get(t,e){return l(t,e||this)}get isReady(){return this.componentStatus===h.ready}get isDestructed(){return this.componentStatus===h.destructed}get isInDestruct(){return h.beforeDestruct===this.componentStatus||h.destructed===this.componentStatus}bindDestruct(t){return t.hookStatus(h.beforeDestruct,(()=>!this.isInDestruct&&this.destruct())),this}destruct(){this.setStatus(h.destructed),Et.get(this)&&Et.delete(this)}get componentStatus(){return this.__componentStatus}set componentStatus(t){this.setStatus(t)}setStatus(t){return this.setStatusComponent(t,this)}setStatusComponent(t,e){if(t===this.__componentStatus)return;const s=Object.getPrototypeOf(this);s&&o(s.setStatusComponent)&&s.setStatusComponent(t,e);const i=Et.get(this),n=null==i?void 0:i[t];n&&n.length&&n.forEach((t=>t(e))),e===this&&(this.__componentStatus=t)}hookStatus(t,e){let s=Et.get(this);s||(s={},Et.set(this,s)),s[t]||(s[t]=[]),s[t].push(e)}}_t.STATUSES=h;class Tt extends _t{constructor(t){super(),this.setParentView(t)}get defaultTimeout(){return this.j.defaultTimeout}get j(){return this.jodit}i18n(t,...e){return this.j.i18n(t,...e)}setParentView(t){return this.jodit=t,t.components.add(this),this}destruct(){return this.j.components.delete(this),super.destruct()}}const It=new WeakMap,Nt=(t,e,s)=>{let i=It.get(t);if(!i){i={},It.set(t,i);let e=null;t instanceof Tt&&(e=t.j.e),E(t)&&(e=t.e),e&&e.on("beforeDestruct",(()=>{It.delete(t)}))}return void 0===s?i[e]:(i[e]=s,s)},kt=t=>{if(t){if(ht.isText(t)&&null!=t.nodeValue&&t.parentNode)for(;ht.isText(t.nextSibling);)null!=t.nextSibling.nodeValue&&(t.nodeValue+=t.nextSibling.nodeValue),t.nodeValue=t.nodeValue.replace(/[\uFEFF]/g,""),ht.safeRemove(t.nextSibling);else kt(t.firstChild);kt(t.nextSibling)}},Mt=(...t)=>t.filter((t=>ft(t).length)).map(((e,s)=>(e=e.replace(/([^:])[\\/]+/g,"$1/"),s&&(e=e.replace(/^\//,"")),s!==t.length-1&&(e=e.replace(/\/$/,"")),e))).join("/"),zt=(...t)=>t.filter((t=>t.length)).map((t=>t.replace(/\/$/,""))).join("/").replace(/([^:])[\\/]+/g,"$1/");function Rt(t,e){if("font-weight"===pt(t)){switch((""+e).toLowerCase()){case"700":case"bold":return 700;case"400":case"normal":return 400;case"900":case"heavy":return 900}return T(e)?Number(e):e}return/color/i.test(t)&&/^rgb/i.test(""+e)&&(t=>{if("rgba(0, 0, 0, 0)"===t||""===t)return!1;if(!t)return"#000000";if("#"===t.substr(0,1))return t;const e=/([\s\n\t\r]*?)rgb\((\d+), (\d+), (\d+)\)/.exec(t)||/([\s\n\t\r]*?)rgba\((\d+), (\d+), (\d+), ([\d.]+)\)/.exec(t);if(!e)return"#000000";const s=parseInt(e[2],10),i=parseInt(e[3],10);let o=(parseInt(e[4],10)|i<<8|s<<16).toString(16).toUpperCase();for(;6>o.length;)o="0"+o;return e[1]+"#"+o})(""+e)||e}function Lt(t,e,s,i=!1){const o=/^(left|top|bottom|right|width|min|max|height|margin|padding|fontsize|font-size)/i;if(x(s)&&(i=s,s=void 0),I(e)||void 0!==s){const i=(t,e,s)=>{!a(s)&&o.test(e)&&T(""+s)&&(s=parseInt(""+s,10)+"px"),void 0===s||null!=s&&Lt(t,e,!0)===Rt(e,s)||(t.style[e]=s)};if(I(e)){const s=Object.keys(e);for(let o=0;s.length>o;o+=1)i(t,ut(s[o]),e[s[o]])}else i(t,ut(e),s);return""}const n=pt(e),r=t.ownerDocument||document,l=!!r&&(r.defaultView||r.parentWindow),h=t.style[e];let c="";return void 0!==h&&""!==h?c=h:l&&!i&&(c=l.getComputedStyle(t).getPropertyValue(n)),o.test(e)&&/^[-+]?[0-9.]+px$/.test(""+c)&&(c=parseInt(""+c,10)),Rt(e,c)}function Ot(t,...e){return t(...e)}function Bt(t,e,s){if(!t||!o(t.getAttribute))return null;if(!r(e))return Object.keys(e).forEach((s=>{const i=e[s];I(i)&&"style"===s?Lt(t,i):("className"===s&&(s="class"),Bt(t,s,i))})),null;let i=(t=>t.replace(/([A-Z])([A-Z])([a-z])/g,"$1-$2$3").replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase())(e);if(/^-/.test(i)){const e=Bt(t,"data"+i);if(e)return e;i=i.substr(1)}if(void 0!==s){if(null!=s)return t.setAttribute(i,""+s),""+s;t.hasAttribute(i)&&t.removeAttribute(i)}return t.getAttribute(i)}const Ft={},Pt=(t,e=!0)=>{if(e)return Object.keys(t);const s=[];for(const e in t)s.push(e);return s},Dt=t=>("file:"===window.location.protocol&&/^\/\//.test(t)&&(t="https:"+t),t),Ht=new Map,At=t=>async(e,s)=>{if(Ht.has(s))return Ht.get(s);const i=t(e,s);return Ht.set(s,i),i},$t=At(((t,e)=>new Promise(((s,i)=>{const{element:n}=((t,e,s)=>{const i=t.c.element("script");return i.type="text/javascript",i.async=!0,o(s)&&!t.isInDestruct&&t.e.on(i,"load",s),i.src||(i.src=Dt(e)),t.od.body.appendChild(i),{callback:s,element:i}})(t,e,s);!t.isInDestruct&&t.e.on(n,"error",i)})))),Wt=At(((t,e)=>new Promise(((s,i)=>{const o=t.c.element("link");o.rel="stylesheet",o.media="all",o.crossOrigin="anonymous",!t.isInDestruct&&t.e.on(o,"load",(()=>s(o))).on(o,"error",i),o.href=Dt(e),t.o.shadowRoot?t.o.shadowRoot.appendChild(o):t.od.body.appendChild(o)})))),Ut=(t,e)=>{const s=[],i=encodeURIComponent;for(const o in t)if(Object.prototype.hasOwnProperty.call(t,o)){const n=e?e+"["+o+"]":o,r=t[o];s.push(I(r)?Ut(r,n):i(n)+"="+i(r))}return s.join("&")};function Vt(t){return t&&t.isAtom}function qt(t,e,s=0){if(Object.getPrototypeOf(t)!==Object.prototype)return t;const i=gt.defaultOptions;if(r(t.preset)){if(void 0!==i.presets[t.preset]){const e=i.presets[t.preset];Object.keys(e).forEach((s=>{a(t[s])&&(t[s]=e[s])}))}delete t.preset}const o={};return Object.keys(t).forEach((i=>{const n=t[i],r=e?e[i]:null;o[i]=I(n)&&I(r)&&!Vt(n)?qt(n,r,s+1):0!==s&&C(n)&&!Vt(n)&&C(r)?[...n,...r.slice(n.length)]:n})),Object.setPrototypeOf(o,e),o}function Gt(t){return Pt(t,!1).reduce(((e,s)=>(e[s]=t[s],e)),{})}const Xt=t=>{if("undefined"!=typeof navigator&&-1!==navigator.userAgent.indexOf("Mac OS X")){if(t.metaKey&&!t.altKey)return!0}else if(t.ctrlKey&&!t.altKey)return!0;return!1},Yt=(t,e="en")=>"auto"!==t&&r(t)?t:document.documentElement&&document.documentElement.lang?document.documentElement.lang:navigator.language?navigator.language.substr(0,2):e,Kt=t=>{if(/^[0-9.]+$/.test(""+t))return parseFloat(t);const e=t.substr(-2,2).toUpperCase(),s=["KB","MB","GB","TB"],i=parseFloat(t.substr(0,t.length-2));return-1!==s.indexOf(e)?i*Math.pow(1024,s.indexOf(e)+1):parseInt(t,10)},Zt=t=>C(t)?t:[t],Jt=(...t)=>{var e,s;return((s=Array.from)&&"function"===(typeof s).toLowerCase()&&(s===Function.prototype||/^\s*function\s*(\b[a-z$_][a-z0-9$_]*\b)*\s*\((|([a-z$_][a-z0-9$_]*)(\s*,[a-z$_][a-z0-9$_]*)*)\)\s*{\s*\[native code]\s*}\s*$/i.test(s+""))?Array.from:null!==(e=(t=>{var e,s;if(!(t in Ft)){const s=document.createElement("iframe");try{if(s.src="about:blank",document.body.appendChild(s),!s.contentWindow)return null;const i=l(t,s.contentWindow),n=l("Array",s.contentWindow);o(i)&&(Ft[t]=i.bind(n))}catch(t){}finally{null===(e=s.parentNode)||void 0===e||e.removeChild(s)}}return null!==(s=Ft[t])&&void 0!==s?s:null})("Array.from"))&&void 0!==e?e:Array.from).apply(Array,t)};class Qt{static getElm(t){return this.container.querySelector("."+this.getFullElName(t))}static getElms(t){return Jt(this.container.querySelectorAll("."+this.getFullElName(t)))}}class te{static setMod(t,e,s){if(t=t.toLowerCase(),this.mods[t]===e)return;const i=`${this.componentName}_${t}`,o=(s||this.container).classList;Jt(o).forEach((t=>{0===t.indexOf(i)&&o.remove(t)})),!a(e)&&""!==e&&o.add(`${i}_${(""+e).toLowerCase()}`),this.mods[t]=e}static getMod(t){var e;return null!==(e=this.mods[t])&&void 0!==e?e:null}}class ee{static getIcon(t){return/<svg/i.test(t)?t:ee.icons[t]||ee.icons[t.replace(/-/g,"_")]||ee.icons[t.replace(/_/g,"-")]||ee.icons[t.toLowerCase()]}static exists(t){return void 0!==this.getIcon(t)}static get(t,e="<span></span>"){return this.getIcon(t)||e}static set(t,e){return this.icons[t.replace("_","-")]=e,this}static makeIcon(t,e){var s;let i;if(e){const o=e.name.replace(/[^a-zA-Z0-9]/g,"_");if(e.iconURL)i=t.c.span(),Lt(i,"backgroundImage","url("+e.iconURL.replace("{basePath}",(null==t?void 0:t.basePath)||"")+")");else{const n=t.e.fire("getIcon",e.name,e,o)||ee.get(e.name,"")||(null===(s=t.o.extraIcons)||void 0===s?void 0:s[e.name]);n&&(i=t.c.fromHTML(n.trim()),/^<svg/i.test(e.name)||i.classList.add("jodit-icon_"+o))}}return i&&(i.classList.add("jodit-icon"),i.style.fill=e.fill),i}}ee.icons={};class se extends Tt{constructor(t,e){super(t),this.name="",this.__parentElement=null,this.mods={},this.container=this.createContainer(e),Object.defineProperty(this.container,"component",{value:this,configurable:!0})}get parentElement(){return this.__parentElement}set parentElement(t){this.__parentElement=t,t&&t.hookStatus("beforeDestruct",(()=>this.destruct())),this.updateParentElement(this)}bubble(t){let e=this.parentElement;for(;e;)t(e),e=e.parentElement;return this}updateParentElement(t){var e;return null===(e=this.__parentElement)||void 0===e||e.updateParentElement(t),this}get(t,e){return super.get(t,e)||this.getElm(t)}closest(t){const e="object"==typeof t?e=>e===t:e=>e instanceof t;let s=this.__parentElement;for(;s;){if(e(s))return s;s=!s.parentElement&&s.container.parentElement?se.closestElement(s.container.parentElement,se):s.parentElement}return null}static closestElement(t,e){const s=ht.up(t,(t=>{if(t){const{component:s}=t;return s&&s instanceof e}return!1}));return s?null==s?void 0:s.component:null}setMod(t,e,s=this.container){return te.setMod.call(this,t,e,s),this}getMod(t){return te.getMod.call(this,t)}getElm(t){return Qt.getElm.call(this,t)}getElms(t){return Qt.getElms.call(this,t)}update(){}appendTo(t){return t.appendChild(this.container),this}clearName(t){return t.replace(/[^a-zA-Z0-9]/g,"_")}render(t){return this.j.c.div(this.componentName)}createContainer(t){const e=this.render(t);if(r(e)){const t=this.j.c.fromHTML(e.replace(/\*([^*]+?)\*/g,((t,e)=>ee.get(e)||"")).replace(/&__/g,this.componentName+"__").replace(/~([^~]+?)~/g,((t,e)=>this.i18n(e))));return t.classList.add(this.componentName),t}return e}destruct(){return ht.safeRemove(this.container),this.parentElement=null,super.destruct()}}let ie=class extends se{constructor(t,e){super(t),this.isButton=!0,this.state={size:"middle",type:"button",name:"",value:"",variant:"initial",disabled:!1,activated:!1,icon:{name:"empty",fill:"",iconURL:""},tooltip:"",text:"",tabIndex:void 0},this.actionHandlers=[],this.updateSize(),this.onChangeSize(),this.onChangeStatus(),e&&this.hookStatus(h.ready,(()=>{this.setState(e)}))}className(){return"UIButton"}setState(t){return Object.assign(this.state,t),this}onChangeSize(){this.setMod("size",this.state.size)}onChangeType(){Bt(this.container,"type",this.state.type)}updateSize(){const t=this.closest(ue);t&&(this.state.size=t.buttonSize)}onChangeStatus(){this.setMod("variant",this.state.variant)}onChangeText(){this.text.textContent=this.jodit.i18n(this.state.text)}onChangeTextSetMode(){this.setMod("text-icons",!!this.state.text.trim().length)}onChangeDisabled(){Bt(this.container,"disabled",this.state.disabled||null)}onChangeActivated(){Bt(this.container,"aria-pressed",this.state.activated)}onChangeName(){this.container.classList.add(`${this.componentName}_${this.clearName(this.state.name)}`),this.name=this.state.name,Bt(this.container,"data-ref",this.state.name),Bt(this.container,"ref",this.state.name)}onChangeTooltip(){this.get("j.o.useNativeTooltip")&&Bt(this.container,"title",this.state.tooltip),Bt(this.container,"aria-label",this.state.tooltip)}onChangeTabIndex(){Bt(this.container,"tabindex",this.state.tabIndex)}onChangeIcon(){const t=this.get("j.o.textIcons");if(!0===t||o(t)&&t(this.state.name))return;ht.detach(this.icon);const e=ee.makeIcon(this.j,this.state.icon);e&&this.icon.appendChild(e)}focus(){this.container.focus()}isFocused(){const{activeElement:t}=this.od;return!(!t||!ht.isOrContains(this.container,t))}createContainer(){const t=this.componentName,e=this.j.c.element("button",{class:t,type:"button",role:"button",ariaPressed:!1});return this.icon=this.j.c.span(t+"__icon"),this.text=this.j.c.span(t+"__text"),e.appendChild(this.icon),e.appendChild(this.text),this.j.e.on(e,"click",this.onActionFire),e}destruct(){return this.j.e.off(this.container),super.destruct()}onAction(t){return this.actionHandlers.push(t),this}onActionFire(t){t.buffer={actionTrigger:this},this.actionHandlers.forEach((e=>e.call(this,t)))}};function oe(t,e,s,i){const o=new ie(t);return o.state.tabIndex=t.o.allowTabNavigation?0:-1,r(e)?(o.state.icon.name=e,o.state.name=e,i&&(o.state.variant=i),s&&(o.state.text=s)):o.setState(e),o}var ne;i([$("state.size")],ie.prototype,"onChangeSize",null),i([$("state.type")],ie.prototype,"onChangeType",null),i([$("parentElement")],ie.prototype,"updateSize",null),i([$("state.variant")],ie.prototype,"onChangeStatus",null),i([$("state.text")],ie.prototype,"onChangeText",null),i([$("state.text")],ie.prototype,"onChangeTextSetMode",null),i([$("state.disabled")],ie.prototype,"onChangeDisabled",null),i([$("state.activated")],ie.prototype,"onChangeActivated",null),i([$("state.name")],ie.prototype,"onChangeName",null),i([$("state.tooltip")],ie.prototype,"onChangeTooltip",null),i([$("state.tabIndex")],ie.prototype,"onChangeTabIndex",null),i([$("state.icon")],ie.prototype,"onChangeIcon",null),i([q],ie.prototype,"onActionFire",null),ie=i([y],ie);let re=ne=class extends se{constructor(t,e,s){super(t,s),this.options=s,this.syncMod=!1,this.elements=[],this.buttonSize="middle",null==e||e.forEach((t=>t&&this.append(t))),(null==s?void 0:s.name)&&(this.name=s.name)}className(){return"UIGroup"}get allChildren(){const t=[],e=[...this.elements];for(;e.length;){const s=e.shift();C(s)?e.push(...s):s instanceof ne?e.push(...s.elements):s&&t.push(s)}return t}update(){this.elements.forEach((t=>t.update())),this.setMod("size",this.buttonSize)}append(t,e){return C(t)?(t.forEach((t=>this.append(t,e))),this):(this.elements.push(t),t.name&&t.container.classList.add(this.getFullElName(t.name)),e?this.getElm(e).appendChild(t.container):this.appendChildToContainer(t.container),t.parentElement=this,t.update(),this)}setMod(t,e){return this.syncMod&&this.elements.forEach((s=>s.setMod(t,e))),super.setMod(t,e)}appendChildToContainer(t){this.container.appendChild(t)}remove(t){const e=this.elements.indexOf(t);return-1!==e&&(this.elements.splice(e,1),ht.safeRemove(t.container),t.parentElement=null),this}clear(){return this.elements.forEach((t=>t.destruct())),this.elements.length=0,this}destruct(){return this.clear(),super.destruct()}};function ae(t,e){let s;return e||(e=gt.defaultOptions.controls),r(t)?s=le(t,e)||{name:t,command:t,tooltip:t}:(s={name:"empty",...Gt(t)},void 0!==e[s.name]&&(s={...Gt(e[s.name]),...Gt(s)})),s}function le(t,e){let[s,i]=t.split(/\./),o=e;return null!=i?void 0!==e[s]&&(o=e[s]):i=s,o[i]?{name:i,...Gt(o[i])}:void 0}i([$("buttonSize")],re.prototype,"update",null),re=ne=i([y],re);let he=class extends se{className(){return"UISeparator"}};he=i([y],he);let ce=class extends se{className(){return"UISpacer"}};ce=i([y],ce);const de=t=>C(t.buttons);let ue=class extends re{constructor(t){super(t),this.mode="horizontal",this.removeButtons=[],this.onChangeMode()}className(){return"UIList"}onChangeMode(){this.setMod("mode",this.mode)}makeGroup(){return new re(this.jodit)}get buttons(){return this.allChildren.filter((t=>t instanceof ie))}getButtonsNames(){return this.buttons.map((t=>t instanceof ie&&t.state.name||"")).filter((t=>""!==t))}setRemoveButtons(t){return this.removeButtons=t||[],this}build(t,e=null){t=H(t),this.clear();let s,i=!1,o=this.makeGroup();this.append(o),o.setMod("line",!0);const n=t=>{let n=null;switch(t.name){case"\n":o=this.makeGroup(),o.setMod("line",!0),s=this.makeGroup(),o.append(s),this.append(o);break;case"|":i||(i=!0,n=new he(this.j));break;case"---":{s.setMod("before-spacer",!0);const t=new ce(this.j);o.append(t),s=this.makeGroup(),o.append(s),i=!1;break}default:i=!1,n=this.makeButton(t,e)}n&&(s||(s=this.makeGroup(),o.append(s)),s.append(n))},r=t=>!this.removeButtons.includes(t.name);return t.forEach((t=>{if(de(t)){const e=t.buttons.filter((t=>t));e.length&&(s=this.makeGroup(),s.setMod("separated",!0).setMod("group",t.group),o.append(s),((t,e)=>(C(t)?t:Pt(t,!1).map((e=>qt({name:e},t[e]||{})))).map((t=>ae(t,e||gt.defaultOptions.controls))))(e,this.j.o.controls).filter(r).forEach(n))}else{s||(s=this.makeGroup(),o.append(s));const e=ae(t,this.j.o.controls);r(e)&&n(e)}})),this.update(),this}makeButton(t,e){return new ie(this.j)}};i([$("mode")],ue.prototype,"onChangeMode",null),ue=i([y],ue);let pe=class extends re{constructor(t,e={radio:!0}){var s,i;super(t,null===(s=e.options)||void 0===s?void 0:s.map((e=>{const s=new ie(t,{text:e.text,value:e.value,variant:"primary"});return s.onAction((()=>{this.select(e.value)})),s})),e),this.options=e,this.select(null!==(i=e.value)&&void 0!==i?i:0)}className(){return"UIButtonGroup"}render(t){return`<div>\n\t\t\t<div class="&__label">~${t.label}~</div>\n\t\t\t<div class="&__options"></div>\n\t\t</div>`}appendChildToContainer(t){this.getElm("options").appendChild(t)}select(t){var e,s;this.elements.forEach(((e,s)=>{s===t||e.state.value===t?e.state.activated=!0:this.options.radio&&(e.state.activated=!1)}));const i=this.elements.filter((t=>t.state.activated)).map((t=>({text:t.state.text,value:t.state.value})));this.jodit.e.fire(this,"select",i),null===(s=(e=this.options).onChange)||void 0===s||s.call(e,i)}};pe=i([y],pe);class fe extends se{constructor(t,e=!0){super(t),this.smart=e,this.isOpened=!1,this.strategy="leftBottom",this.viewBound=()=>({left:0,top:0,width:this.ow.innerWidth,height:this.ow.innerHeight}),this.childrenPopups=new Set,Bt(this.container,"role","popup")}className(){return"Popup"}updateParentElement(t){return t!==this&&t instanceof fe&&(this.childrenPopups.forEach((e=>{!t.closest(e)&&e.isOpened&&e.close()})),this.childrenPopups.has(t)||this.j.e.on(t,"beforeClose",(()=>{this.childrenPopups.delete(t)})),this.childrenPopups.add(t)),super.updateParentElement(t)}setContent(t){ht.detach(this.container);const e=this.j.c.div(this.componentName+"__content");let s;return t instanceof se?(s=t.container,t.parentElement=this):s=r(t)?this.j.c.fromHTML(t):t,e.appendChild(s),this.container.appendChild(e),this.updatePosition(),this}open(t,e=!1){var s,i;Bt(i=this.container,"data-editor_id",(s=this.jodit).id),!i.component&&Object.defineProperty(i,"jodit",{value:s}),this.calculateZIndex(),this.isOpened=!0,this.addGlobalListeners(),this.targetBound=e?this.getKeepBound(t):t;const o=jt(this.jodit,fe);return o!==this.container.parentElement&&o.appendChild(this.container),this.updatePosition(),this.j.e.fire(this,"afterOpen"),this}calculateZIndex(){if(this.container.style.zIndex)return;const t=t=>{const e=t.container.style.zIndex||t.o.zIndex;return!!e&&(this.setZIndex(1+parseInt(""+e,10)),!0)};if(t(this.j))return;let e=this.parentElement;for(;e;){if(t(e.j))return;if(e.container.style.zIndex)return void this.setZIndex(1+parseInt(""+e.container.style.zIndex,10));if(!e.parentElement&&e.container.parentElement){const t=se.closestElement(e.container.parentElement,se);if(t){e=t;continue}}e=e.parentElement}}getKeepBound(t){const e=t(),s=this.od.elementFromPoint(e.left,e.top);if(!s)return t;const i=ht.isHTMLElement(s)?s:s.parentElement,o=Le(i,this.j);return()=>{const e=t(),s=Le(i,this.j);return{...e,top:e.top+(s.top-o.top),left:e.left+(s.left-o.left)}}}updatePosition(){if(!this.isOpened)return this;const[t,e]=this.calculatePosition(this.targetBound(),this.viewBound(),Le(this.container,this.j));return this.setMod("strategy",e),Lt(this.container,{left:t.left,top:t.top}),this.childrenPopups.forEach((t=>t.updatePosition())),this}throttleUpdatePosition(){this.updatePosition()}calculatePosition(t,e,s,i=this.strategy){const o={left:t.left,right:t.left-(s.width-t.width)},n={bottom:t.top+t.height,top:t.top-s.height},r=Object.keys(o).reduce(((t,e)=>t.concat(Object.keys(n).map((t=>`${e}${mt(t)}`)))),[]),a=t=>{const[e,i]=pt(t).split("-");return{left:o[e],top:n[i],width:s.width,height:s.height}},l=t=>{let e=null;return e=fe.boxInView(a(i),t)?i:r.find((e=>{if(fe.boxInView(a(e),t))return e}))||null,e};let h=l(Le(this.j.container,this.j));return h&&fe.boxInView(a(h),e)||(h=l(e)||h||i),[a(h),h]}static boxInView(t,e){return!(-2>t.top-e.top||-2>t.left-e.left||-2>e.top+e.height-(t.top+t.height)||-2>e.left+e.width-(t.left+t.width))}close(){return this.isOpened?(this.isOpened=!1,this.childrenPopups.forEach((t=>t.close())),this.j.e.fire(this,"beforeClose"),this.j.e.fire("beforePopupClose",this),this.removeGlobalListeners(),ht.safeRemove(this.container),this):this}closeOnOutsideClick(t){if(!this.isOpened)return;const e=o(t.composedPath)&&t.composedPath()[0]||t.target;if(!e)return void this.close();const s=se.closestElement(e,fe);s&&(this===s||s.closest(this))||this.close()}addGlobalListeners(){const t=this.throttleUpdatePosition,e=this.ow;St.on("closeAllPopups",this.close),this.smart&&this.j.e.on("escape",this.close).on("mousedown touchstart",this.closeOnOutsideClick).on(e,"mousedown touchstart",this.closeOnOutsideClick),this.j.e.on("closeAllPopups",this.close).on("resize",t).on(this.container,"scroll mousewheel",t).on(e,"scroll",t).on(e,"resize",t),ht.up(this.j.container,(e=>{e&&this.j.e.on(e,"scroll mousewheel",t)}))}removeGlobalListeners(){const t=this.throttleUpdatePosition,e=this.ow;St.off("closeAllPopups",this.close),this.smart&&this.j.e.off("escape",this.close).off("mousedown touchstart",this.closeOnOutsideClick).off(e,"mousedown touchstart",this.closeOnOutsideClick),this.j.e.off("closeAllPopups",this.close).off("resize",t).off(this.container,"scroll mousewheel",t).off(e,"scroll",t).off(e,"resize",t),ht.up(this.j.container,(e=>{e&&this.j.e.off(e,"scroll mousewheel",t)}))}setZIndex(t){this.container.style.zIndex=""+t}destruct(){return this.close(),super.destruct()}}i([q],fe.prototype,"updatePosition",null),i([z(10),q],fe.prototype,"throttleUpdatePosition",null),i([q],fe.prototype,"close",null),i([q],fe.prototype,"closeOnOutsideClick",null);let me=class extends re{constructor(...t){var e,s;super(...t),(null===(e=this.options)||void 0===e?void 0:e.className)&&this.container.classList.add(null===(s=this.options)||void 0===s?void 0:s.className)}className(){return"UIForm"}submit(){this.j.e.fire(this.container,"submit")}validate(){const t=this.allChildren.filter((t=>t instanceof ye));for(const e of t)if(!e.validate())return!1;const e=this.allChildren.filter((t=>t instanceof _e));for(const t of e)if(!t.validate())return!1;return!0}onSubmit(t){this.j.e.on(this.container,"submit",(()=>{const e=this.allChildren.filter((t=>t instanceof ye));return!!this.validate()&&(t(e.reduce(((t,e)=>(t[e.state.name]=e.value,t)),{})),!1)}))}createContainer(){const t=this.j.c.element("form");return t.classList.add(this.componentName),Bt(t,"dir",this.j.o.direction||"auto"),t}};me=i([y],me);const ge=t=>!!ft(t.value).length||(t.error="Please fill out this field",!1),ve=t=>!!(t=>{if(t.includes(" "))return!1;if("undefined"!=typeof URL)try{const e=new URL(t);return["https:","http:","ftp:","file:","rtmp:"].includes(e.protocol)}catch(t){return!1}const e=document.createElement("a");return e.href=t,!!e.hostname})(ft(t.value))||(t.error="Please enter a web address",!1),be=t=>!!ft(t.value).length||(t.error="Please fill out this field",!1);var we;let ye=we=class extends se{constructor(t,e){super(t,e),this.label=this.j.c.span(this.getFullElName("label")),this.icon=this.j.c.span(this.getFullElName("icon")),this.clearButton=this.j.c.span(this.getFullElName("clear"),ee.get("cancel")),this.state={...we.defaultState},this.__errorBox=this.j.c.span(this.getFullElName("error")),this.validators=new Set([]),void 0!==(null==e?void 0:e.value)&&(e.value=""+e.value),Object.assign(this.state,e),void 0!==this.state.clearButton&&(this.j.e.on(this.clearButton,"click",(t=>{t.preventDefault(),this.nativeInput.value="",this.j.e.fire(this.nativeInput,"input"),this.focus()})).on(this.nativeInput,"input",(()=>{this.state.clearButton=!!this.value.length})),this.state.clearButton=!!this.value.length),this.j.e.on(this.nativeInput,"focus blur",(()=>{this.onChangeFocus()})).on(this.nativeInput,"input change",this.onChangeValue),this.onChangeState(),this.onChangeClassName(),this.onChangeStateValue()}className(){return"UIInput"}onChangeClear(){this.state.clearButton?ht.after(this.nativeInput,this.clearButton):ht.safeRemove(this.clearButton)}onChangeClassName(t,e){e&&this.container.classList.remove(e),this.state.className&&this.container.classList.add(this.state.className)}onChangeState(){this.name=this.state.name;const t=this.nativeInput,{name:e,icon:s,type:i,ref:o,required:n,placeholder:r,autocomplete:a,label:l}=this.state;Bt(t,"name",e),Bt(t,"type",i),Bt(t,"data-ref",o||e),Bt(t,"ref",o||e),Bt(t,"required",n||null),Bt(t,"autocomplete",a?null:"off"),Bt(t,"placeholder",r?this.j.i18n(r):""),s&&ee.exists(s)?(ht.before(t,this.icon),this.icon.innerHTML=ee.get(s)):ht.safeRemove(this.icon),l?(ht.before(this.wrapper,this.label),this.label.innerText=this.j.i18n(l)):ht.safeRemove(this.label),this.updateValidators()}updateValidators(){var t;this.validators.clear(),this.state.required&&this.validators.add(ge),null===(t=this.state.validators)||void 0===t||t.forEach((t=>{const e=s[t];e&&this.validators.add(e)}))}set error(t){this.setMod("has-error",!!t),t?(this.__errorBox.innerText=this.j.i18n(t,this.j.i18n(this.state.label||"")),this.container.appendChild(this.__errorBox)):ht.safeRemove(this.__errorBox)}get value(){return this.nativeInput.value}set value(t){this.value!==t&&(this.nativeInput.value=t,this.onChangeValue())}onChangeStateValue(){const t=""+this.state.value;t!==this.value&&(this.value=t)}onChangeValue(){var t,e;const{value:s}=this;this.state.value!==s&&(this.state.value=s,this.j.e.fire(this,"change",s),null===(e=(t=this.state).onChange)||void 0===e||e.call(t,s))}validate(){return this.error="",Jt(this.validators).every((t=>t(this)))}createContainer(t){const e=super.createContainer();this.wrapper=this.j.c.div(this.getFullElName("wrapper")),this.nativeInput||(this.nativeInput=this.createNativeInput());const{nativeInput:s}=this;return s.classList.add(this.getFullElName("input")),this.wrapper.appendChild(s),e.appendChild(this.wrapper),Bt(s,"dir",this.j.o.direction||"auto"),e}createNativeInput(t){return this.j.create.element("input")}focus(){this.nativeInput.focus()}get isFocused(){return this.nativeInput===this.j.od.activeElement}onChangeFocus(){this.setMod("focused",this.isFocused)}};var Ce;ye.defaultState={className:"",autocomplete:!0,name:"",value:"",icon:"",label:"",ref:"",type:"text",placeholder:"",required:!1,validators:[]},i([$("state.clearButton")],ye.prototype,"onChangeClear",null),i([$("state.className")],ye.prototype,"onChangeClassName",null),i([$(["state.name","state.type","state.label","state.placeholder","state.autocomplete","state.icon"]),M()],ye.prototype,"onChangeState",null),i([$("state.value")],ye.prototype,"onChangeStateValue",null),i([q],ye.prototype,"onChangeValue",null),ye=we=i([y],ye);let xe=Ce=class extends ye{constructor(t,e){super(t,e),this.state={...Ce.defaultState},Object.assign(this.state,e),!1===this.state.resizable&&(this.nativeInput.style.resize="none")}className(){return"UITextArea"}createContainer(t){return this.nativeInput=this.j.create.element("textarea"),super.createContainer(t)}};var je;xe.defaultState={...ye.defaultState,size:5,resizable:!0},xe=Ce=i([y],xe);let Se=je=class extends ye{constructor(t,e){super(t,{...e,type:"checkbox"}),this.state={...je.defaultState},Object.assign(this.state,e)}className(){return"UICheckbox"}render(){return this.j.c.element("label",{className:this.componentName})}onChangeChecked(){this.value=""+this.state.checked,this.nativeInput.checked=this.state.checked,this.setMod("checked",this.state.checked)}onChangeNativeCheckBox(){this.state.checked=this.nativeInput.checked}onChangeSwitch(){this.setMod("switch",this.state.switch);let t=this.getElm("switch-slider");this.state.switch?(t||(t=this.j.c.div(this.getFullElName("switch-slider"))),ht.after(this.nativeInput,t)):ht.safeRemove(t)}};var Ee;Se.defaultState={...ye.defaultState,checked:!1,switch:!1},i([$("state.checked"),R("ready")],Se.prototype,"onChangeChecked",null),i([$("nativeInput:change")],Se.prototype,"onChangeNativeCheckBox",null),i([$("state.switch"),R("ready")],Se.prototype,"onChangeSwitch",null),Se=je=i([y],Se);let _e=Ee=class extends ye{constructor(t,e){super(t,e),this.state={...Ee.defaultState},Object.assign(this.state,e)}className(){return"UISelect"}createContainer(t){var e;const s=super.createContainer(t),{j:i}=this,{nativeInput:o}=this,n=()=>i.create.element("option");if(void 0!==t.placeholder){const e=n();e.value="",e.text=i.i18n(t.placeholder),o.add(e)}return null===(e=t.options)||void 0===e||e.forEach((t=>{const e=n();e.value=""+t.value,e.text=i.i18n(t.text),o.add(e)})),t.size&&t.size>0&&Bt(o,"size",t.size),t.multiple&&Bt(o,"multiple",""),s}createNativeInput(){return this.j.create.element("select")}updateValidators(){super.updateValidators(),this.state.required&&(this.validators.delete(ge),this.validators.add(be))}};_e.defaultState={...ye.defaultState,options:[],size:1,multiple:!1},_e=Ee=i([y],_e);let Te=class extends ye{constructor(t,e){super(t,{type:"file",...e}),this.state={...ye.defaultState,type:"file",onlyImages:!0}}className(){return"UIFileInput"}createContainer(t){this.button=new ie(this.j,{icon:{name:"plus"}});const{container:e}=this.button;this.nativeInput||(this.nativeInput=this.createNativeInput(t));const{nativeInput:s}=this;return s.classList.add(this.getFullElName("input")),e.classList.add(this.componentName),e.appendChild(s),e}createNativeInput(t){return this.j.create.fromHTML(`<input\n\t\t\ttype="file"\n\t\t\taccept="${t.onlyImages?"image/*":"*"}"\n\t\t\ttabindex="-1"\n\t\t\tdir="auto"\n\t\t\tmultiple=""\n\t\t/>`)}};Te=i([y],Te);let Ie=class extends re{constructor(t,e,s={align:"left"}){super(t,e),this.options=s,this.setMod("align",this.options.align||"left"),this.setMod("width",this.options.width||""),this.options.mod&&this.setMod(this.options.mod,!0),this.options.className&&this.container.classList.add(this.options.className),Bt(this.container,"data-ref",s.ref),Bt(this.container,"ref",s.ref)}className(){return"UIBlock"}};Ie=i([y],Ie);class Ne extends se{className(){return"ProgressBar"}render(){return"<div><div></div></div>"}show(){return(this.j.workplace||this.j.container).appendChild(this.container),this}hide(){return ht.safeRemove(this.container),this}progress(t){return this.container.style.width=t.toFixed(2)+"%",this}destruct(){return this.hide(),super.destruct()}}function ke(t,e){let s;return s=e.querySelectorAll(t),[].slice.call(s)}const Me=t=>(t instanceof se&&(t=t.container),ke("[ref],[data-ref]",t).reduce(((t,e)=>{const s=Bt(e,"-ref");return s&&r(s)&&(t[ut(s)]=e,t[s]=e),t}),{}));function ze(t){window.clearTimeout(t)}function Re(t){if(!t)return null;const e=ht.isHTMLElement(t),s=e&&Lt(t,"overflowY");return e&&"visible"!==s&&"hidden"!==s&&t.scrollHeight>=t.clientHeight?t:Re(t.parentNode)||document.scrollingElement||document.body}function Le(t,e,s=!1){const i=t.getBoundingClientRect();let o=i.left,n=i.top;if(S(e)&&e.iframe&&!s){const{left:t,top:s}=Le(e.iframe,e,!0);o+=t,n+=s}return{left:Math.round(o),top:Math.round(n),width:Math.round(t.offsetWidth),height:Math.round(t.offsetHeight)}}class Oe{constructor(){var t,e,s,i;this.timers=new Map,this.promisesRejections=new Set,this.requestsIdle=new Set,this.requestIdleCallbackNative=null!==(e=null===(t=window.requestIdleCallback)||void 0===t?void 0:t.bind(window))&&void 0!==e?e:t=>{const e=Date.now();return this.setTimeout((()=>{t({didTimeout:!1,timeRemaining(){return Math.max(0,50-(Date.now()-e))}})}),1)},this.cancelIdleCallbackNative=null!==(i=null===(s=window.cancelIdleCallback)||void 0===s?void 0:s.bind(window))&&void 0!==i?i:t=>{this.clearTimeout(t)},this.isDestructed=!1}delay(t){return this.promise((e=>this.setTimeout(e,t)))}setTimeout(t,e,...s){if(this.isDestructed)return 0;let i={};_(e)||(i=e,e=i.timeout||0),i.label&&this.clearLabel(i.label);const o=((t,e,...s)=>e?window.setTimeout(t,e,...s):(t.call(null,...s),0))(t,e,...s);return this.timers.set(i.label||o,o),o}clearLabel(t){t&&this.timers.has(t)&&(ze(this.timers.get(t)),this.timers.delete(t))}clearTimeout(t){if(r(t))return this.clearLabel(t);ze(t),this.timers.delete(t)}debounce(t,e,s=!1){let i=0,r=!1;const a=[],l=(...e)=>{if(!r){i=0;const s=t(...e);if(r=!0,a.length){const t=()=>{a.forEach((t=>t())),a.length=0};n(s)?s.finally(t):t()}}},h=(...n)=>{r=!1,e?(!i&&s&&l(...n),ze(i),i=this.setTimeout((()=>l(...n)),o(e)?e():e),this.timers.set(t,i)):l(...n)};return I(e)&&e.promisify?(...t)=>{const e=this.promise((t=>{a.push(t)}));return h(...t),e}:h}throttle(t,e,s=!1){let i,n,r,a=null;return(...s)=>{i=!0,r=s,e?a||(n=()=>{i?(t(...r),i=!1,a=this.setTimeout(n,o(e)?e():e),this.timers.set(n,a)):a=null},n()):t(...r)}}promise(t){let e=()=>{};const s=new Promise(((s,i)=>(this.promisesRejections.add(i),e=i,t(s,i))));return s.finally((()=>{this.promisesRejections.delete(e)})),s.rejectCallback=e,s}promiseState(t){if(t.status)return t.status;if(!Promise.race)return new Promise((e=>{t.then((t=>(e("fulfilled"),t)),(t=>{throw e("rejected"),t})),this.setTimeout((()=>{e("pending")}),100)}));const e={};return Promise.race([t,e]).then((t=>t===e?"pending":"fulfilled"),(()=>"rejected"))}requestIdleCallback(t){const e=this.requestIdleCallbackNative(t);return this.requestsIdle.add(e),e}requestIdlePromise(){return this.promise((t=>{const e=this.requestIdleCallback((()=>t(e)))}))}cancelIdleCallback(t){return this.requestsIdle.delete(t),this.cancelIdleCallbackNative(t)}clear(){this.requestsIdle.forEach((t=>{this.cancelIdleCallback(t)})),this.timers.forEach((t=>{ze(this.timers.get(t))})),this.timers.clear(),this.promisesRejections.forEach((t=>{t()})),this.promisesRejections.clear()}destruct(){this.clear(),this.isDestructed=!0}}class Be{constructor(t,e,s,i){this.request=t,this.status=e,this.statusText=s,this.body=i}get url(){return this.request.url}async json(){return JSON.parse(this.body)}text(){return Promise.resolve(this.body)}async blob(){return this.body}}gt.prototype.defaultAjaxOptions={successStatuses:[200,201,202],dataType:"json",method:"GET",url:"",data:null,contentType:"application/x-www-form-urlencoded; charset=UTF-8",headers:{"X-REQUESTED-WITH":"XMLHttpRequest"},withCredentials:!1,xhr:()=>new XMLHttpRequest};class Fe{constructor(t,e){this.jodit=t,this.resolved=!1,this.activated=!1,this.options=qt(e||{},gt.prototype.defaultAjaxOptions),this.xhr=this.o.xhr?this.o.xhr():new XMLHttpRequest,t&&t.e&&t.e.on("beforeDestruct",(()=>this.destruct()))}__buildParams(t,e){return o(this.o.queryBuild)?this.o.queryBuild.call(this,t,e):r(t)||this.j.ow.FormData&&t instanceof this.j.ow.FormData?t:Ut(t)}get o(){return this.options}get j(){return this.jodit}abort(){try{this.xhr.abort()}catch(t){}return this}send(){this.activated=!0;const{xhr:t,o:e}=this,s=this.prepareRequest();return this.j.async.promise(((i,o)=>{var n;const r=()=>{o(k("Connection error"))},a=()=>{this.resolved=!0,i(new Be(s,t.status,t.statusText,t.responseType?t.response:t.responseText))};t.onload=a,t.onabort=r,t.onerror=r,t.ontimeout=r,e.responseType&&(t.responseType=e.responseType),t.onprogress=t=>{var e,s;let i=0;t.lengthComputable&&(i=t.loaded/t.total*100),null===(s=(e=this.options).onProgress)||void 0===s||s.call(e,i)},t.onreadystatechange=()=>{var s,i;null===(i=(s=this.options).onProgress)||void 0===i||i.call(s,10),t.readyState===XMLHttpRequest.DONE&&(e.successStatuses.includes(t.status)?a():o(k(t.statusText||"Connection error")))},t.withCredentials=null!==(n=e.withCredentials)&&void 0!==n&&n;const{url:l,data:h,method:c}=s;t.open(c,l,!0),e.contentType&&t.setRequestHeader&&t.setRequestHeader("Content-type",e.contentType);const{headers:d}=e;d&&t.setRequestHeader&&Object.keys(d).forEach((e=>{t.setRequestHeader(e,d[e])})),this.j.async.setTimeout((()=>{t.send(h?this.__buildParams(h):void 0)}),0)}))}prepareRequest(){if(!this.o.url)throw k("Need URL for AJAX request");let t=this.o.url;const e=this.o.data,s=(this.o.method||"get").toLowerCase();if("get"===s&&e&&I(e)){const s=t.indexOf("?");if(-1!==s){const i=(t=>{const e={},s=t.substr(1).split("&");for(let t=0;s.length>t;t+=1){const i=s[t].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]||"")}return e})(t);t=t.substr(0,s)+"?"+Ut({...i,...e})}else t+="?"+Ut(this.o.data)}const i={url:t,method:s,data:e};return Fe.log.splice(100),Fe.log.push(i),i}destruct(){this.activated&&!this.resolved&&(this.abort(),this.resolved=!0)}}Fe.log=[];class Pe extends fe{className(){return"ContextMenu"}show(t,e,s){const i=this,o=this.j.c.div(this.getFullElName("actions"));C(s)&&(s.forEach((t=>{if(!t)return;const e=oe(this.jodit,t.icon||"empty",t.title);this.jodit&&e.setParentView(this.jodit),e.setMod("context","menu"),e.onAction((e=>{var s;return null===(s=t.exec)||void 0===s||s.call(i,e),i.close(),!1})),o.appendChild(e.container)})),super.setContent(o).open((()=>({left:t,top:e,width:0,height:0})),!0))}}const De=(()=>{let t;return()=>(void 0===t&&(t=(()=>{const t="___Jodit___"+Math.random();try{localStorage.setItem(t,"1");const e="1"===localStorage.getItem(t);return localStorage.removeItem(t),e}catch(t){}return!1})()),t)})();class He{constructor(t){this.rootKey=t}set(t,e){try{const s=localStorage.getItem(this.rootKey),i=s?JSON.parse(s):{};i[t]=e,localStorage.setItem(this.rootKey,JSON.stringify(i))}catch(t){}return this}delete(t){try{localStorage.removeItem(this.rootKey)}catch(t){}return this}get(t){try{const e=localStorage.getItem(this.rootKey),s=e?JSON.parse(e):{};return void 0!==s[t]?s[t]:null}catch(t){}}exists(t){return null!=this.get(t)}clear(){try{localStorage.removeItem(this.rootKey)}catch(t){}return this}}class Ae{constructor(){this.data=new Map}set(t,e){return this.data.set(t,e),this}delete(t){return this.data.delete(t),this}get(t){return this.data.get(t)}exists(t){return this.data.has(t)}clear(){return this.data.clear(),this}}const $e="Jodit_";class We{constructor(t,e){this.provider=t,this.prefix=$e,e&&(this.prefix+=e)}set(t,e){return this.provider.set(ut(this.prefix+t),e),this}delete(t){return this.provider.delete(ut(this.prefix+t)),this}get(t){return this.provider.get(ut(this.prefix+t))}exists(t){return this.provider.exists(ut(this.prefix+t))}clear(){return this.provider.clear(),this}static makeStorage(t=!1,e){let s;return t&&De()&&(s=new He($e+e)),s||(s=new Ae),new We(s,e)}}class Ue extends _t{constructor(t,e=!1){super(),this.isJodit=e,this.isView=!0,this.mods={},this.components=new Set,this.version="3.14.2",this.async=new Oe,this.buffer=We.makeStorage(),this.storage=We.makeStorage(!0,this.componentName),this.OPTIONS=Ue.defaultOptions,this.__isFullSize=!1,this.__whoLocked="",this.isLockedNotBy=t=>this.isLocked&&this.__whoLocked!==t,this.__modulesInstances=new Map,this.id=""+(new Date).getTime(),this.buffer=We.makeStorage(),this.initOptions(t),this.initOwners(),this.events=new B(this.od),this.create=new es(this.od),this.container=this.c.div(),this.container.classList.add("jodit"),this.progressbar=new Ne(this)}setMod(...[t,e]){return te.setMod.call(this,t,e),this}getMod(t){return te.getMod.call(this,t)}getElm(t){return Qt.getElm.call(this,t)}getElms(t){return Qt.getElms.call(this,t)}get basePath(){return this.o.basePath?this.o.basePath:g}get defaultTimeout(){return a(this.o.defaultTimeout)?100:this.o.defaultTimeout}get c(){return this.create}get container(){return this.__container}set container(t){this.__container=t}get e(){return this.events}get options(){return this.__options}set options(t){this.__options=t}get o(){return this.options}i18n(t,...e){return((t,e,s)=>{if(!r(t))throw k("i18n: Need string in first argument");if(!t.length)return t;const i=!(void 0===s||!s.debugLanguage);let o;const n=t=>e&&e.length?((t,e)=>{if(!e||!e.length)return t;const s=/%([sd])/g;let i=s.exec(t),o=t,n=0;for(;i&&void 0!==e[n];)o=o.replace(i[0],""+e[n]),n+=1,i=s.exec(t);return o})(t,e):t,a=Yt(gt.defaultOptions.language,gt.defaultOptions.language),l=Yt(null==s?void 0:s.language,a),h=e=>{if(!e)return;if(r(e[t]))return n(e[t]);const s=t.toLowerCase();if(r(e[s]))return n(e[s]);const i=mt(t);return r(e[i])?n(e[i]):void 0};o=void 0!==Ct[l]?Ct[l]:void 0!==Ct[a]?Ct[a]:Ct.en;const c=null==s?void 0:s.i18n;if(c&&c[l]){const t=h(c[l]);if(t)return t}return h(o)||(Ct.en&&r(Ct.en[t])&&Ct.en[t]?n(Ct.en[t]):i?"{"+t+"}":n(t))})(t,e,this.options)}toggleFullSize(t){void 0===t&&(t=!this.__isFullSize),t!==this.__isFullSize&&(this.__isFullSize=t,this.events&&this.e.fire("toggleFullSize",t))}get isLocked(){return""!==this.__whoLocked}lock(t="any"){return!this.isLocked&&(this.__whoLocked=t,!0)}unlock(){return!!this.isLocked&&(this.__whoLocked="",!0)}get isFullSize(){return this.__isFullSize}getVersion(){return"3.14.2"}static getVersion(){return"3.14.2"}initOptions(t){this.options=qt(t||{},qt(this.options||{},Ue.defaultOptions))}initOwners(){var t;this.ownerWindow=null!==(t=this.o.ownerWindow)&&void 0!==t?t:window}attachEvents(t){if(!t)return;const e=null==t?void 0:t.events;e&&Object.keys(e).forEach((t=>this.e.on(t,e[t])))}getInstance(t,e){const s=this.e.fire(ut("getInstance_"+t),e);if(s)return s;const i=yt[t],n=this.__modulesInstances;if(!o(i))throw k("Need real module name");if(!n.has(t)){const s=i.prototype instanceof Tt?new i(this,e):new i(e);this.components.add(s),n.set(t,s)}return n.get(t)}addDisclaimer(t){this.container.appendChild(t)}beforeDestruct(){this.e.fire(h.beforeDestruct,this),this.components.forEach((t=>{j(t)&&!t.isInDestruct&&t.destruct()})),this.components.clear()}destruct(){this.isDestructed||(this.async&&this.async.destruct(),this.events&&this.e.destruct(),this.buffer&&this.buffer.clear(),ht.safeRemove(this.container),super.destruct())}}i([R(h.beforeDestruct)],Ue.prototype,"beforeDestruct",null),Ue.defaultOptions={extraButtons:[],textIcons:!1,namespace:"",removeButtons:[],zIndex:100002,defaultTimeout:100,fullsize:!1,showTooltip:!0,useNativeTooltip:!1,buttons:[],globalFullSize:!0};let Ve=class extends ue{constructor(t){super(t),this.listenEvents="updateToolbar changeStack mousedown mouseup keydown change afterInit readonly afterResize selectionchange changeSelection focus afterSetMode touchstart focus blur",this.update=this.j.async.debounce(this.immediateUpdate,(()=>this.j.defaultTimeout)),this.initEvents()}className(){return"ToolbarCollection"}get firstButton(){const[t]=this.buttons;return t||null}makeButton(t,e=null){return((t,e,s=null)=>{if(o(e.getContent))return new Xe(t,e,s);const i=new Ge(t,e,s);return i.state.tabIndex=t.o.allowTabNavigation?0:-1,i})(this.j,t,e)}shouldBeActive(t){}shouldBeDisabled(t){}getTarget(t){return t.target||null}immediateUpdate(){this.isDestructed||this.j.isLocked||(super.update(),this.j.e.fire("afterUpdateToolbar"))}setDirection(t){this.container.style.direction=t,this.container.setAttribute("dir",t)}initEvents(){this.j.e.on(this.listenEvents,this.update).on("afterSetMode focus",this.immediateUpdate)}hide(){this.container.remove()}show(){this.appendTo(this.j.toolbarContainer)}showInline(t){throw k("The method is not implemented for this class.")}build(t,e=null){const s=this.j.e.fire("beforeToolbarBuild",t);return s&&(t=s),super.build(t,e),this}destruct(){this.isDestructed||(this.j.e.off(this.listenEvents,this.update).off("afterSetMode focus",this.immediateUpdate),super.destruct())}};i([q],Ve.prototype,"immediateUpdate",null),Ve=i([y],Ve);let qe=class extends Ve{constructor(t){super(t),this.checkActiveStatus=(t,e)=>{let s=0,i=0;return Object.keys(t).forEach((n=>{const r=t[n];o(r)?r(this.j,""+Lt(e,n))&&(s+=1):-1!==r.indexOf(""+Lt(e,n))&&(s+=1),i+=1})),i===s},this.prependInvisibleInput(this.container)}className(){return"ToolbarEditorCollection"}shouldBeDisabled(t){const e=super.shouldBeDisabled(t);if(void 0!==e)return e;const s=void 0===t.control.mode?1:t.control.mode;return!(3===s||s===this.j.getRealMode())}shouldBeActive(t){const e=super.shouldBeActive(t);if(void 0!==e)return e;const s=this.j.selection?this.j.s.current():null;if(!s)return!1;let i;if(t.control.tags){const e=t.control.tags;if(i=s,ht.up(i,(t=>{if(t&&-1!==e.indexOf(t.nodeName.toLowerCase()))return!0}),this.j.editor))return!0}if(t.control.css){const e=t.control.css;if(i=s,ht.up(i,(t=>{if(t&&!ht.isText(t))return this.checkActiveStatus(e,t)}),this.j.editor))return!0}return!1}getTarget(t){return t.target||this.j.s.current()||null}prependInvisibleInput(t){const e=this.j.create.element("input",{tabIndex:-1,disabled:!0,style:"width: 0; height:0; position: absolute; visibility: hidden;"});ht.appendChildFirst(t,e)}showInline(t){this.jodit.e.fire("showInlineToolbar",t)}hide(){this.jodit.e.fire("hidePopup"),super.hide(),this.jodit.e.fire("toggleToolbar")}show(){super.show(),this.jodit.e.fire("toggleToolbar")}};qe=i([y],qe);let Ge=class extends ie{constructor(t,e,s=null){super(t),this.control=e,this.target=s,this.state={size:"middle",type:"button",name:"",value:"",variant:"initial",disabled:!1,activated:!1,icon:{name:"empty",fill:"",iconURL:""},tooltip:"",text:"",tabIndex:void 0,theme:"toolbar",currentValue:"",hasTrigger:!1},t.e.on([this.button,this.trigger],"mousedown",(t=>t.preventDefault())),this.onAction(this.onClick),this.hookStatus(h.ready,(()=>{this.initFromControl(),this.initTooltip(),this.update()}))}className(){return"ToolbarButton"}get toolbar(){return this.closest(Ve)}get button(){return this.container.querySelector(`button.${this.componentName}__button`)}update(){const{control:t,state:e}=this,s=this.closest(Ve);e.disabled=this.calculateDisabledStatus(s),e.activated=this.calculateActivatedStatus(s),o(t.update)&&t.update(this),super.update()}calculateActivatedStatus(t){return!(S(this.j)&&!this.j.editorIsActive||(!o(this.control.isActive)||!this.control.isActive(this.j,this.control,this))&&(!t||!t.shouldBeActive(this)))}calculateDisabledStatus(t){return!(!this.j.o.disabled&&(!this.j.o.readonly||this.j.o.activeButtonsInReadOnly&&this.j.o.activeButtonsInReadOnly.includes(this.control.name))&&(!o(this.control.isDisabled)||!this.control.isDisabled(this.j,this.control,this))&&(!t||!t.shouldBeDisabled(this)))}onChangeActivated(){Bt(this.button,"aria-pressed",this.state.activated),super.onChangeActivated()}onChangeText(){o(this.control.template)?this.text.innerHTML=this.control.template(this.j,this.control.name,this.j.i18n(this.state.text)):super.onChangeText(),this.setMod("text-icons",!!this.text.innerText.trim().length)}onChangeTabIndex(){Bt(this.button,"tabindex",this.state.tabIndex)}onChangeTooltip(){Bt(this.button,"aria-label",this.state.tooltip),super.onChangeTooltip()}createContainer(){const t=this.componentName,e=this.j.c.span(t),s=super.createContainer();return Bt(e,"role","listitem"),s.classList.remove(t),s.classList.add(t+"__button"),Object.defineProperty(s,"component",{value:this}),e.appendChild(s),this.trigger=this.j.c.fromHTML(`<span role="trigger" class="${t}__trigger">${ee.get("chevron")}</span>`),this.j.e.on(this.trigger,"click",this.onTriggerClick.bind(this)),e}focus(){var t;null===(t=this.container.querySelector("button"))||void 0===t||t.focus()}onChangeHasTrigger(){this.state.hasTrigger?this.container.appendChild(this.trigger):ht.safeRemove(this.trigger),this.setMod("with-trigger",this.state.hasTrigger||null)}onChangeDisabled(){const t=this.state.disabled?"disabled":null;Bt(this.trigger,"disabled",t),Bt(this.button,"disabled",t),Bt(this.container,"disabled",t)}initTooltip(){this.j.o.textIcons||!this.j.o.showTooltip||this.j.o.useNativeTooltip||this.j.e.off(this.container,"mouseenter mouseleave").on(this.container,"mousemove",(t=>{this.state.tooltip&&!this.state.disabled&&this.j.e.fire("delayShowTooltip",(()=>({x:t.clientX+10,y:t.clientY+10})),this.state.tooltip)})).on(this.container,"mouseleave",(()=>{this.j.e.fire("hideTooltip")}))}initFromControl(){var t;const{control:e,state:s}=this;this.updateSize(),s.name=e.name;const{textIcons:i}=this.j.o;if(!0===i||o(i)&&i(e.name)||e.template)s.icon={name:"empty",fill:"",iconURL:""},s.text=e.text||e.name;else{if(e.iconURL)s.icon.iconURL=e.iconURL;else{const i=e.icon||e.name;s.icon.name=ee.exists(i)||(null===(t=this.j.o.extraIcons)||void 0===t?void 0:t[i])?i:""}e.iconURL||s.icon.name||(s.text=e.text||e.name)}e.tooltip&&(s.tooltip=this.j.i18n(o(e.tooltip)?e.tooltip(this.j,e,this):e.tooltip)),s.hasTrigger=!!(e.list||e.popup&&e.exec)}onTriggerClick(t){var e,s,i;const{control:n}=this;if(t.buffer={actionTrigger:this},n.list)return this.openControlList(n);if(o(n.popup)){const t=new fe(this.j);if(t.parentElement=this,!1!==this.j.e.fire(ut(`before-${n.name}-open-popup`),this.target,n,t)){const o=null!==(i=null!==(s=null===(e=this.toolbar)||void 0===e?void 0:e.getTarget(this))&&void 0!==s?s:this.target)&&void 0!==i?i:null,a=n.popup(this.j,o,n,t.close,this);a&&t.setContent(r(a)?this.j.c.fromHTML(a):a).open((()=>Le(this.container)))}this.j.e.fire(ut(`after-${n.name}-open-popup`),t.container)}}openControlList(t){var e;const s=null!==(e=this.jodit.options.controls)&&void 0!==e?e:{},i=t=>le(t,s),o=t.list,n=new fe(this.j),a=Ye(this.j);n.parentElement=this,a.parentElement=n,a.mode="vertical";const l=(e,s)=>{if(r(s)&&i(s))return{name:""+s,...i(s)};if(r(e)&&i(e))return{name:""+e,...i(e),..."object"==typeof s?s:{}};const o={name:""+e,template:t.childTemplate,exec:t.exec,data:t.data,command:t.command,isActive:t.isChildActive,isDisabled:t.isChildDisabled,mode:t.mode,args:[...t.args?t.args:[],e,s]};return r(s)&&(o.text=s),o};a.build(C(o)?o.map(l):Pt(o,!1).map((t=>l(t,o[t]))),this.target),n.setContent(a.container).open((()=>Le(this.container))),this.state.activated=!0,this.j.e.on(n,"afterClose",(()=>{this.state.activated=!1}))}onClick(t){var e,s,i,n,r,a,l;const{control:h}=this;if(o(h.exec)){const o=null!==(i=null!==(s=null===(e=this.toolbar)||void 0===e?void 0:e.getTarget(this))&&void 0!==s?s:this.target)&&void 0!==i?i:null,c=h.exec(this.j,o,{control:h,originalEvent:t,button:this});if(!1!==c&&!0!==c&&(null===(r=null===(n=this.j)||void 0===n?void 0:n.e)||void 0===r||r.fire("synchro"),this.parentElement&&this.parentElement.update(),null===(l=null===(a=this.j)||void 0===a?void 0:a.e)||void 0===l||l.fire("closeAllPopups afterExec")),!1!==c)return}return h.list?this.openControlList(h):o(h.popup)?this.onTriggerClick(t):void((h.command||h.name)&&(Ot(S(this.j)?this.j.execCommand.bind(this.j):this.j.od.execCommand.bind(this.j.od),h.command||h.name,!1,h.args&&h.args[0]),this.j.e.fire("closeAllPopups")))}};i([$("state.tooltip")],Ge.prototype,"onChangeTooltip",null),i([$("state.hasTrigger")],Ge.prototype,"onChangeHasTrigger",null),Ge=i([y],Ge);let Xe=class extends ie{constructor(t,e,s=null){super(t),this.control=e,this.target=s,this.container.classList.add(`${this.componentName}_${this.clearName(e.name)}`),Bt(this.container,"role","content")}className(){return"ToolbarContent"}update(){const t=this.control.getContent(this.j,this.control,this);(r(t)||t.parentNode!==this.container)&&(ht.detach(this.container),this.container.appendChild(r(t)?this.j.create.fromHTML(t):t)),super.update()}createContainer(){return this.j.c.span(this.componentName)}};function Ye(t,e){const s=S(t)?new qe(t):new Ve(t);return t.o.textIcons&&s.container.classList.add("jodit_text_icons"),e&&(s.parentElement=e),t.o.toolbarButtonSize&&(s.buttonSize=t.o.toolbarButtonSize),s}Xe=i([y],Xe);class Ke extends Ue{constructor(t,e=!1){super(t,e),this.toolbar=Ye(this),this.defaultToolbarContainer=this.c.div("jodit-toolbar__box"),this.registeredButtons=new Set,this.groupToButtons={},this.isJodit=!1,this.isJodit=e,this.e.on("beforeToolbarBuild",this.beforeToolbarBuild)}get toolbarContainer(){return this.o.fullsize||!r(this.o.toolbar)&&!ht.isHTMLElement(this.o.toolbar)?(this.o.toolbar&&ht.appendChildFirst(this.container,this.defaultToolbarContainer),this.defaultToolbarContainer):((t,e)=>{let s=t;if(r(t))try{s=e.querySelector(t)}catch(e){throw k('String "'+t+'" should be valid HTML selector')}if(!s||"object"!=typeof s||!ht.isElement(s)||!s.cloneNode)throw k('Element "'+t+'" should be string or HTMLElement instance');return s})(this.o.toolbar,this.o.shadowRoot||this.od)}setPanel(t){this.o.toolbar=t,this.buildToolbar()}buildToolbar(){if(!this.o.toolbar)return;const t=this.o.buttons?H(this.o.buttons):[];this.toolbar.setRemoveButtons(this.o.removeButtons).build(t.concat(this.o.extraButtons||[])).appendTo(this.toolbarContainer)}getRegisteredButtonGroups(){return this.groupToButtons}registerButton(t){var e;this.registeredButtons.add(t);const s=null!==(e=t.group)&&void 0!==e?e:"other";return this.groupToButtons[s]||(this.groupToButtons[s]=[]),null!=t.position?this.groupToButtons[s][t.position]=t.name:this.groupToButtons[s].push(t.name),this}unregisterButton(t){var e;this.registeredButtons.delete(t);const s=null!==(e=t.group)&&void 0!==e?e:"other",i=this.groupToButtons[s];if(i){const e=i.indexOf(t.name);-1!==e&&i.splice(e,1),0===i.length&&delete this.groupToButtons[s]}return this}beforeToolbarBuild(t){if(Object.keys(this.groupToButtons).length)return t.map((t=>de(t)&&t.group&&this.groupToButtons[t.group]?{group:t.group,buttons:[...t.buttons,...this.groupToButtons[t.group]]}:t))}destruct(){this.isDestructed||(this.setStatus(h.beforeDestruct),this.e.off("beforeToolbarBuild",this.beforeToolbarBuild),this.toolbar.destruct(),super.destruct())}}i([q],Ke.prototype,"beforeToolbarBuild",null),gt.prototype.dialog={namespace:"",extraButtons:[],resizable:!0,draggable:!0,buttons:["dialog.close"],removeButtons:[]},gt.prototype.controls.dialog={close:{icon:"cancel",exec(t){t.close(),t.toggleFullSizeBox(!1)}}};let Ze=class extends Ke{constructor(t){super(t),this.destroyAfterClose=!1,this.moved=!1,this.iSetMaximization=!1,this.resizable=!1,this.draggable=!1,this.startX=0,this.startY=0,this.startPoint={x:0,y:0,w:0,h:0},this.lockSelect=()=>{this.setMod("moved",!0)},this.unlockSelect=()=>{this.setMod("moved",!1)},this.onResize=()=>{this.options&&this.o.resizable&&!this.moved&&this.isOpened&&!this.offsetX&&!this.offsetY&&this.setPosition()},this.isModal=!1,this.isOpened=!1;const e=this;e.options=qt(null!=t?t:{},qt({toolbarButtonSize:"middle"},qt(gt.prototype.dialog,Ue.defaultOptions))),ht.safeRemove(e.container);const s=this.getFullElName.bind(this);e.container=this.c.fromHTML(`<div style="z-index:${e.o.zIndex}" class="jodit jodit-dialog ${this.componentName}">\n\t\t\t\t<div class="${s("overlay")}"></div>\n\t\t\t\t<div class="${this.getFullElName("panel")}">\n\t\t\t\t\t<div class="${s("header")}">\n\t\t\t\t\t\t<div class="${s("header-title")}"></div>\n\t\t\t\t\t\t<div class="${s("header-toolbar")}"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="${s("content")}"></div>\n\t\t\t\t\t<div class="${s("footer")}"></div>\n\t\t\t\t\t<div class="${s("resizer")}">${ee.get("resize_handler")}</div>\n\t\t\t\t</div>\n\t\t\t</div>`),Bt(e.container,"role","dialog"),Object.defineProperty(e.container,"component",{value:this}),e.setMod("theme",e.o.theme||"default").setMod("resizable",!!e.o.resizable);const i=e.getElm("panel"),n=e.getElm("resizer"),r=e.getElm("header-title"),a=e.getElm("content"),l=e.getElm("footer"),h=e.getElm("header-toolbar");e.dialog=i,e.resizer=n,e.dialogbox_header=r,e.dialogbox_content=a,e.dialogbox_footer=l,e.dialogbox_toolbar=h,Lt(e.dialog,{maxWidth:e.options.maxWidth,minHeight:e.options.minHeight,minWidth:e.options.minWidth});const c=e.getElm("header");c&&e.e.on(c,"pointerdown touchstart",e.onHeaderMouseDown),e.e.on(e.resizer,"mousedown touchstart",e.onResizerMouseDown);const d=wt.get("fullsize");o(d)&&d(e),this.e.on(e.container,"close_dialog",e.close).on(this.ow,"keydown",this.onEsc).on(this.ow,"resize",this.onResize)}className(){return"Dialog"}get destination(){return this.od.body}setElements(t,e){const s=[];Zt(e).forEach((e=>{if(C(e)){const i=this.c.div(this.getFullElName("column"));return s.push(i),t.appendChild(i),this.setElements(i,e)}let i;var o;i=r(e)?this.c.fromHTML(e):!a(o=e)&&ht.isElement(o.container)?e.container:e,s.push(i),i.parentNode!==t&&t.appendChild(i)})),Jt(t.childNodes).forEach((e=>{-1===s.indexOf(e)&&t.removeChild(e)}))}onMouseUp(){(this.draggable||this.resizable)&&(this.removeGlobalResizeListeners(),this.draggable=!1,this.resizable=!1,this.unlockSelect(),this.e&&(this.removeGlobalResizeListeners(),this.e.fire(this,"endResize endMove")))}onHeaderMouseDown(t){const e=t.target;!this.o.draggable||e&&e.nodeName.match(/^(INPUT|SELECT)$/)||(this.draggable=!0,this.startX=t.clientX,this.startY=t.clientY,this.startPoint.x=Lt(this.dialog,"left"),this.startPoint.y=Lt(this.dialog,"top"),this.setMaxZIndex(),t.cancelable&&t.preventDefault(),this.lockSelect(),this.addGlobalResizeListeners(),this.e&&this.e.fire(this,"startMove"))}onMouseMove(t){this.draggable&&this.o.draggable&&(this.setPosition(this.startPoint.x+t.clientX-this.startX,this.startPoint.y+t.clientY-this.startY),this.e&&this.e.fire(this,"move",t.clientX-this.startX,t.clientY-this.startY),t.stopImmediatePropagation()),this.resizable&&this.o.resizable&&(this.setSize(this.startPoint.w+t.clientX-this.startX,this.startPoint.h+t.clientY-this.startY),this.e&&this.e.fire(this,"resizeDialog",t.clientX-this.startX,t.clientY-this.startY))}onEsc(t){if(this.isOpened&&t.key===f&&!0!==this.getMod("static")){const e=this.getMaxZIndexDialog();e?e.close():this.close(),t.stopImmediatePropagation()}}onResizerMouseDown(t){this.resizable=!0,this.startX=t.clientX,this.startY=t.clientY,this.startPoint.w=this.dialog.offsetWidth,this.startPoint.h=this.dialog.offsetHeight,this.lockSelect(),this.addGlobalResizeListeners(),this.e&&this.e.fire(this,"startResize")}addGlobalResizeListeners(){const t=this;t.e.on(t.ow,"pointermove touchmove",t.onMouseMove).on(t.ow,"pointerup touchend",t.onMouseUp)}removeGlobalResizeListeners(){const t=this;t.e.off(t.ow,"mousemove pointermove",t.onMouseMove).off(t.ow,"mouseup pointerup",t.onMouseUp)}setSize(t,e){return null==t&&(t=this.dialog.offsetWidth),null==e&&(e=this.dialog.offsetHeight),Lt(this.dialog,{width:t,height:e}),this}calcAutoSize(){return this.setSize("auto","auto"),this.setSize(),this}setPosition(t,e){let s=this.ow.innerWidth/2-this.dialog.offsetWidth/2,i=this.ow.innerHeight/2-this.dialog.offsetHeight/2;return 0>s&&(s=0),0>i&&(i=0),void 0!==t&&void 0!==e&&(this.offsetX=t,this.offsetY=e,this.moved=Math.abs(t-s)>100||Math.abs(e-i)>100),this.dialog.style.left=(t||s)+"px",this.dialog.style.top=(e||i)+"px",this}setHeader(t){return this.setElements(this.dialogbox_header,t),this}setContent(t){return this.setElements(this.dialogbox_content,t),this}setFooter(t){return this.setElements(this.dialogbox_footer,t),this.setMod("footer",!!t),this}getZIndex(){return parseInt(Lt(this.container,"zIndex"),10)||0}getMaxZIndexDialog(){let t,e,s=0,i=this;return ke(".jodit-dialog",this.destination).forEach((o=>{t=o.component,e=parseInt(Lt(o,"zIndex"),10),t.isOpened&&!isNaN(e)&&e>s&&(i=t,s=e)})),i}setMaxZIndex(){let t=20000004,e=0;ke(".jodit-dialog",this.destination).forEach((s=>{e=parseInt(Lt(s,"zIndex"),10),t=Math.max(isNaN(e)?0:e,t)})),this.container.style.zIndex=""+(t+1)}maximization(t){return a(t)&&(t=!this.getMod("fullsize")),this.setMod("fullsize",t),this.toggleFullSizeBox(t),this.iSetMaximization=t,t}toggleFullSizeBox(t){[this.destination,this.destination.parentNode].forEach((e=>{e&&e.classList&&e.classList.toggle("jodit_fullsize-box_true",t)}))}open(t,e,s,i){if(St.fire("closeAllPopups hideHelpers"),!1===this.e.fire(this,"beforeOpen"))return this;x(t)&&(s=t),x(e)&&(i=e),this.destroyAfterClose=!0===s;const o=x(t)?void 0:t,n=x(e)?void 0:e;return void 0!==n&&this.setHeader(n),o&&this.setContent(o),this.setMod("active",!0),this.isOpened=!0,this.setModal(i),this.destination.appendChild(this.container),this.setPosition(this.offsetX,this.offsetY),this.setMaxZIndex(),this.o.fullsize&&this.maximization(!0),this.e.fire("afterOpen",this),this}setModal(t){return this.isModal=!!t,this.setMod("modal",this.isModal),this}close(t){var e,s;return this.isDestructed||!this.isOpened||!0===this.getMod("static")||(t&&(t.stopImmediatePropagation(),t.preventDefault()),this.e&&!1===this.e.fire("beforeClose",this)||(this.setMod("active",!1),this.isOpened=!1,this.e.fire("toggleFullSize",!1),this.iSetMaximization&&this.maximization(!1),ht.safeRemove(this.container),this.removeGlobalResizeListeners(),this.destroyAfterClose&&this.destruct(),null===(e=this.e)||void 0===e||e.fire(this,"afterClose"),null===(s=this.e)||void 0===s||s.fire(this.ow,"joditCloseDialog"))),this}buildToolbar(){this.o.buttons&&this.toolbar.build(H(this.o.buttons)).setMod("mode","header").appendTo(this.dialogbox_toolbar)}destruct(){this.isInDestruct||(this.setStatus(h.beforeDestruct),this.isOpened&&this.close(),this.events&&(this.removeGlobalResizeListeners(),this.events.off(this.container,"close_dialog",self.close).off(this.ow,"keydown",this.onEsc).off(this.ow,"resize",this.onResize)),super.destruct())}};i([q],Ze.prototype,"onMouseUp",null),i([q],Ze.prototype,"onHeaderMouseDown",null),i([q],Ze.prototype,"onMouseMove",null),i([q],Ze.prototype,"onEsc",null),i([q],Ze.prototype,"onResizerMouseDown",null),i([q],Ze.prototype,"close",null),i([R("ready")],Ze.prototype,"buildToolbar",null),Ze=i([y],Ze);const Je=(t,e,s,i="jodit-dialog_alert")=>{o(e)&&(s=e,e=void 0);const n=new Ze,r=n.c.div(i),a=oe(n,"ok","Ok");return Zt(t).forEach((t=>{r.appendChild(ht.isNode(t)?t:n.c.fromHTML(t))})),a.onAction((()=>{s&&o(s)&&!1===s(n)||n.close()})),n.setFooter([a]),n.open(r,e||"&nbsp;",!0,!0),a.focus(),n},Qe=(t,e,s,i,n)=>{const r=new Ze,a=oe(r,"cancel","Cancel"),l=oe(r,"ok","Ok"),h=r.c.element("form",{class:"jodit-dialog_prompt"}),c=r.c.element("input",{autofocus:!0,class:"jodit-input"}),d=r.c.element("label");o(e)&&(s=e,e=void 0),i&&Bt(c,"placeholder",i),d.appendChild(r.c.text(t)),h.appendChild(d),h.appendChild(c),a.onAction(r.close);const u=()=>{s&&o(s)&&!1===s(c.value)||r.close()};return l.onAction(u),r.e.on(h,"submit",(()=>(u(),!1))),r.setFooter([l,a]),r.open(h,e||"&nbsp;",!0,!0),c.focus(),void 0!==n&&n.length&&(c.value=n,c.select()),r},ts=(t,e,s)=>{const i=new Ze,n=i.c.fromHTML('<form class="jodit-dialog_prompt"></form>'),r=i.c.element("label");o(e)&&(s=e,e=void 0),r.appendChild(i.c.fromHTML(t)),n.appendChild(r);const a=t=>()=>{s&&!1===s(t)||i.close()},l=oe(i,"cancel","Cancel"),h=oe(i,"ok","Yes");return l.onAction(a(!1)),h.onAction(a(!0)),i.e.on(n,"submit",(()=>(a(!0)(),!1))),i.setFooter([h,l]),i.open(n,e||"&nbsp;",!0,!0),h.focus(),i};i([q],class extends Tt{constructor(t){super(t),this.requires=[],this.buttons=[],this.hasStyle=!1,t.e.on("afterPluginSystemInit",(()=>{var e;S(t)&&(null===(e=this.buttons)||void 0===e||e.forEach((e=>{t.registerButton(e)})))})).on("afterInit",(()=>{this.setStatus(h.ready),this.afterInit(t)})).on("beforeDestruct",this.destruct)}className(){return""}init(t){}destruct(){var t,e,s;if(!this.isInDestruct){this.setStatus(h.beforeDestruct);const{j:i}=this;S(i)&&(null===(t=this.buttons)||void 0===t||t.forEach((t=>{null==i||i.unregisterButton(t)}))),null===(s=null===(e=this.j)||void 0===e?void 0:e.events)||void 0===s||s.off("beforeDestruct",this.destruct),this.beforeDestruct(this.j),super.destruct()}}}.prototype,"destruct",null);class es{constructor(t,e){this.document=t,this.createAttributes=e}get doc(){return o(this.document)?this.document():this.document}element(t,e,s){const i=this.doc.createElement(t.toLowerCase());return this.applyCreateAttributes(i),e&&(I(e)?Bt(i,e):s=e),s&&Zt(s).forEach((t=>i.appendChild(r(t)?this.fromHTML(t):t))),i}div(t,e,s){const i=this.element("div",e,s);return t&&(i.className=t),i}span(t,e,s){const i=this.element("span",e,s);return t&&(i.className=t),i}a(t,e,s){const i=this.element("a",e,s);return t&&(i.className=t),i}text(t){return this.doc.createTextNode(t)}fake(){return this.text(d)}fragment(){return this.doc.createDocumentFragment()}fromHTML(t,e){const s=this.div();s.innerHTML=""+t;const i=s.firstChild===s.lastChild&&s.firstChild?s.firstChild:s;if(ht.safeRemove(i),e){const t=Me(i);Object.keys(e).forEach((s=>{const i=t[s];i&&!1===e[s]&&ht.hide(i)}))}return i}applyCreateAttributes(t){if(this.createAttributes){const e=this.createAttributes;if(e&&e[t.tagName.toLowerCase()]){const s=e[t.tagName.toLowerCase()];o(s)?s(t):I(s)&&Bt(t,s)}}}}gt.prototype.filebrowser={namespace:"",extraButtons:[],filter:(t,e)=>(e=e.toLowerCase(),r(t)?-1!==t.toLowerCase().indexOf(e):r(t.name)?-1!==t.name.toLowerCase().indexOf(e):!r(t.file)||-1!==t.file.toLowerCase().indexOf(e)),sortBy:"changed-desc",sort(t,e,s){const[i,o]=s.toLowerCase().split("-"),n="asc"===o,a=(t,e)=>e>t?n?-1:1:t>e?n?1:-1:0;if(r(t))return a(t.toLowerCase(),e.toLowerCase());if(void 0===t[i]||"name"===i)return r(t.name)?a(t.name.toLowerCase(),e.name.toLowerCase()):r(t.file)?a(t.file.toLowerCase(),e.file.toLowerCase()):0;switch(i){case"changed":{const s=new Date(t.changed).getTime(),i=new Date(e.changed).getTime();return n?s-i:i-s}case"size":{const s=Kt(t.size),i=Kt(e.size);return n?s-i:i-s}}return 0},editImage:!0,preview:!0,showPreviewNavigation:!0,showSelectButtonInPreview:!0,contextMenu:!0,howLongShowMsg:3e3,createNewFolder:!0,deleteFolder:!0,renameFolder:!0,moveFolder:!0,moveFile:!0,showFoldersPanel:!0,storeLastOpenedFolder:!0,width:859,height:400,buttons:["filebrowser.upload","filebrowser.remove","filebrowser.update","filebrowser.select","filebrowser.edit","|","filebrowser.tiles","filebrowser.list","|","filebrowser.filter","|","filebrowser.sort"],removeButtons:[],fullsize:!1,showTooltip:!0,view:null,isSuccess:t=>t.success,getMessage:t=>void 0!==t.data.messages&&C(t.data.messages)?t.data.messages.join(" "):"",showFileName:!0,showFileSize:!0,showFileChangeTime:!0,saveStateInStorage:{storeLastOpenedFolder:!0,storeView:!0,storeSortBy:!0},pixelOffsetLoadNewChunk:200,getThumbTemplate(t,e,s){const i=this.options,o=this.files.getFullElName("item"),n=i.showFileName,r=i.showFileSize&&t.size,a=i.showFileChangeTime&&t.time;let l="";return void 0!==t.file&&(l=t.file),`<a\n\t\t\tdata-jodit-filebrowser-item="true"\n\t\t\tdata-is-file="${t.isImage?0:1}"\n\t\t\tdraggable="true"\n\t\t\tclass="${o}"\n\t\t\thref="${t.fileURL}"\n\t\t\tdata-source="${s}"\n\t\t\tdata-path="${t.path}"\n\t\t\tdata-name="${l}"\n\t\t\ttitle="${l}"\n\t\t\tdata-url="${t.fileURL}">\n\t\t\t\t<img\n\t\t\t\t\tdata-is-file="${t.isImage?0:1}"\n\t\t\t\t\tdata-src="${t.fileURL}"\n\t\t\t\t\tsrc="${t.imageURL}"\n\t\t\t\t\talt="${l}"\n\t\t\t\t\tloading="lazy"\n\t\t\t\t/>\n\t\t\t\t${n||r||a?`<div class="${o}-info">${n?`<span class="${o}-info-filename">${l}</span>`:""}${r?`<span class="${o}-info-filesize">${t.size}</span>`:""}${a?`<span class="${o}-info-filechanged">${a}</span>`:""}</div>`:""}\n\t\t\t</a>`},ajax:{...gt.prototype.defaultAjaxOptions,url:"",async:!0,data:{},cache:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",method:"POST",processData:!0,dataType:"json",headers:{},prepareData:t=>t,process:t=>t},create:{data:{action:"folderCreate"}},getLocalFileByUrl:{data:{action:"getLocalFileByUrl"}},resize:{data:{action:"imageResize"}},crop:{data:{action:"imageCrop"}},fileMove:{data:{action:"fileMove"}},folderMove:{data:{action:"folderMove"}},fileRename:{data:{action:"fileRename"}},folderRename:{data:{action:"folderRename"}},fileRemove:{data:{action:"fileRemove"}},folderRemove:{data:{action:"folderRemove"}},items:{data:{action:"files"}},folder:{data:{action:"folders"}},permissions:{data:{action:"permissions"}}},gt.prototype.controls.filebrowser={upload:{icon:"plus",isInput:!0,isDisabled(t){return!t.dataProvider.canI("FileUpload")},getContent(t){const e=new Te(t,{onlyImages:t.state.onlyImages});return t.e.fire("bindUploader.filebrowser",e.container),e.container}},remove:{icon:"bin",isDisabled(t){return!t.state.activeElements.length||!t.dataProvider.canI("FileRemove")},exec(t){t.e.fire("fileRemove.filebrowser")}},update:{exec(t){t.e.fire("update.filebrowser")}},select:{icon:"check",isDisabled(t){return!t.state.activeElements.length},exec(t){t.e.fire("select.filebrowser")}},edit:{icon:"pencil",isDisabled(t){const e=t.state.activeElements;return 1!==e.length||!e[0].isImage||!(t.dataProvider.canI("ImageCrop")||t.dataProvider.canI("ImageResize"))},exec(t){t.e.fire("edit.filebrowser")}},tiles:{icon:"th",isActive(t){return"tiles"===t.state.view},exec(t){t.e.fire("view.filebrowser","tiles")}},list:{icon:"th-list",isActive(t){return"list"===t.state.view},exec(t){t.e.fire("view.filebrowser","list")}},filter:{isInput:!0,getContent(t,e,s){const i=s.container.querySelector(".jodit-input");if(i)return i;const o=t.c.element("input",{class:"jodit-input",placeholder:t.i18n("Filter")});return o.value=t.state.filterWord,t.e.on(o,"keydown mousedown",t.async.debounce((()=>{t.e.fire("filter.filebrowser",o.value)}),t.defaultTimeout)),o}},sort:{isInput:!0,getContent(t){const e=t.c.fromHTML(`<select class="jodit-input jodit-select"><option value="changed-asc">${t.i18n("Sort by changed")} (⬆)</option><option value="changed-desc">${t.i18n("Sort by changed")} (⬇)</option><option value="name-asc">${t.i18n("Sort by name")} (⬆)</option><option value="name-desc">${t.i18n("Sort by name")} (⬇)</option><option value="size-asc">${t.i18n("Sort by size")} (⬆)</option><option value="size-desc">${t.i18n("Sort by size")} (⬇)</option></select>`);return e.value=t.state.sortBy,t.e.on("sort.filebrowser",(t=>{e.value!==t&&(e.value=t)})).on(e,"change",(()=>{t.e.fire("sort.filebrowser",e.value)})),e}}};class ss{constructor(t){this.data=t,Object.keys(t).forEach((e=>{this[e]=t[e]}))}static create(t){return t instanceof ss?t:new ss(t)}get path(){return Mt(this.data.source.path?this.data.source.path+"/":"/")}get imageURL(){const t=""+(new Date).getTime(),{thumbIsAbsolute:e,source:s,thumb:i,file:o}=this.data,n=i||o;return e&&n?n:zt(s.baseurl,s.path,n||"")+"?_tmst="+t}get fileURL(){let{name:t}=this.data;const{file:e,fileIsAbsolute:s,source:i}=this.data;return void 0!==e&&(t=e),s&&t?t:zt(i.baseurl,i.path,t||"")}get time(){const{changed:t}=this.data;return t&&("number"==typeof t?new Date(t).toLocaleString():t)||""}get uniqueHashKey(){const t=this.data;let e=[t.sourceName,t.name,t.file,this.time,t.thumb].join("_");return e=e.toLowerCase().replace(/[^0-9a-z\-.]/g,"-"),e}toJSON(){return this.data}}const is="default";let os=class{constructor(t,e){this.parent=t,this.options=e,this.__currentPermissions=null,this.ajaxInstances=new Map,this.progressHandler=t=>{}}get o(){return this.options}get(t){const e=this.ajaxInstances;if(e.has(t)){const s=e.get(t);null==s||s.abort(),e.delete(t)}const s=qt(void 0!==this.options[t]?this.options[t]:{},qt({onProgress:this.progressHandler},this.o.ajax));s.prepareData&&(s.data=s.prepareData.call(this,s.data));const i=new Fe(this.parent,s);e.set(t,i);const o=i.send();return o.finally((()=>{i.destruct(),e.delete(t),this.progressHandler(100)})),o.then((t=>t.json())).then((t=>{if(t&&!this.isSuccess(t))throw Error(this.getMessage(t));return t}))}onProgress(t){this.progressHandler=t}async permissions(t,e){return this.o.permissions?(this.o.permissions.data.path=t,this.o.permissions.data.source=e,this.o.permissions.url?this.get("permissions").then((t=>{let e=this.o.permissions.process;if(e||(e=this.o.ajax.process),e){const s=e.call(self,t);s.data.permissions&&(this.__currentPermissions=s.data.permissions)}return this.__currentPermissions})):null):null}canI(t){const e="allow"+t;return null==this.__currentPermissions||void 0===this.__currentPermissions[e]||this.__currentPermissions[e]}async items(t,e,s={}){const i=this.options;return i.items?(i.items.data.path=t,i.items.data.source=e,i.items.data.mods=s,this.get("items").then((t=>{let e=this.o.items.process;return e||(e=this.o.ajax.process),e&&(t=e.call(self,t)),this.generateItemsList(t.data.sources,s)}))):Promise.reject("Set Items api options")}generateItemsList(t,e={}){const s=[],i=t=>{var s;return!(null===(s=e.filterWord)||void 0===s?void 0:s.length)||void 0===this.o.filter||this.o.filter(t,e.filterWord)};return t.forEach((t=>{if(t.files&&t.files.length){const{sort:n}=this.o;o(n)&&e.sortBy&&t.files.sort(((t,s)=>n(t,s,e.sortBy))),t.files.forEach((o=>{i(o)&&(t=>!e.onlyImages||void 0===t.isImage||t.isImage)(o)&&s.push(ss.create({...o,sourceName:t.name,source:t}))}))}})),s}async tree(t,e){return t=(t=>t.split("/").reduce(((t,e)=>{switch(e){case"":case".":break;case"..":t.pop();break;default:t.push(e)}return t}),[]).join("/")+(t.endsWith("/")?"/":""))(t),await this.permissions(t,e),this.o.folder?(this.o.folder.data.path=t,this.o.folder.data.source=e,this.get("folder").then((t=>{let e=this.o.folder.process;return e||(e=this.o.ajax.process),e&&(t=e.call(self,t)),t.data.sources}))):Promise.reject("Set Folder Api options")}getPathByUrl(t){return((t,e,s)=>{if(!r(t))return;const i=t.split(".");let o=s,n=i[0];for(let t=0;i.length-1>t;t+=1)n=i[t],C(o[n])||I(o[n])||(o[n]=T(i[t+1])?[]:{}),o=o[n];o&&(o[i[i.length-1]]=e)})("options.getLocalFileByUrl.data.url",t,this),this.get("getLocalFileByUrl").then((t=>{if(this.isSuccess(t))return t.data;throw k(this.getMessage(t))}))}createFolder(t,e,s){const{create:i}=this.o;if(!i)throw k("Set Create api options");return i.data.source=s,i.data.path=e,i.data.name=t,this.get("create").then((t=>{if(this.isSuccess(t))return!0;throw k(this.getMessage(t))}))}move(t,e,s,i){const o=i?"fileMove":"folderMove",n=this.options[o];if(!n)throw k("Set Move api options");return n.data.from=t,n.data.path=e,n.data.source=s,this.get(o).then((t=>{if(this.isSuccess(t))return!0;throw k(this.getMessage(t))}))}remove(t,e,s,i){const o=this.o[t];if(!o)throw k(`Set "${t}" api options`);return o.data.path=e,o.data.name=s,o.data.source=i,this.get(t).then((t=>(o.process&&(t=o.process.call(this,t)),this.getMessage(t))))}fileRemove(t,e,s){return this.remove("fileRemove",t,e,s)}folderRemove(t,e,s){return this.remove("folderRemove",t,e,s)}rename(t,e,s,i,o){const n=this.o[t];if(!n)throw k(`Set "${t}" api options`);return n.data.path=e,n.data.name=s,n.data.newname=i,n.data.source=o,this.get(t).then((t=>(n.process&&(t=n.process.call(self,t)),this.getMessage(t))))}folderRename(t,e,s,i){return this.rename("folderRename",t,e,s,i)}fileRename(t,e,s,i){return this.rename("fileRename",t,e,s,i)}changeImage(t,e,s,i,o,n){this.o[t]||(this.o[t]={data:{}});const r=this.o[t];return void 0===r.data&&(r.data={action:t}),r.data.newname=o||i,n&&(r.data.box=n),r.data.path=e,r.data.name=i,r.data.source=s,this.get(t).then((()=>!0))}crop(t,e,s,i,o){return this.changeImage("crop",t,e,s,i,o)}resize(t,e,s,i,o){return this.changeImage("resize",t,e,s,i,o)}getMessage(t){return this.options.getMessage(t)}isSuccess(t){return this.options.isSuccess(t)}destruct(){this.ajaxInstances.forEach((t=>t.destruct())),this.ajaxInstances.clear()}};os=i([q],os);var ns=os;const rs=new WeakMap,as=t=>{let e=rs.get(t);return e||(e={},rs.set(t,e)),e};async function ls(t){return t.files.setMod("active",!0),t.files.setMod("loading",!0),t.dataProvider.items(t.state.currentPath,t.state.currentSource,{sortBy:t.state.sortBy,onlyImages:t.state.onlyImages,filterWord:t.state.filterWord}).then((e=>{t.state.elements=e,t.state.activeElements=[]})).catch(t.status).finally((()=>t.files.setMod("loading",!1)))}async function hs(t){t.tree.setMod("active",!0),ht.detach(t.tree.container);const e=ls(t);if(t.o.showFoldersPanel){t.tree.setMod("loading",!0);const s=t.dataProvider.tree(t.state.currentPath,t.state.currentSource).then((e=>{t.state.sources=e})).catch((t=>{(t=>{throw t instanceof Error?t:k(t)})(t)})).finally((()=>t.tree.setMod("loading",!1)));return Promise.all([s,e]).catch(k)}return t.tree.setMod("active",!1),e.catch(k)}function cs(){const t=as(this),{state:e,files:s,create:i,options:o}=this,n=e=>{const s=e.uniqueHashKey;if(t[s])return t[s].elm;const n=i.fromHTML(o.getThumbTemplate.call(this,e,e.source,""+e.sourceName));return n.dataset.key=s,t[s]={item:e,elm:n},t[s].elm};e.on(["change.currentPath","change.currentSource"],this.async.debounce((()=>{this.o.saveStateInStorage&&this.o.saveStateInStorage.storeLastOpenedFolder&&this.storage.set("currentPath",this.state.currentPath).set("currentSource",this.state.currentSource),hs(this).catch(this.status)}),this.defaultTimeout)).on("beforeChange.activeElements",(()=>{e.activeElements.forEach((e=>{const i=e.uniqueHashKey,{elm:o}=t[i];o&&o.classList.remove(s.getFullElName("item","active",!0))}))})).on("change.activeElements",(()=>{this.e.fire("changeSelection"),e.activeElements.forEach((e=>{const i=e.uniqueHashKey,{elm:o}=t[i];o&&o.classList.add(s.getFullElName("item","active",!0))}))})).on("change.view",(()=>{s.setMod("view",e.view),this.o.saveStateInStorage&&this.o.saveStateInStorage.storeView&&this.storage.set("view",e.view)})).on("change.sortBy",(()=>{this.o.saveStateInStorage&&this.o.saveStateInStorage.storeSortBy&&this.storage.set("sortBy",e.sortBy)})).on("change.elements",this.async.debounce((()=>{ht.detach(s.container),e.elements.length?e.elements.forEach((t=>{this.files.container.appendChild(n(t))})):s.container.appendChild(i.div(this.componentName+"_no-files_true",this.i18n("There are no files")))}),this.defaultTimeout)).on("change.sources",this.async.debounce((()=>{ht.detach(this.tree.container),e.sources.forEach((t=>{const e=t.name;if(e&&"default"!==e&&this.tree.container.appendChild(i.div(this.tree.getFullElName("source-title"),e)),t.folders.forEach((s=>{const n=i.a(this.tree.getFullElName("item"),{draggable:"draggable",href:"#","data-path":Mt(t.path,s+"/"),"data-name":s,"data-source":e,"data-source-path":t.path},i.span(this.tree.getFullElName("item-title"),s)),r=i=>o=>{this.e.fire(i+".filebrowser",{name:s,path:Mt(t.path+"/"),source:e}),o.stopPropagation(),o.preventDefault()};if(this.e.on(n,"click",r("openFolder")),this.tree.container.appendChild(n),".."!==s&&"."!==s){if(o.renameFolder&&this.dataProvider.canI("FolderRename")){const t=oe(this,{icon:{name:"pencil"},name:"rename",tooltip:"Rename",size:"tiny"});t.onAction(r("renameFolder")),n.appendChild(t.container)}if(o.deleteFolder&&this.dataProvider.canI("FolderRemove")){const t=oe(this,{icon:{name:"cancel"},name:"remove",tooltip:"Delete",size:"tiny"});t.onAction(r("removeFolder")),n.appendChild(t.container)}}})),o.createNewFolder&&this.dataProvider.canI("FolderCreate")){const s=oe(this,"plus","Add folder","secondary");s.onAction((()=>{this.e.fire("addFolder",{path:Mt(t.path+"/"),source:e})})),this.tree.append(s)}}))}),this.defaultTimeout))}const ds="jodit-image-editor",us=ee.get.bind(ee),ps=(t,e="jodti-image-editor_active")=>t?e:"";var fs;gt.prototype.imageeditor={min_width:20,min_height:20,closeAfterSave:!1,width:"85%",height:"85%",crop:!0,resize:!0,resizeUseRatio:!0,resizeMinWidth:20,resizeMinHeight:20,cropUseRatio:!0,cropDefaultWidth:"70%",cropDefaultHeight:"70%"};const ms="resize",gs="crop";let vs=fs=class extends Tt{constructor(t){super(t),this.resizeUseRatio=!0,this.cropUseRatio=!0,this.clicked=!1,this.start_x=0,this.start_y=0,this.top_x=0,this.top_y=0,this.width=0,this.height=0,this.activeTab=ms,this.naturalWidth=0,this.naturalHeight=0,this.ratio=0,this.new_h=0,this.new_w=0,this.diff_x=0,this.diff_y=0,this.cropBox={x:0,y:0,w:0,h:0},this.resizeBox={w:0,h:0},this.calcCropBox=()=>{const t=this.crop_box.parentNode,e=.8*t.offsetWidth,s=.8*t.offsetHeight;let i=e,o=s;const{naturalWidth:n,naturalHeight:r}=this;e>n&&s>r?(i=n,o=r):this.ratio>e/s?(i=e,o=r*(e/n)):(i=n*(s/r),o=s),Lt(this.crop_box,{width:i,height:o})},this.showCrop=()=>{if(!this.cropImage)return;this.calcCropBox();const t=this.cropImage.offsetWidth||this.image.offsetWidth||this.image.naturalWidth;this.new_w=fs.calcValueByPercent(t,this.o.cropDefaultWidth);const e=this.cropImage.offsetHeight||this.image.offsetHeight||this.image.naturalHeight;this.new_h=this.cropUseRatio?this.new_w/this.ratio:fs.calcValueByPercent(e,this.o.cropDefaultHeight),Lt(this.cropHandler,{backgroundImage:"url("+Bt(this.cropImage,"src")+")",width:this.new_w,height:this.new_h,left:t/2-this.new_w/2,top:e/2-this.new_h/2}),this.j.e.fire(this.cropHandler,"updatesize")},this.updateCropBox=()=>{if(!this.cropImage)return;const t=this.cropImage.offsetWidth/this.naturalWidth,e=this.cropImage.offsetHeight/this.naturalHeight;this.cropBox.x=Lt(this.cropHandler,"left")/t,this.cropBox.y=Lt(this.cropHandler,"top")/e,this.cropBox.w=this.cropHandler.offsetWidth/t,this.cropBox.h=this.cropHandler.offsetHeight/e,this.sizes.textContent=this.cropBox.w.toFixed(0)+"x"+this.cropBox.h.toFixed(0)},this.updateResizeBox=()=>{this.resizeBox.w=this.image.offsetWidth||this.naturalWidth,this.resizeBox.h=this.image.offsetHeight||this.naturalHeight},this.setHandlers=()=>{const t=this,{widthInput:e,heightInput:s}=Me(this.editor);t.j.e.on([t.editor.querySelector(".jodit_bottomright"),t.cropHandler],"mousedown.jodit-image-editor",this.onResizeHandleMouseDown).on(this.j.ow,"resize.jodit-image-editor",(()=>{this.j.e.fire(t.resizeHandler,"updatesize"),t.showCrop(),this.j.e.fire(t.cropHandler,"updatesize")})),t.j.e.on(Jt(this.editor.querySelectorAll(".jodit-image-editor__slider-title")),"click",this.onTitleModeClick).on([e,s],"input",this.onChangeSizeInput);const{keepAspectRatioResize:i,keepAspectRatioCrop:o}=Me(this.editor);i&&i.addEventListener("change",(()=>{this.resizeUseRatio=i.checked})),o&&o.addEventListener("change",(()=>{this.cropUseRatio=o.checked})),t.j.e.on(t.resizeHandler,"updatesize",(()=>{Lt(t.resizeHandler,{top:0,left:0,width:t.image.offsetWidth||t.naturalWidth,height:t.image.offsetHeight||t.naturalHeight}),this.updateResizeBox()})).on(t.cropHandler,"updatesize",(()=>{if(!t.cropImage)return;let e=Lt(t.cropHandler,"left"),s=Lt(t.cropHandler,"top"),i=t.cropHandler.offsetWidth,o=t.cropHandler.offsetHeight;0>e&&(e=0),0>s&&(s=0),e+i>t.cropImage.offsetWidth&&(i=t.cropImage.offsetWidth-e,t.cropUseRatio&&(o=i/t.ratio)),s+o>t.cropImage.offsetHeight&&(o=t.cropImage.offsetHeight-s,t.cropUseRatio&&(i=o*t.ratio)),Lt(t.cropHandler,{width:i,height:o,left:e,top:s,backgroundPosition:-e-1+"px "+(-s-1)+"px",backgroundSize:t.cropImage.offsetWidth+"px "+t.cropImage.offsetHeight+"px"}),t.updateCropBox()})),Object.values(t.buttons).forEach((i=>{i.onAction((()=>{const o={action:t.activeTab,box:t.activeTab===ms?t.resizeBox:t.cropBox};switch(i){case t.buttons.saveas:Qe(t.j.i18n("Enter new name"),t.j.i18n("Save in new file"),(e=>{if(!ft(e))return Je(t.j.i18n("The name should not be empty")).bindDestruct(this.j),!1;t.onSave(e,o,t.hide,(e=>{Je(e.message).bindDestruct(t.j)}))})).bindDestruct(this.j);break;case t.buttons.save:t.onSave(void 0,o,t.hide,(e=>{Je(e.message).bindDestruct(t.j)}));break;case t.buttons.reset:t.activeTab===ms?(Lt(t.image,{width:null,height:null}),e.value=""+t.naturalWidth,s.value=""+t.naturalHeight,t.j.e.fire(t.resizeHandler,"updatesize")):t.showCrop()}}))}))},this.options=t&&t.o&&t.o.imageeditor?t.o.imageeditor:gt.defaultOptions.imageeditor;const e=this.options;this.resizeUseRatio=e.resizeUseRatio,this.cropUseRatio=e.cropUseRatio,this.buttons={reset:oe(this.j,"update","Reset"),save:oe(this.j,"save","Save"),saveas:oe(this.j,"save","Save as ...")},this.activeTab=e.resize?ms:gs,this.editor=((t,e)=>{const s=t.i18n.bind(t),i=(t,e,i=!0)=>`<div class="jodit-form__group">\n\t\t\t<label>${s(t)}</label>\n\n\t\t\t<label class='jodit-switcher'>\n\t\t\t\t<input ${ps(i,"checked")} data-ref="${e}" type="checkbox"/>\n\t\t\t\t<span class="jodit-switcher__slider"></span>\n\t\t\t</label>\n\t</div>`;return t.create.fromHTML(`<form class="${ds} jodit-properties">\n\t\t<div class="jodit-grid jodit-grid_xs-column">\n\t\t\t<div class="jodit_col-lg-3-4 jodit_col-sm-5-5">\n\t\t\t${e.resize?`<div class="${ds}__area ${ds}__area_resize ${ds}_active">\n\t\t\t\t\t\t\t<div data-ref="resizeBox" class="${ds}__box"></div>\n\t\t\t\t\t\t\t<div class="${ds}__resizer">\n\t\t\t\t\t\t\t\t<i class="jodit_bottomright"></i>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`:""}\n\t\t\t${e.crop?`<div class="${ds}__area ${ds}__area_crop ${ps(!e.resize)}">\n\t\t\t\t\t\t\t<div data-ref="cropBox" class="${ds}__box">\n\t\t\t\t\t\t\t\t<div class="${ds}__croper">\n\t\t\t\t\t\t\t\t\t<i class="jodit_bottomright"></i>\n\t\t\t\t\t\t\t\t\t<i class="${ds}__sizes"></i>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`:""}\n\t\t\t</div>\n\t\t\t<div class="jodit_col-lg-1-4 jodit_col-sm-5-5">\n\t\t\t${e.resize?`<div data-area="resize" class="${ds}__slider ${ds}_active">\n\t\t\t\t\t\t\t<div class="${ds}__slider-title">\n\t\t\t\t\t\t\t\t${us("resize")}\n\t\t\t\t\t\t\t\t${s("Resize")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="${ds}__slider-content">\n\t\t\t\t\t\t\t\t<div class="jodit-form__group">\n\t\t\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t\t\t${s("Width")}\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t<input type="number" data-ref="widthInput" class="jodit-input"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="jodit-form__group">\n\t\t\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t\t\t${s("Height")}\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t<input type="number" data-ref="heightInput" class="jodit-input"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t${i("Keep Aspect Ratio","keepAspectRatioResize")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`:""}\n\t\t\t${e.crop?`<div data-area="crop" class="${ds}__slider ${ps(!e.resize)}'">\n\t\t\t\t\t\t\t<div class="${ds}__slider-title">\n\t\t\t\t\t\t\t\t${us("crop")}\n\t\t\t\t\t\t\t\t${s("Crop")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="${ds}__slider-content">\n\t\t\t\t\t\t\t\t${i("Keep Aspect Ratio","keepAspectRatioCrop")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`:""}\n\t\t\t</div>\n\t\t</div>\n\t</form>`)})(this.j,this.options);const{resizeBox:s,cropBox:i}=Me(this.editor);this.resize_box=s,this.crop_box=i,this.sizes=this.editor.querySelector(".jodit-image-editor__area.jodit-image-editor__area_crop .jodit-image-editor__sizes"),this.resizeHandler=this.editor.querySelector(".jodit-image-editor__resizer"),this.cropHandler=this.editor.querySelector(".jodit-image-editor__croper"),this.dialog=new Ze({fullsize:this.j.o.fullsize,globalFullSize:this.j.o.globalFullSize,language:this.j.o.language,buttons:["fullsize","dialog.close"]}),this.dialog.setContent(this.editor),this.dialog.setSize(this.o.width,this.o.height),this.dialog.setHeader([this.buttons.reset,this.buttons.save,this.buttons.saveas]),this.setHandlers()}className(){return"ImageEditor"}onTitleModeClick(t){const e=this,s=t.target,i=null==s?void 0:s.parentElement;if(!i)return;ke(".jodit-image-editor__slider,.jodit-image-editor__area",e.editor).forEach((t=>t.classList.remove("jodit-image-editor_active"))),i.classList.add("jodit-image-editor_active"),this.activeTab=Bt(i,"-area")||ms;const o=e.editor.querySelector(".jodit-image-editor__area.jodit-image-editor__area_"+e.activeTab);o&&o.classList.add("jodit-image-editor_active"),e.activeTab===gs&&e.showCrop()}onChangeSizeInput(t){const e=this,s=t.target,{widthInput:i,heightInput:o}=Me(this.editor),n="widthInput"===Bt(s,"data-ref"),r=parseInt(s.value,10),a=n?e.o.min_height:e.o.min_width;let l;r>(n?e.o.min_width:e.o.min_height)&&(Lt(e.image,n?"width":"height",r),e.resizeUseRatio&&(l=Math.round(n?r/e.ratio:r*e.ratio),l>a&&(Lt(e.image,n?"height":"width",l),n?o.value=""+l:i.value=""+l))),this.j.e.fire(e.resizeHandler,"updatesize")}onResizeHandleMouseDown(t){const e=this;e.target=t.target,t.preventDefault(),t.stopImmediatePropagation(),e.clicked=!0,e.start_x=t.clientX,e.start_y=t.clientY,e.activeTab===gs?(e.top_x=Lt(e.cropHandler,"left"),e.top_y=Lt(e.cropHandler,"top"),e.width=e.cropHandler.offsetWidth,e.height=e.cropHandler.offsetHeight):(e.width=e.image.offsetWidth,e.height=e.image.offsetHeight),e.j.e.on(this.j.ow,"mousemove",this.onGlobalMouseMove).one(this.j.ow,"mouseup",this.onGlobalMouseUp)}onGlobalMouseUp(t){this.clicked&&(this.clicked=!1,t.stopImmediatePropagation(),this.j.e.off(this.j.ow,"mousemove",this.onGlobalMouseMove))}onGlobalMouseMove(t){const e=this;if(!e.clicked)return;const{widthInput:s,heightInput:i}=Me(this.editor);e.diff_x=t.clientX-e.start_x,e.diff_y=t.clientY-e.start_y,e.activeTab===ms&&e.resizeUseRatio||e.activeTab===gs&&e.cropUseRatio?e.diff_x?(e.new_w=e.width+e.diff_x,e.new_h=Math.round(e.new_w/e.ratio)):(e.new_h=e.height+e.diff_y,e.new_w=Math.round(e.new_h*e.ratio)):(e.new_w=e.width+e.diff_x,e.new_h=e.height+e.diff_y),e.activeTab===ms?(e.new_w>e.o.resizeMinWidth&&(Lt(e.image,"width",e.new_w+"px"),s.value=""+e.new_w),e.new_h>e.o.resizeMinHeight&&(Lt(e.image,"height",e.new_h+"px"),i.value=""+e.new_h),this.j.e.fire(e.resizeHandler,"updatesize")):(e.target!==e.cropHandler?(e.top_x+e.new_w>e.cropImage.offsetWidth&&(e.new_w=e.cropImage.offsetWidth-e.top_x),e.top_y+e.new_h>e.cropImage.offsetHeight&&(e.new_h=e.cropImage.offsetHeight-e.top_y),Lt(e.cropHandler,{width:e.new_w,height:e.new_h})):(e.top_x+e.diff_x+e.cropHandler.offsetWidth>e.cropImage.offsetWidth&&(e.diff_x=e.cropImage.offsetWidth-e.top_x-e.cropHandler.offsetWidth),Lt(e.cropHandler,"left",e.top_x+e.diff_x),e.top_y+e.diff_y+e.cropHandler.offsetHeight>e.cropImage.offsetHeight&&(e.diff_y=e.cropImage.offsetHeight-e.top_y-e.cropHandler.offsetHeight),Lt(e.cropHandler,"top",e.top_y+e.diff_y)),this.j.e.fire(e.cropHandler,"updatesize"))}get o(){return this.options}hide(){this.dialog.close()}open(t,e){return this.j.async.promise((s=>{const i=(new Date).getTime();this.image=this.j.c.element("img"),ke("img,.jodit-icon_loader",this.resize_box).forEach(ht.safeRemove),ke("img,.jodit-icon_loader",this.crop_box).forEach(ht.safeRemove),Lt(this.cropHandler,"background","transparent"),this.onSave=e,this.resize_box.appendChild(this.j.c.element("i",{class:"jodit-icon_loader"})),this.crop_box.appendChild(this.j.c.element("i",{class:"jodit-icon_loader"})),this.image.setAttribute("src",t+=/\?/.test(t)?"&_tst="+i:"?_tst="+i),this.dialog.open();const{widthInput:o,heightInput:n}=Me(this.editor),r=()=>{this.isDestructed||(this.image.removeEventListener("load",r),this.naturalWidth=this.image.naturalWidth,this.naturalHeight=this.image.naturalHeight,o.value=""+this.naturalWidth,n.value=""+this.naturalHeight,this.ratio=this.naturalWidth/this.naturalHeight,this.resize_box.appendChild(this.image),this.cropImage=this.image.cloneNode(!0),this.crop_box.appendChild(this.cropImage),ke(".jodit-icon_loader",this.editor).forEach(ht.safeRemove),this.activeTab===gs&&this.showCrop(),this.j.e.fire(this.resizeHandler,"updatesize"),this.j.e.fire(this.cropHandler,"updatesize"),this.dialog.setPosition(),this.j.e.fire("afterImageEditor"),s(this.dialog))};this.image.addEventListener("load",r),this.image.complete&&r()}))}destruct(){this.isDestructed||(this.dialog&&!this.dialog.isInDestruct&&this.dialog.destruct(),ht.safeRemove(this.editor),this.j.e&&this.j.e.off(this.j.ow,"mousemove",this.onGlobalMouseMove).off(this.j.ow,"mouseup",this.onGlobalMouseUp).off(this.ow,".jodit-image-editor").off(".jodit-image-editor"),super.destruct())}};function bs(t,e,s,i,o,n){return this.getInstance("ImageEditor",this.o).open(t,((t,r,a,l)=>Ot("resize"===r.action?this.dataProvider.resize:this.dataProvider.crop,s,i,e,t,r.box).then((t=>{t&&(a(),o&&o())})).catch((t=>{l(t),n&&n(t)}))))}function ws(t,e,s){return t.dataProvider.fileRemove(t.state.currentPath,e,s).then((s=>{t.status(s||t.i18n('File "%s" was deleted',e),!0)})).catch(t.status)}vs.calcValueByPercent=(t,e)=>{const s=""+e,i=parseFloat(""+t);let o;return o=/^[-+]?[0-9]+(px)?$/.exec(s),o?parseInt(s,10):(o=/^([-+]?[0-9.]+)%$/.exec(s),o?Math.round(i*(parseFloat(o[1])/100)):i||0)},i([q],vs.prototype,"onTitleModeClick",null),i([M(),q],vs.prototype,"onChangeSizeInput",null),i([q],vs.prototype,"onResizeHandleMouseDown",null),i([q],vs.prototype,"onGlobalMouseUp",null),i([z(10)],vs.prototype,"onGlobalMouseMove",null),i([q],vs.prototype,"hide",null),i([q],vs.prototype,"open",null),vs=fs=i([y],vs);const ys="jodit-filebrowser-preview",Cs=(t="next",e="right")=>`<div class="${ys}__navigation ${ys}__navigation_arrow_${t}">`+ee.get("angle-"+e)+"</a>";var xs=t=>{if(!t.o.contextMenu)return()=>{};const e=new Pe(t);return s=>{const i=js(s.target,t.container);if(!i)return;let o=i;const n=t.options,r=t=>Bt(o,t)||"";return t.async.setTimeout((()=>{const a=Ss(i,as(t));a&&(t.state.activeElements=[a],e.show(s.clientX,s.clientY,[!("1"===r("data-is-file")||!n.editImage||!t.dataProvider.canI("ImageResize")&&!t.dataProvider.canI("ImageCrop"))&&{icon:"pencil",title:"Edit",exec(){return bs.call(t,r("href"),r("data-name"),r("data-path"),r("data-source"))}},!!t.dataProvider.canI("FileRename")&&{icon:"italic",title:"Rename",async exec(){t.e.fire("fileRename.filebrowser",r("data-name"),r("data-path"),r("data-source"))}},!!t.dataProvider.canI("FileRemove")&&{icon:"bin",title:"Delete",async exec(){try{await ws(t,r("data-name"),r("data-source"))}catch(e){return t.status(e)}return t.state.activeElements=[],hs(t).catch(t.status)}},!!n.preview&&{icon:"eye",title:"Preview",exec(){const e=new Ze({fullsize:t.o.fullsize,language:t.o.language,buttons:["fullsize","dialog.close"]}),s=t.c.div(ys,'<div class="jodit-icon_loader"></div>'),i=t.c.div(ys+"__box"),a=t.c.fromHTML(Cs()),l=t.c.fromHTML(Cs("prev","left")),h=r=>{const h=t.c.element("img");h.setAttribute("src",r);const c=()=>{var r;t.isInDestruct||(t.e.off(h,"load"),ht.detach(s),n.showPreviewNavigation&&(ht.prevWithClass(o,t.files.getFullElName("item"))&&s.appendChild(l),ht.nextWithClass(o,t.files.getFullElName("item"))&&s.appendChild(a)),s.appendChild(i),i.appendChild(h),e.setPosition(),null===(r=null==t?void 0:t.events)||void 0===r||r.fire("previewOpenedAndLoaded"))};t.e.on(h,"load",c),h.complete&&c()};t.e.on([a,l],"click",(function(){if(o=this===a?ht.nextWithClass(o,t.files.getFullElName("item")):ht.prevWithClass(o,t.files.getFullElName("item")),!o)throw k("Need element");ht.detach(s),ht.detach(i),s.innerHTML='<div class="jodit-icon_loader"></div>',h(r("href"))})),t.e.on("beforeDestruct",(()=>{e.destruct()})),e.container.classList.add(ys+"__dialog"),e.setContent(s),e.setPosition(),e.open(),h(r("href")),t.events.on("beforeDestruct",(()=>{e.destruct()})).fire("previewOpened")}},{icon:"upload",title:"Download",exec(){const e=r("href");e&&t.ow.open(e)}}]))}),t.defaultTimeout),t.e.on("beforeClose",(()=>e.close())).on("beforeDestruct",(()=>e.destruct())),s.stopPropagation(),s.preventDefault(),!1}};const js=(t,e,s="a")=>ht.closest(t,(t=>ht.isTag(t,s)),e),Ss=(t,e)=>{const{key:s}=t.dataset,{item:i}=e[s||""];return i};function Es(){let t=!1;const e=as(this),s=this;s.e.on(s.tree.container,"dragstart",(e=>{const i=js(e.target,s.container);i&&s.o.moveFolder&&(t=i)})).on(s.tree.container,"drop",(e=>{if((s.o.moveFile||s.o.moveFolder)&&t){let i=Bt(t,"-path")||"";if(!s.o.moveFolder&&t.classList.contains(this.tree.getFullElName("item")))return!1;if(t.classList.contains(this.files.getFullElName("item"))&&(i+=Bt(t,"-name"),!s.o.moveFile))return!1;const o=js(e.target,s.container);if(!o)return;s.dataProvider.move(i,Bt(o,"-path")||"",Bt(o,"-source")||"",t.classList.contains(this.files.getFullElName("item"))).then((()=>hs(this))).catch(s.status),t=!1}})).on(s.files.container,"contextmenu",xs(s)).on(s.files.container,"click",(t=>{Xt(t)||(this.state.activeElements=[])})).on(s.files.container,"click",(t=>{const i=js(t.target,s.container);if(!i)return;const o=Ss(i,e);return o?(s.state.activeElements=Xt(t)?[...s.state.activeElements,o]:[o],t.stopPropagation(),!1):void 0})).on(s.files.container,"dragstart",(e=>{if(s.o.moveFile){const i=js(e.target,s.container);if(!i)return;t=i}})).on(s.container,"drop",(t=>t.preventDefault()))}function _s(){const t=this.state,e=this.dataProvider,s=this;s.e.on("view.filebrowser",(e=>{e!==t.view&&(t.view=e)})).on("sort.filebrowser",(e=>{e!==t.sortBy&&(t.sortBy=e,ls(s).catch(s.status))})).on("filter.filebrowser",(e=>{e!==t.filterWord&&(t.filterWord=e,ls(s).catch(s.status))})).on("openFolder.filebrowser",(t=>{let e;e=".."===t.name?t.path.split("/").filter((t=>t.length)).slice(0,-1).join("/"):Mt(t.path,t.name),s.state.currentPath=e,s.state.currentSource="."===t.name?is:t.source})).on("removeFolder.filebrowser",(t=>{ts(s.i18n("Are you sure?"),s.i18n("Delete"),(i=>{i&&e.folderRemove(t.path,t.name,t.source).then((t=>(s.status(t,!0),hs(s)))).catch(s.status)})).bindDestruct(s)})).on("renameFolder.filebrowser",(t=>{Qe(s.i18n("Enter new name"),s.i18n("Rename"),(i=>{if(!N(i))return s.status(s.i18n("Enter new name")),!1;e.folderRename(t.path,t.name,i,t.source).then((t=>(s.state.activeElements=[],s.status(t,!0),hs(s)))).catch(s.status)}),s.i18n("type name"),t.name).bindDestruct(s)})).on("addFolder.filebrowser",(t=>{Qe(s.i18n("Enter Directory name"),s.i18n("Create directory"),(i=>{e.createFolder(i,t.path,t.source).then((()=>hs(s))).catch(s.status)}),s.i18n("type name")).bindDestruct(s)})).on("fileRemove.filebrowser",(()=>{s.state.activeElements.length&&ts(s.i18n("Are you sure?"),"",(t=>{if(t){const t=[];s.state.activeElements.forEach((e=>{t.push(ws(s,e.file||e.name||"",e.sourceName))})),s.state.activeElements=[],Promise.all(t).then((()=>hs(s).catch(s.status)),s.status)}})).bindDestruct(s)})).on("edit.filebrowser",(()=>{if(1===s.state.activeElements.length){const[t]=this.state.activeElements;bs.call(s,t.fileURL,t.file||"",t.path,t.sourceName)}})).on("fileRename.filebrowser",((t,i,o)=>{1===s.state.activeElements.length&&Qe(s.i18n("Enter new name"),s.i18n("Rename"),(n=>{if(!N(n))return s.status(s.i18n("Enter new name")),!1;e.fileRename(i,t,n,o).then((t=>{s.state.activeElements=[],s.status(t,!0),ls(s).catch(s.status)})).catch(s.status)}),s.i18n("type name"),t).bindDestruct(this)})).on("update.filebrowser",(()=>{hs(this).then(this.status)}))}class Ts extends re{className(){return"FilebrowserFiles"}}class Is extends re{className(){return"FilebrowserTree"}}class Ns extends Ke{constructor(t){var e;super(t),this.browser=this.c.div(this.componentName),this.status_line=this.c.div(this.getFullElName("status")),this.tree=new Is(this),this.files=new Ts(this),this.state=D({currentPath:"",currentSource:is,currentBaseUrl:"",activeElements:[],elements:[],messages:[],sources:[],view:"tiles",sortBy:"changed-desc",filterWord:"",onlyImages:!1}),this.errorHandler=t=>{this.status(t instanceof Error?this.i18n(t.message):this.dataProvider.getMessage(t))},this.close=()=>{this.dialog.close()},this.attachEvents(t);const s=this;s.options=qt(t||{},gt.defaultOptions.filebrowser),s.storage=We.makeStorage(!!this.o.saveStateInStorage,this.componentName),s.dataProvider=((t,e)=>new ns(t,e))(s,s.options),s.dialog=new Ze({fullsize:s.o.fullsize,ownerWindow:s.ownerWindow,theme:s.o.theme,globalFullSize:s.o.globalFullSize,language:this.o.language,minWidth:Math.min(700,screen.width),minHeight:300,buttons:null!==(e=this.o.headerButtons)&&void 0!==e?e:["fullsize","dialog.close"]}),this.proxyDialogEvents(s),s.browser.component=this,s.container=s.browser,s.o.showFoldersPanel&&s.browser.appendChild(s.tree.container),s.browser.appendChild(s.files.container),s.browser.appendChild(s.status_line),_s.call(s),Es.call(s),cs.call(s),s.dialog.setSize(s.o.width,s.o.height),["getLocalFileByUrl","crop","resize","create","fileMove","folderMove","fileRename","folderRename","fileRemove","folderRemove","folder","items","permissions"].forEach((t=>{null!=this.options[t]&&(this.options[t]=qt(this.options[t],this.o.ajax))}));const{storeView:i,storeSortBy:o,storeLastOpenedFolder:n}=this.o.saveStateInStorage||{storeLastOpenedFolder:!1,storeView:!1,storeSortBy:!1},r=i&&this.storage.get("view");s.state.view=r&&null==this.o.view?"list"===r?"list":"tiles":"list"===s.o.view?"list":"tiles",s.files.setMod("view",s.state.view);const a=o&&s.storage.get("sortBy");if(a){const t=a.split("-");s.state.sortBy=["changed","name","size"].includes(t[0])?a:"changed-desc"}else s.state.sortBy=s.o.sortBy||"changed-desc";if(n){const t=s.storage.get("currentPath"),e=s.storage.get("currentSource");s.state.currentPath=null!=t?t:"",s.state.currentSource=null!=e?e:""}s.initUploader(s),s.setStatus(h.ready)}className(){return"Filebrowser"}onSelect(t){return()=>{if(this.state.activeElements.length){const e=[],s=[];this.state.activeElements.forEach((t=>{const i=t.fileURL;i&&(e.push(i),s.push(t.isImage||!1))})),this.close();const i={baseurl:"",files:e,isImages:s};o(t)&&t(i),this.close()}return!1}}get isOpened(){return this.dialog.isOpened&&"none"!==this.browser.style.display}status(t,e){if(r(t)||(t=t.message),!r(t)||!ft(t).length)return;const s=this.getFullElName("status","success",!0),i=this.getFullElName("status","active",!0);this.status_line.classList.remove(s),this.status_line.classList.add(i);const o=this.c.div();o.textContent=t,this.status_line.appendChild(o),e&&this.status_line.classList.add(s),this.async.setTimeout((()=>{this.status_line.classList.remove(i),ht.detach(this.status_line)}),{timeout:this.o.howLongShowMsg,label:"fileBrowser.status"})}open(t=this.o.defaultCallback,e=!1){return this.state.onlyImages=e,this.async.promise(((e,s)=>{var i;if(!this.o.items||!this.o.items.url)throw k("Need set options.filebrowser.ajax.url");let o=0;this.e.off(this.files.container,"dblclick").on(this.files.container,"dblclick",this.onSelect(t)).on(this.files.container,"touchstart",(()=>{const e=(new Date).getTime();300>e-o&&this.onSelect(t)(),o=e})).off("select.filebrowser").on("select.filebrowser",this.onSelect(t));const n=this.c.div();this.toolbar.build(null!==(i=this.o.buttons)&&void 0!==i?i:[]).appendTo(n),this.dialog.open(this.browser,n),this.e.fire("sort.filebrowser",this.state.sortBy),hs(this).then(e,s)}))}initUploader(t){var e;const s=this,i=qt((null===(e=null==t?void 0:t.options)||void 0===e?void 0:e.uploader)||{},gt.defaultOptions.uploader),o=()=>ls(this);s.uploader=s.getInstance("Uploader",i),s.uploader.setPath(s.state.currentPath).setSource(s.state.currentSource).bind(s.browser,o,s.errorHandler),this.state.on(["change.currentPath","change.currentSource"],(()=>{this.uploader.setPath(this.state.currentPath).setSource(this.state.currentSource)})),s.e.on("bindUploader.filebrowser",(t=>{s.uploader.bind(t,o,s.errorHandler)}))}proxyDialogEvents(t){["afterClose","beforeOpen"].forEach((e=>{t.dialog.events.on(t.dialog,e,(()=>{this.e.fire(e)}))}))}destruct(){this.isInDestruct||(this.dialog.destruct(),this.events&&this.e.off(".filebrowser"),this.uploader&&this.uploader.destruct(),super.destruct())}}i([q],Ns.prototype,"status",null),i([q],Ns.prototype,"open",null);class ks extends Tt{constructor(){super(...arguments),this.isBlocked=!1}className(){return"Snapshot"}static equal(t,e){return t.html===e.html&&JSON.stringify(t.range)===JSON.stringify(e.range)}static countNodesBeforeInParent(t){if(!t.parentNode)return 0;const e=t.parentNode.childNodes;let s,i=0,o=null;for(s=0;e.length>s;s+=1){if(!o||ht.isText(e[s])&&""===e[s].textContent||ht.isText(o)&&ht.isText(e[s])||(i+=1),e[s]===t)return i;o=e[s]}return 0}static strokeOffset(t,e){for(;ht.isText(t);)ht.isText(t=t.previousSibling)&&null!=t.textContent&&(e+=t.textContent.length);return e}calcHierarchyLadder(t){const e=[];if(!t||!t.parentNode||!ht.isOrContains(this.j.editor,t))return[];for(;t&&t!==this.j.editor;)t&&e.push(ks.countNodesBeforeInParent(t)),t=t.parentNode;return e.reverse()}getElementByLadder(t){let e,s=this.j.editor;for(e=0;s&&t.length>e;e+=1)s=s.childNodes[t[e]];return s}make(){const t={html:"",range:{startContainer:[],startOffset:0,endContainer:[],endOffset:0}};t.html=this.j.getNativeEditorValue();const e=this.j.s.sel;if(e&&e.rangeCount){const s=e.getRangeAt(0),i=this.calcHierarchyLadder(s.startContainer),o=this.calcHierarchyLadder(s.endContainer);let n=ks.strokeOffset(s.startContainer,s.startOffset),r=ks.strokeOffset(s.endContainer,s.endOffset);i.length||s.startContainer===this.j.editor||(n=0),o.length||s.endContainer===this.j.editor||(r=0),t.range={startContainer:i,startOffset:n,endContainer:o,endOffset:r}}return t}restore(t){this.isBlocked=!0;const e=this.storeScrollState();this.j.getNativeEditorValue()!==t.html&&this.j.setEditorValue(t.html),this.restoreOnlySelection(t),this.restoreScrollState(e),this.isBlocked=!1}storeScrollState(){return[this.j.ow.scrollY,this.j.editor.scrollTop]}restoreScrollState(t){const{j:e}=this,{ow:s}=e;s.scrollTo(s.scrollX,t[0]),e.editor.scrollTop=t[1]}restoreOnlySelection(t){try{if(t.range){const e=this.j.ed.createRange();e.setStart(this.getElementByLadder(t.range.startContainer),t.range.startOffset),e.setEnd(this.getElementByLadder(t.range.endContainer),t.range.endOffset),this.j.s.selectRange(e)}}catch(t){this.j.editor.lastChild&&this.j.s.setCursorAfter(this.j.editor.lastChild)}}destruct(){this.isBlocked=!1,super.destruct()}}class Ms{constructor(t){this.size=t,this.commands=[],this.stackPosition=-1}get length(){return this.commands.length}clearRedo(){this.commands.length=this.stackPosition+1}clear(){this.commands.length=0,this.stackPosition=-1}push(t){this.clearRedo(),this.commands.push(t),this.stackPosition+=1,this.commands.length>this.size&&(this.commands.shift(),this.stackPosition-=1)}replace(t){this.commands[this.stackPosition]=t}current(){return this.commands[this.stackPosition]}undo(){return!!this.canUndo()&&(this.commands[this.stackPosition]&&this.commands[this.stackPosition].undo(),this.stackPosition-=1,!0)}redo(){return!!this.canRedo()&&(this.stackPosition+=1,this.commands[this.stackPosition]&&this.commands[this.stackPosition].redo(),!0)}canUndo(){return this.stackPosition>=0}canRedo(){return this.commands.length-1>this.stackPosition}}class zs{constructor(t,e,s,i){this.oldValue=t,this.newValue=e,this.observer=s,this.tick=i}undo(){this.observer.snapshot.restore(this.oldValue)}redo(){this.observer.snapshot.restore(this.newValue)}}gt.prototype.observer={maxHistoryLength:1/0,timeout:100},i([M()],class extends Tt{constructor(t){super(t),this.stack=new Ms(this.j.o.observer.maxHistoryLength),this.snapshot=new ks(this.j),this.updateTick=0,t.e.on("afterAddPlace.observer",(()=>{this.isInDestruct||(this.startValue=this.snapshot.make(),t.events.on("internalChange",(()=>{this.startValue=this.snapshot.make()})).on(t.editor,["changeSelection","selectionstart","selectionchange","mousedown","mouseup","keydown","keyup"].map((t=>t+".observer")).join(" "),(()=>{this.startValue.html===this.j.getNativeEditorValue()&&(this.startValue=this.snapshot.make())})).on(this,"change.observer",this.onChange))}))}className(){return"Observer"}get startValue(){return this.__startValue}set startValue(t){this.__startValue=t}upTick(){this.updateTick+=1}onChange(){this.snapshot.isBlocked||this.updateStack()}updateStack(t=!1){const e=this.snapshot.make();if(!ks.equal(e,this.startValue)){const s=new zs(this.startValue,e,this,this.updateTick);if(t){const t=this.stack.current();t&&this.updateTick===t.tick&&this.stack.replace(s)}else this.stack.push(s);this.startValue=e,this.fireChangeStack()}}redo(){this.stack.redo()&&(this.startValue=this.snapshot.make(),this.fireChangeStack())}undo(){this.stack.undo()&&(this.startValue=this.snapshot.make(),this.fireChangeStack())}clear(){this.startValue=this.snapshot.make(),this.stack.clear(),this.fireChangeStack()}replaceSnapshot(){this.updateStack(!0)}fireChangeStack(){var t;this.j&&!this.j.isInDestruct&&(null===(t=this.j.events)||void 0===t||t.fire("changeStack"))}destruct(){this.j.events&&this.j.e.off(".observer"),this.snapshot.destruct(),super.destruct()}}.prototype,"onChange",null);let Rs=class extends Tt{constructor(t,e){super(t),this.target=e,this.mods={},this.container=t.c.div("jodit-status-bar"),e.appendChild(this.container),this.hide()}className(){return"StatusBar"}hide(){this.container.classList.add("jodit_hidden")}show(){this.container.classList.remove("jodit_hidden")}get isShown(){return!this.container.classList.contains("jodit_hidden")}setMod(t,e){return te.setMod.call(this,t,e),this}getMod(t){return te.getMod.call(this,t)}getHeight(){var t,e;return null!==(e=null===(t=this.container)||void 0===t?void 0:t.offsetHeight)&&void 0!==e?e:0}findEmpty(t=!1){const e=Qt.getElms.call(this,t?"item-right":"item");for(let t=0;e.length>t;t+=1)if(!e[t].innerHTML.trim().length)return e[t]}append(t,e=!1){var s;const i=this.findEmpty(e)||this.j.c.div(this.getFullElName("item"));e&&i.classList.add(this.getFullElName("item-right")),i.appendChild(t),null===(s=this.container)||void 0===s||s.appendChild(i),this.j.o.statusbar&&this.show(),this.j.e.fire("resize")}destruct(){this.setStatus(h.beforeDestruct),ht.safeRemove(this.container),super.destruct()}};Rs=i([y],Rs);const Ls=new WeakMap;class Os extends Tt{constructor(){super(...arguments),this.selected=new Set}className(){return"Table"}recalculateStyles(){const t=jt(this.j,Os,"style",!0),e=[];this.selected.forEach((t=>{const s=(t=>{if(!ht.isElement(t))return null;const e=[];let s=t;for(;s&&s.nodeType===Node.ELEMENT_NODE;){let t=s.nodeName.toLowerCase();if(s.id){t+="#"+s.id,e.unshift(t);break}{let e=s,i=1;do{e=e.previousElementSibling,e&&e.nodeName.toLowerCase()===t&&i++}while(e);t+=":nth-of-type("+i+")"}e.unshift(t),s=s.parentNode}return e.join(" > ")})(t);s&&e.push(s)})),t.innerHTML=e.length?e.join(",")+`{${this.jodit.options.table.selectionCellStyle}}`:""}addSelection(t){this.selected.add(t),this.recalculateStyles();const e=ht.closest(t,"table",this.j.editor);if(e){const s=Os.selectedByTable.get(e)||new Set;s.add(t),Os.selectedByTable.set(e,s)}}removeSelection(t){this.selected.delete(t),this.recalculateStyles();const e=ht.closest(t,"table",this.j.editor);if(e){const s=Os.selectedByTable.get(e);s&&(s.delete(t),s.size||Os.selectedByTable.delete(e))}}getAllSelectedCells(){return Jt(this.selected)}static getSelectedCellsByTable(t){const e=Os.selectedByTable.get(t);return e?Jt(e):[]}destruct(){return this.selected.clear(),super.destruct()}static getRowsCount(t){return t.rows.length}static getColumnsCount(t){return Os.formalMatrix(t).reduce(((t,e)=>Math.max(t,e.length)),0)}static formalMatrix(t,e){const s=[[]],i=Jt(t.rows),o=(t,i)=>{void 0===s[i]&&(s[i]=[]);const o=t.colSpan,n=t.rowSpan;let r,a,l=0;for(;s[i][l];)l+=1;for(a=0;n>a;a+=1)for(r=0;o>r;r+=1){if(void 0===s[i+a]&&(s[i+a]=[]),e&&!1===e(t,i+a,l+r,o,n))return!1;s[i+a][l+r]=t}};for(let t=0;i.length>t;t+=1){const e=Jt(i[t].cells);for(let i=0;e.length>i;i+=1)if(!1===o(e[i],t))return s}return s}static formalCoordinate(t,e,s=!1){let i=0,o=0,n=1,r=1;return Os.formalMatrix(t,((t,a,l,h,c)=>{if(e===t)return i=a,o=l,n=h||1,r=c||1,s&&(o+=(h||1)-1,i+=(c||1)-1),!1})),[i,o,n,r]}static appendRow(t,e,s,i){var o;let n;if(e)n=e.cloneNode(!0),ke("td,th",e).forEach((t=>{const e=Bt(t,"rowspan");if(e&&parseInt(e,10)>1){const s=parseInt(e,10)-1;Bt(t,"rowspan",s>1?s:null)}})),ke("td,th",n).forEach((t=>{t.innerHTML=""}));else{const e=Os.getColumnsCount(t);n=i.element("tr");for(let t=0;e>t;t+=1)n.appendChild(i.element("td"))}s&&e&&e.nextSibling?e.parentNode&&e.parentNode.insertBefore(n,e.nextSibling):!s&&e?e.parentNode&&e.parentNode.insertBefore(n,e):((null===(o=t.getElementsByTagName("tbody"))||void 0===o?void 0:o[0])||t).appendChild(n)}static removeRow(t,e){const s=Os.formalMatrix(t);let i;const o=t.rows[e];s[e].forEach(((n,r)=>{if(i=!1,0>e-1||s[e-1][r]!==n)if(s[e+1]&&s[e+1][r]===n){if(n.parentNode===o&&n.parentNode.nextSibling){i=!0;let o=r+1;for(;s[e+1][o]===n;)o+=1;const a=ht.next(n.parentNode,(t=>ht.isTag(t,"tr")),t);a&&(s[e+1][o]?a.insertBefore(n,s[e+1][o]):a.appendChild(n))}}else ht.safeRemove(n);else i=!0;if(i&&(n.parentNode===o||n!==s[e][r-1])){const t=n.rowSpan;Bt(n,"rowspan",t-1>1?t-1:null)}})),ht.safeRemove(o)}static appendColumn(t,e,s,i){const o=Os.formalMatrix(t);let n;for((void 0===e||0>e)&&(e=Os.getColumnsCount(t)-1),n=0;o.length>n;n+=1){const t=i.element("td"),r=o[n][e];let a=!1;s?(o[n]&&r&&e+1>=o[n].length||r!==o[n][e+1])&&(r.nextSibling?ht.before(r.nextSibling,t):r.parentNode&&r.parentNode.appendChild(t),a=!0):(0>e-1||o[n][e]!==o[n][e-1]&&o[n][e].parentNode)&&(ht.before(o[n][e],t),a=!0),a||Bt(o[n][e],"colspan",parseInt(Bt(o[n][e],"colspan")||"1",10)+1)}}static removeColumn(t,e){const s=Os.formalMatrix(t);let i;s.forEach(((t,o)=>{const n=t[e];if(i=!1,0>e-1||s[o][e-1]!==n?t.length>e+1&&s[o][e+1]===n?i=!0:ht.safeRemove(n):i=!0,i&&(0>o-1||n!==s[o-1][e])){const t=n.colSpan;Bt(n,"colspan",t-1>1?""+(t-1):null)}}))}static getSelectedBound(t,e){const s=[[1/0,1/0],[0,0]],i=Os.formalMatrix(t);let o,n,r;for(o=0;i.length>o;o+=1)for(n=0;i[o]&&i[o].length>n;n+=1)e.includes(i[o][n])&&(s[0][0]=Math.min(o,s[0][0]),s[0][1]=Math.min(n,s[0][1]),s[1][0]=Math.max(o,s[1][0]),s[1][1]=Math.max(n,s[1][1]));for(o=s[0][0];s[1][0]>=o;o+=1)for(r=1,n=s[0][1];s[1][1]>=n;n+=1){for(;i[o]&&i[o][n-r]&&i[o][n]===i[o][n-r];)s[0][1]=Math.min(n-r,s[0][1]),s[1][1]=Math.max(n-r,s[1][1]),r+=1;for(r=1;i[o]&&i[o][n+r]&&i[o][n]===i[o][n+r];)s[0][1]=Math.min(n+r,s[0][1]),s[1][1]=Math.max(n+r,s[1][1]),r+=1;for(r=1;i[o-r]&&i[o][n]===i[o-r][n];)s[0][0]=Math.min(o-r,s[0][0]),s[1][0]=Math.max(o-r,s[1][0]),r+=1;for(r=1;i[o+r]&&i[o][n]===i[o+r][n];)s[0][0]=Math.min(o+r,s[0][0]),s[1][0]=Math.max(o+r,s[1][0]),r+=1}return s}static normalizeTable(t){let e,s,i,o;const n=[],r=Os.formalMatrix(t);for(s=0;r[0].length>s;s+=1){for(i=1e6,o=!1,e=0;r.length>e;e+=1)if(void 0!==r[e][s]){if(2>r[e][s].colSpan){o=!0;break}i=Math.min(i,r[e][s].colSpan)}if(!o)for(e=0;r.length>e;e+=1)void 0!==r[e][s]&&Os.mark(r[e][s],"colspan",r[e][s].colSpan-i+1,n)}for(e=0;r.length>e;e+=1){for(i=1e6,o=!1,s=0;r[e].length>s;s+=1)if(void 0!==r[e][s]){if(2>r[e][s].rowSpan){o=!0;break}i=Math.min(i,r[e][s].rowSpan)}if(!o)for(s=0;r[e].length>s;s+=1)void 0!==r[e][s]&&Os.mark(r[e][s],"rowspan",r[e][s].rowSpan-i+1,n)}for(e=0;r.length>e;e+=1)for(s=0;r[e].length>s;s+=1)void 0!==r[e][s]&&(r[e][s].hasAttribute("rowspan")&&1===r[e][s].rowSpan&&Bt(r[e][s],"rowspan",null),r[e][s].hasAttribute("colspan")&&1===r[e][s].colSpan&&Bt(r[e][s],"colspan",null),r[e][s].hasAttribute("class")&&!Bt(r[e][s],"class")&&Bt(r[e][s],"class",null));Os.unmark(n)}static mergeSelected(t,e){const s=[],i=Os.getSelectedBound(t,Os.getSelectedCellsByTable(t));let o,n=0,r=null,a=0,l=0,h=0;const c=new Set,d=[];i&&(i[0][0]-i[1][0]||i[0][1]-i[1][1])&&(Os.formalMatrix(t,((t,u,p,f,m)=>{if(!(i[0][0]>u||u>i[1][0]||i[0][1]>p||p>i[1][1])){if(o=t,c.has(o))return;c.add(o),u===i[0][0]&&o.style.width&&(n+=o.offsetWidth),""!==ft(t.innerHTML.replace(/<br(\/)?>/g,""))&&s.push(t.innerHTML),f>1&&(l+=f-1),m>1&&(h+=m-1),r?(Os.mark(o,"remove",1,d),Bs(e).removeSelection(o)):(r=t,a=p)}})),l=i[1][1]-i[0][1]+1,h=i[1][0]-i[0][0]+1,r&&(l>1&&Os.mark(r,"colspan",l,d),h>1&&Os.mark(r,"rowspan",h,d),n&&(Os.mark(r,"width",(n/t.offsetWidth*100).toFixed(10)+"%",d),a&&Os.setColumnWidthByDelta(t,a,0,!0,d)),r.innerHTML=s.join("<br/>"),Bs(e).addSelection(r),c.delete(r),Os.unmark(d),Os.normalizeTable(t),Jt(t.rows).forEach(((t,e)=>{t.cells.length||ht.safeRemove(t)}))))}static splitHorizontal(t,e){let s,i,o,n,r;const a=[];Os.getSelectedCellsByTable(t).forEach((l=>{i=e.createInside.element("td"),i.appendChild(e.createInside.element("br")),o=e.createInside.element("tr"),s=Os.formalCoordinate(t,l),2>l.rowSpan?(Os.formalMatrix(t,((t,e,i)=>{s[0]===e&&s[1]!==i&&t!==l&&Os.mark(t,"rowspan",t.rowSpan+1,a)})),ht.after(ht.closest(l,"tr",t),o),o.appendChild(i)):(Os.mark(l,"rowspan",l.rowSpan-1,a),Os.formalMatrix(t,((e,i,o)=>{i>s[0]&&s[0]+l.rowSpan>i&&s[1]>o&&e.parentNode.rowIndex===i&&(r=e),i>s[0]&&e===l&&(n=t.rows[i])})),r?ht.after(r,i):n.insertBefore(i,n.firstChild)),l.colSpan>1&&Os.mark(i,"colspan",l.colSpan,a),Os.unmark(a),Bs(e).removeSelection(l)})),this.normalizeTable(t)}static splitVertical(t,e){let s,i,o;const n=[];Os.getSelectedCellsByTable(t).forEach((r=>{s=Os.formalCoordinate(t,r),2>r.colSpan?Os.formalMatrix(t,((t,e,i)=>{s[1]===i&&s[0]!==e&&t!==r&&Os.mark(t,"colspan",t.colSpan+1,n)})):Os.mark(r,"colspan",r.colSpan-1,n),i=e.createInside.element("td"),i.appendChild(e.createInside.element("br")),r.rowSpan>1&&Os.mark(i,"rowspan",r.rowSpan,n);const a=r.offsetWidth;ht.after(r,i),o=a/t.offsetWidth/2,Os.mark(r,"width",(100*o).toFixed(10)+"%",n),Os.mark(i,"width",(100*o).toFixed(10)+"%",n),Os.unmark(n),Bs(e).removeSelection(r)})),Os.normalizeTable(t)}static setColumnWidthByDelta(t,e,s,i,o){const n=Os.formalMatrix(t);let r=0;for(let i=0;n.length>i;i+=1){const a=n[i][e];if(1>=a.colSpan||1>=n.length){Os.mark(a,"width",((a.offsetWidth+s)/t.offsetWidth*100).toFixed(10)+"%",o),r=i;break}}for(let t=r+1;n.length>t;t+=1)Os.mark(n[t][e],"width",null,o);i||Os.unmark(o)}static mark(t,e,s,i){var o;i.push(t);const n=null!==(o=Ls.get(t))&&void 0!==o?o:{};n[e]=void 0===s?1:s,Ls.set(t,n)}static unmark(t){t.forEach((t=>{const e=Ls.get(t);e&&(Object.keys(e).forEach((s=>{const i=e[s];switch(s){case"remove":ht.safeRemove(t);break;case"rowspan":Bt(t,"rowspan",_(i)&&i>1?i:null);break;case"colspan":Bt(t,"colspan",_(i)&&i>1?i:null);break;case"width":null==i?(t.style.removeProperty("width"),Bt(t,"style")||Bt(t,"style",null)):t.style.width=""+i}delete e[s]})),Ls.delete(t))}))}}Os.selectedByTable=new WeakMap,i([M()],Os.prototype,"recalculateStyles",null);const Bs=t=>t.getInstance("Table",t.o);function Fs(t){var e,s;const i={};if("SCRIPT"===t.nodeName&&(i.textContent=null!==(e=t.textContent)&&void 0!==e?e:""),t.nodeType===Node.TEXT_NODE&&(i.nodeValue=null!==(s=t.nodeValue)&&void 0!==s?s:""),ht.isElement(t))for(let e=0;t.attributes.length>e;e+=1){const s=t.attributes.item(e);s&&(i[s.name]=s.value)}return i}function Ps(t,e=!0){var s;return t.nodeType===Node.TEXT_NODE?{type:"TEXT_ELEMENT",props:{children:[],nodeValue:null!==(s=t.nodeValue)&&void 0!==s?s:""}}:{type:t.nodeName.toLowerCase(),props:{children:Jt(t.childNodes).map((t=>Ps(t,e))),...Fs(t)}}}new WeakMap,gt.prototype.enableDragAndDropFileToEditor=!0,gt.prototype.uploader={url:"",insertImageAsBase64URI:!1,imagesExtensions:["jpg","png","jpeg","gif"],headers:null,data:null,filesVariableName:t=>`files[${t}]`,withCredentials:!1,pathVariableName:"path",format:"json",method:"POST",prepareData:t=>t,isSuccess:t=>t.success,getMessage:t=>void 0!==t.data.messages&&C(t.data.messages)?t.data.messages.join(" "):"",process:t=>t.data,error(t){this.j.e.fire("errorMessage",t.message,"error",4e3)},defaultHandlerSuccess(t){const e=this.j||this;S(e)&&t.files&&t.files.length&&t.files.forEach(((s,i)=>{const[o,n]=t.isImages&&t.isImages[i]?["img","src"]:["a","href"],r=e.createInside.element(o);r.setAttribute(n,t.baseurl+s),"a"===o&&(r.textContent=t.baseurl+s),"img"===o?e.s.insertImage(r,null,e.o.imageDefaultWidth):e.s.insertNode(r)}))},defaultHandlerError(t){this.j.e.fire("errorMessage",t.message)},contentType(t){return(void 0===this.j.ow.FormData||"string"==typeof t)&&"application/x-www-form-urlencoded; charset=UTF-8"}};const Ds=t=>"children"!==t,Hs=(t,e,s)=>{var i;Object.keys(e).filter(Ds).filter((i=s,t=>!(t in i))).forEach((e=>{t[e]=""})),Object.keys(s).filter(Ds).filter(((t,e)=>s=>t[s]!==e[s])(e,s)).forEach((e=>{t[e]=s[e]}))};let As=class{constructor(){this.async=new Oe,this.nextUnitOfWork=void 0,this.currentRoot=void 0,this.wipRoot=void 0,this.deletions=[],this.async.requestIdleCallback(this.workLoop)}commitRoot(){var t;this.deletions.forEach(this.commitWork),this.deletions.length=0,this.commitWork(null===(t=this.wipRoot)||void 0===t?void 0:t.child),this.currentRoot=this.wipRoot,this.wipRoot=void 0}commitWork(t){var e,s;if(!t)return;let i=t.parent;for(;!(null==i?void 0:i.dom);)i=null==i?void 0:i.parent;const o=i.dom;"PLACEMENT"===t.effectTag&&null!=t.dom?o.appendChild(t.dom):"UPDATE"===t.effectTag&&null!=t.dom?Hs(t.dom,null!==(s=null===(e=t.alternate)||void 0===e?void 0:e.props)&&void 0!==s?s:{},t.props):"DELETION"===t.effectTag&&this.commitDeletion(t,o),this.commitWork(null==t?void 0:t.child),this.commitWork(null==t?void 0:t.sibling)}commitDeletion(t,e){(null==t?void 0:t.dom)?e.removeChild(t.dom):this.commitDeletion(null==t?void 0:t.child,e)}render(t,e){var s;this.wipRoot={type:"div",dom:e,props:{children:[t]},alternate:null!==(s=this.currentRoot)&&void 0!==s?s:void 0},this.deletions=[],this.nextUnitOfWork=this.wipRoot}workLoop(t){let e=!1;for(;this.nextUnitOfWork&&!e;)this.nextUnitOfWork=this.performUnitOfWork(this.nextUnitOfWork),e=1>t.timeRemaining();!this.nextUnitOfWork&&this.wipRoot&&this.commitRoot(),this.async.requestIdleCallback(this.workLoop)}performUnitOfWork(t){if(this.__updateHostComponent(t),t.child)return t.child;let e=t;for(;e;){if(e.sibling)return e.sibling;e=e.parent}}__updateHostComponent(t){t.dom||(t.dom=(t=>{const e="TEXT_ELEMENT"===t.type?document.createTextNode(""):document.createElement(t.type);return Hs(e,{},t.props),e})(t)),this.__reconcileChildren(t,t.props.children)}__reconcileChildren(t,e){let s,i=0,o=t.alternate&&t.alternate.child;for(;e.length>i||o;){const n=e[i];let r;const a=o&&n&&n.type===o.type;a&&o&&(r={type:o.type,props:n.props,dom:o.dom,parent:t,alternate:o,effectTag:"UPDATE"}),n&&!a&&(r={type:n.type,props:n.props,dom:null,parent:t,alternate:void 0,effectTag:"PLACEMENT"}),o&&!a&&(o.effectTag="DELETION",this.deletions.push(o)),o&&(o=o.sibling),0===i&&t?t.child=r:n&&s&&(s.sibling=r),s=r,i++}}htmlToVDom(t){const e=document.createElement("div");return e.innerHTML=t,Ps(e.children.length>1||!e.firstChild?e:e.firstChild)}};return As=i([q],As),e}()}));